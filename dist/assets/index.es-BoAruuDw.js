const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/secp256k1-BJ4cPiH0.js","assets/index-DbDzjSaj.js","assets/railgun-CY6mEVSb.js","assets/index-DolrDoYk.css","assets/index-nibyPLVP.js","assets/core-Bfgv4nD3.js"])))=>i.map(i=>d[i]);
import{_ as eh,__tla as __tla_0}from"./index-DbDzjSaj.js";import{r as Td,g as Eo,p as it,a as th,B as Ee}from"./railgun-CY6mEVSb.js";import{c as Rd,a as Nd,k as jd,d as Bd,s as Ud,g as Qo}from"./index-nibyPLVP.js";let HE,st,cw,e1,je,Mo,Us,rf,pr,js,um,Ut,lr,_o,Ui,Ma,Vh,or,Bs,vt,tt,bt,pt,aP,ya,Kp,v$,b$,Is,I$,_$,Cp,rt,Me,U,Bt,Yd,yi,kd,Je,Ns,E$,Mn,dh,Q0,$E,sf,Vt,ze,fr;let __tla=Promise.all([(()=>{try{return __tla_0}catch{}})()]).then(async()=>{function qd(r){if(r.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let l=0;l<e.length;l++)e[l]=255;for(let l=0;l<r.length;l++){const h=r.charAt(l),u=h.charCodeAt(0);if(e[u]!==255)throw new TypeError(h+" is ambiguous");e[u]=l}const t=r.length,i=r.charAt(0),s=Math.log(t)/Math.log(256),n=Math.log(256)/Math.log(t);function o(l){if(l instanceof Uint8Array||(ArrayBuffer.isView(l)?l=new Uint8Array(l.buffer,l.byteOffset,l.byteLength):Array.isArray(l)&&(l=Uint8Array.from(l))),!(l instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(l.length===0)return"";let h=0,u=0,d=0;const f=l.length;for(;d!==f&&l[d]===0;)d++,h++;const p=(f-d)*n+1>>>0,g=new Uint8Array(p);for(;d!==f;){let b=l[d],E=0;for(let x=p-1;(b!==0||E<u)&&x!==-1;x--,E++)b+=256*g[x]>>>0,g[x]=b%t>>>0,b=b/t>>>0;if(b!==0)throw new Error("Non-zero carry");u=E,d++}let w=p-u;for(;w!==p&&g[w]===0;)w++;let _=i.repeat(h);for(;w<p;++w)_+=r.charAt(g[w]);return _}function a(l){if(typeof l!="string")throw new TypeError("Expected String");if(l.length===0)return new Uint8Array;let h=0,u=0,d=0;for(;l[h]===i;)u++,h++;const f=(l.length-h)*s+1>>>0,p=new Uint8Array(f);for(;h<l.length;){const b=l.charCodeAt(h);if(b>255)return;let E=e[b];if(E===255)return;let x=0;for(let T=f-1;(E!==0||x<d)&&T!==-1;T--,x++)E+=t*p[T]>>>0,p[T]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");d=x,h++}let g=f-d;for(;g!==f&&p[g]===0;)g++;const w=new Uint8Array(u+(f-g));let _=u;for(;g!==f;)w[_++]=p[g++];return w}function c(l){const h=a(l);if(h)return h;throw new Error("Non-base"+t+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var Ld="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";kd=qd(Ld);Je=Td();_o=Eo(Je);var Xo=function(r,e,t){if(t||arguments.length===2)for(var i=0,s=e.length,n;i<s;i++)(n||!(i in e))&&(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return r.concat(n||Array.prototype.slice.call(e))},Md=(function(){function r(e,t,i){this.name=e,this.version=t,this.os=i,this.type="browser"}return r})(),zd=(function(){function r(e){this.version=e,this.type="node",this.name="node",this.os=it.platform}return r})(),Fd=(function(){function r(e,t,i,s){this.name=e,this.version=t,this.os=i,this.bot=s,this.type="bot-device"}return r})(),Hd=(function(){function r(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return r})(),Vd=(function(){function r(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return r})(),Kd=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Wd=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,ea=3,Gd=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Kd]],ta=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];Yd=function(r){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new Vd:typeof navigator<"u"?Zd(navigator.userAgent):Xd()};function Jd(r){return r!==""&&Gd.reduce(function(e,t){var i=t[0],s=t[1];if(e)return e;var n=s.exec(r);return!!n&&[i,n]},!1)}function Zd(r){var e=Jd(r);if(!e)return null;var t=e[0],i=e[1];if(t==="searchbot")return new Hd;var s=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);s?s.length<ea&&(s=Xo(Xo([],s,!0),ep(ea-s.length),!0)):s=[];var n=s.join("."),o=Qd(r),a=Wd.exec(r);return a&&a[1]?new Fd(t,n,o,a[1]):new Md(t,n,o)}function Qd(r){for(var e=0,t=ta.length;e<t;e++){var i=ta[e],s=i[0],n=i[1],o=n.exec(r);if(o)return s}return null}function Xd(){var r=typeof it<"u"&&it.version;return r?new zd(it.version.slice(1)):null}function ep(r){for(var e=[],t=0;t<r;t++)e.push("0");return e}var zs={};var Cn=function(r,e){return Cn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s])},Cn(r,e)};function tp(r,e){Cn(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Tn=function(){return Tn=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++){t=arguments[i];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},Tn.apply(this,arguments)};function rp(r,e){var t={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&e.indexOf(i)<0&&(t[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(r);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(t[i[s]]=r[i[s]]);return t}function ip(r,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(n=(s<3?o(n):s>3?o(e,t,n):o(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n}function sp(r,e){return function(t,i){e(t,i,r)}}function np(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)}function op(r,e,t,i){function s(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(h){try{l(i.next(h))}catch(u){o(u)}}function c(h){try{l(i.throw(h))}catch(u){o(u)}}function l(h){h.done?n(h.value):s(h.value).then(a,c)}l((i=i.apply(r,e||[])).next())})}function ap(r,e){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(h){return c([l,h])}}function c(l){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,s&&(n=l[0]&2?s.return:l[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,l[1])).done)return n;switch(s=0,n&&(l=[l[0]&2,n.value]),l[0]){case 0:case 1:n=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,s=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!n||l[1]>n[0]&&l[1]<n[3])){t.label=l[1];break}if(l[0]===6&&t.label<n[1]){t.label=n[1],n=l;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(l);break}n[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(h){l=[6,h],s=0}finally{i=n=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function cp(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}function lp(r,e){for(var t in r)t!=="default"&&!e.hasOwnProperty(t)&&(e[t]=r[t])}function Rn(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],i=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function rh(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var i=t.call(r),s,n=[],o;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)n.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return n}function hp(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(rh(arguments[e]));return r}function up(){for(var r=0,e=0,t=arguments.length;e<t;e++)r+=arguments[e].length;for(var i=Array(r),s=0,e=0;e<t;e++)for(var n=arguments[e],o=0,a=n.length;o<a;o++,s++)i[s]=n[o];return i}function Ei(r){return this instanceof Ei?(this.v=r,this):new Ei(r)}function dp(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(r,e||[]),s,n=[];return s={},o("next"),o("throw"),o("return"),s[Symbol.asyncIterator]=function(){return this},s;function o(d){i[d]&&(s[d]=function(f){return new Promise(function(p,g){n.push([d,f,p,g])>1||a(d,f)})})}function a(d,f){try{c(i[d](f))}catch(p){u(n[0][3],p)}}function c(d){d.value instanceof Ei?Promise.resolve(d.value.v).then(l,h):u(n[0][2],d)}function l(d){a("next",d)}function h(d){a("throw",d)}function u(d,f){d(f),n.shift(),n.length&&a(n[0][0],n[0][1])}}function pp(r){var e,t;return e={},i("next"),i("throw",function(s){throw s}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(s,n){e[s]=r[s]?function(o){return(t=!t)?{value:Ei(r[s](o)),done:s==="return"}:n?n(o):o}:n}}function fp(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof Rn=="function"?Rn(r):r[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=r[n]&&function(o){return new Promise(function(a,c){o=r[n](o),s(a,c,o.done,o.value)})}}function s(n,o,a,c){Promise.resolve(c).then(function(l){n({value:l,done:a})},o)}}function gp(r,e){return Object.defineProperty?Object.defineProperty(r,"raw",{value:e}):r.raw=e,r}function yp(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)Object.hasOwnProperty.call(r,t)&&(e[t]=r[t]);return e.default=r,e}function mp(r){return r&&r.__esModule?r:{default:r}}function wp(r,e){if(!e.has(r))throw new TypeError("attempted to get private field on non-instance");return e.get(r)}function bp(r,e,t){if(!e.has(r))throw new TypeError("attempted to set private field on non-instance");return e.set(r,t),t}const vp=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Tn},__asyncDelegator:pp,__asyncGenerator:dp,__asyncValues:fp,__await:Ei,__awaiter:op,__classPrivateFieldGet:wp,__classPrivateFieldSet:bp,__createBinding:cp,__decorate:ip,__exportStar:lp,__extends:tp,__generator:ap,__importDefault:mp,__importStar:yp,__makeTemplateObject:gp,__metadata:np,__param:sp,__read:rh,__rest:rp,__spread:hp,__spreadArrays:up,__values:Rn},Symbol.toStringTag,{value:"Module"})),_s=th(vp);var Fs={},ri={},ra;function Ep(){if(ra)return ri;ra=1,Object.defineProperty(ri,"__esModule",{value:!0}),ri.delay=void 0;function r(e){return new Promise(t=>{setTimeout(()=>{t(!0)},e)})}return ri.delay=r,ri}var Yt={},Hs={},Jt={},ia;function _p(){return ia||(ia=1,Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.ONE_THOUSAND=Jt.ONE_HUNDRED=void 0,Jt.ONE_HUNDRED=100,Jt.ONE_THOUSAND=1e3),Jt}var Vs={},sa;function Ip(){return sa||(sa=1,(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ONE_YEAR=r.FOUR_WEEKS=r.THREE_WEEKS=r.TWO_WEEKS=r.ONE_WEEK=r.THIRTY_DAYS=r.SEVEN_DAYS=r.FIVE_DAYS=r.THREE_DAYS=r.ONE_DAY=r.TWENTY_FOUR_HOURS=r.TWELVE_HOURS=r.SIX_HOURS=r.THREE_HOURS=r.ONE_HOUR=r.SIXTY_MINUTES=r.THIRTY_MINUTES=r.TEN_MINUTES=r.FIVE_MINUTES=r.ONE_MINUTE=r.SIXTY_SECONDS=r.THIRTY_SECONDS=r.TEN_SECONDS=r.FIVE_SECONDS=r.ONE_SECOND=void 0,r.ONE_SECOND=1,r.FIVE_SECONDS=5,r.TEN_SECONDS=10,r.THIRTY_SECONDS=30,r.SIXTY_SECONDS=60,r.ONE_MINUTE=r.SIXTY_SECONDS,r.FIVE_MINUTES=r.ONE_MINUTE*5,r.TEN_MINUTES=r.ONE_MINUTE*10,r.THIRTY_MINUTES=r.ONE_MINUTE*30,r.SIXTY_MINUTES=r.ONE_MINUTE*60,r.ONE_HOUR=r.SIXTY_MINUTES,r.THREE_HOURS=r.ONE_HOUR*3,r.SIX_HOURS=r.ONE_HOUR*6,r.TWELVE_HOURS=r.ONE_HOUR*12,r.TWENTY_FOUR_HOURS=r.ONE_HOUR*24,r.ONE_DAY=r.TWENTY_FOUR_HOURS,r.THREE_DAYS=r.ONE_DAY*3,r.FIVE_DAYS=r.ONE_DAY*5,r.SEVEN_DAYS=r.ONE_DAY*7,r.THIRTY_DAYS=r.ONE_DAY*30,r.ONE_WEEK=r.SEVEN_DAYS,r.TWO_WEEKS=r.ONE_WEEK*2,r.THREE_WEEKS=r.ONE_WEEK*3,r.FOUR_WEEKS=r.ONE_WEEK*4,r.ONE_YEAR=r.ONE_DAY*365})(Vs)),Vs}var na;function ih(){return na||(na=1,(function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=_s;e.__exportStar(_p(),r),e.__exportStar(Ip(),r)})(Hs)),Hs}var oa;function Sp(){if(oa)return Yt;oa=1,Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.fromMiliseconds=Yt.toMiliseconds=void 0;const r=ih();function e(i){return i*r.ONE_THOUSAND}Yt.toMiliseconds=e;function t(i){return Math.floor(i/r.ONE_THOUSAND)}return Yt.fromMiliseconds=t,Yt}var aa;function Dp(){return aa||(aa=1,(function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=_s;e.__exportStar(Ep(),r),e.__exportStar(Sp(),r)})(Fs)),Fs}var wr={},ca;function Op(){if(ca)return wr;ca=1,Object.defineProperty(wr,"__esModule",{value:!0}),wr.Watch=void 0;class r{constructor(){this.timestamps=new Map}start(t){if(this.timestamps.has(t))throw new Error(`Watch already started for label: ${t}`);this.timestamps.set(t,{started:Date.now()})}stop(t){const i=this.get(t);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${t}`);const s=Date.now()-i.started;this.timestamps.set(t,{started:i.started,elapsed:s})}get(t){const i=this.timestamps.get(t);if(typeof i>"u")throw new Error(`No timestamp found for label: ${t}`);return i}elapsed(t){const i=this.get(t);return i.elapsed||Date.now()-i.started}}return wr.Watch=r,wr.default=r,wr}var Ks={},ii={},la;function $p(){if(la)return ii;la=1,Object.defineProperty(ii,"__esModule",{value:!0}),ii.IWatch=void 0;class r{}return ii.IWatch=r,ii}var ha;function Pp(){return ha||(ha=1,(function(r){Object.defineProperty(r,"__esModule",{value:!0}),_s.__exportStar($p(),r)})(Ks)),Ks}var ua;function xp(){return ua||(ua=1,(function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=_s;e.__exportStar(Dp(),r),e.__exportStar(Op(),r),e.__exportStar(Pp(),r),e.__exportStar(ih(),r)})(zs)),zs}let re,da;U=xp();re={};function sh(){if(da)return re;da=1,Object.defineProperty(re,"__esModule",{value:!0}),re.getLocalStorage=re.getLocalStorageOrThrow=re.getCrypto=re.getCryptoOrThrow=re.getLocation=re.getLocationOrThrow=re.getNavigator=re.getNavigatorOrThrow=re.getDocument=re.getDocumentOrThrow=re.getFromWindowOrThrow=re.getFromWindow=void 0;function r(d){let f;return typeof window<"u"&&typeof window[d]<"u"&&(f=window[d]),f}re.getFromWindow=r;function e(d){const f=r(d);if(!f)throw new Error(`${d} is not defined in Window`);return f}re.getFromWindowOrThrow=e;function t(){return e("document")}re.getDocumentOrThrow=t;function i(){return r("document")}re.getDocument=i;function s(){return e("navigator")}re.getNavigatorOrThrow=s;function n(){return r("navigator")}re.getNavigator=n;function o(){return e("location")}re.getLocationOrThrow=o;function a(){return r("location")}re.getLocation=a;function c(){return e("crypto")}re.getCryptoOrThrow=c;function l(){return r("crypto")}re.getCrypto=l;function h(){return e("localStorage")}re.getLocalStorageOrThrow=h;function u(){return r("localStorage")}return re.getLocalStorage=u,re}let si,pa;Bt=sh();si={};function Ap(){if(pa)return si;pa=1,Object.defineProperty(si,"__esModule",{value:!0}),si.getWindowMetadata=void 0;const r=sh();function e(){let t,i;try{t=r.getDocumentOrThrow(),i=r.getLocationOrThrow()}catch{return null}function s(){const f=t.getElementsByTagName("link"),p=[];for(let g=0;g<f.length;g++){const w=f[g],_=w.getAttribute("rel");if(_&&_.toLowerCase().indexOf("icon")>-1){const b=w.getAttribute("href");if(b)if(b.toLowerCase().indexOf("https:")===-1&&b.toLowerCase().indexOf("http:")===-1&&b.indexOf("//")!==0){let E=i.protocol+"//"+i.host;if(b.indexOf("/")===0)E+=b;else{const x=i.pathname.split("/");x.pop();const T=x.join("/");E+=T+"/"+b}p.push(E)}else if(b.indexOf("//")===0){const E=i.protocol+b;p.push(E)}else p.push(b)}}return p}function n(...f){const p=t.getElementsByTagName("meta");for(let g=0;g<p.length;g++){const w=p[g],_=["itemprop","property","name"].map(b=>w.getAttribute(b)).filter(b=>b?f.includes(b):!1);if(_.length&&_){const b=w.getAttribute("content");if(b)return b}}return""}function o(){let f=n("name","og:site_name","og:title","twitter:title");return f||(f=t.title),f}function a(){return n("description","og:description","twitter:description","keywords")}const c=o(),l=a(),h=i.origin,u=s();return{description:l,url:h,icons:u,name:c}}return si.getWindowMetadata=e,si}Cp=Ap();function _i(r,{strict:e=!0}={}){return!r||typeof r!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(r):r.startsWith("0x")}function fa(r){return _i(r,{strict:!1})?Math.ceil((r.length-2)/2):r.length}const nh="2.23.2";let Ws={getDocsUrl:({docsBaseUrl:r,docsPath:e="",docsSlug:t})=>e?`${r??"https://viem.sh"}${e}${t?`#${t}`:""}`:void 0,version:`viem@${nh}`};class cr extends Error{constructor(e,t={}){const i=t.cause instanceof cr?t.cause.details:t.cause?.message?t.cause.message:t.details,s=t.cause instanceof cr&&t.cause.docsPath||t.docsPath,n=Ws.getDocsUrl?.({...t,docsPath:s}),o=[e||"An error occurred.","",...t.metaMessages?[...t.metaMessages,""]:[],...n?[`Docs: ${n}`]:[],...i?[`Details: ${i}`]:[],...Ws.version?[`Version: ${Ws.version}`]:[]].join(`
`);super(o,t.cause?{cause:t.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=i,this.docsPath=s,this.metaMessages=t.metaMessages,this.name=t.name??this.name,this.shortMessage=e,this.version=nh}walk(e){return oh(this,e)}}function oh(r,e){return e?.(r)?r:r&&typeof r=="object"&&"cause"in r&&r.cause!==void 0?oh(r.cause,e):e?null:r}class ah extends cr{constructor({size:e,targetSize:t,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (${e}) exceeds padding size (${t}).`,{name:"SizeExceedsPaddingSizeError"})}}function Yr(r,{dir:e,size:t=32}={}){return typeof r=="string"?Tp(r,{dir:e,size:t}):Rp(r,{dir:e,size:t})}function Tp(r,{dir:e,size:t=32}={}){if(t===null)return r;const i=r.replace("0x","");if(i.length>t*2)throw new ah({size:Math.ceil(i.length/2),targetSize:t,type:"hex"});return`0x${i[e==="right"?"padEnd":"padStart"](t*2,"0")}`}function Rp(r,{dir:e,size:t=32}={}){if(t===null)return r;if(r.length>t)throw new ah({size:r.length,targetSize:t,type:"bytes"});const i=new Uint8Array(t);for(let s=0;s<t;s++){const n=e==="right";i[n?s:t-s-1]=r[n?s:r.length-s-1]}return i}class Np extends cr{constructor({max:e,min:t,signed:i,size:s,value:n}){super(`Number "${n}" is not in safe ${s?`${s*8}-bit ${i?"signed":"unsigned"} `:""}integer range ${e?`(${t} to ${e})`:`(above ${t})`}`,{name:"IntegerOutOfRangeError"})}}class jp extends cr{constructor({givenSize:e,maxSize:t}){super(`Size cannot exceed ${t} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function Jr(r,{size:e}){if(fa(r)>e)throw new jp({givenSize:fa(r),maxSize:e})}function Nn(r,e={}){const{signed:t}=e;e.size&&Jr(r,{size:e.size});const i=BigInt(r);if(!t)return i;const s=(r.length-2)/2,n=(1n<<BigInt(s)*8n-1n)-1n;return i<=n?i:i-BigInt(`0x${"f".padStart(s*2,"f")}`)-1n}function Bp(r,e={}){return Number(Nn(r,e))}const Up=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function jn(r,e={}){return typeof r=="number"||typeof r=="bigint"?lh(r,e):typeof r=="string"?kp(r,e):typeof r=="boolean"?qp(r,e):ch(r,e)}function qp(r,e={}){const t=`0x${Number(r)}`;return typeof e.size=="number"?(Jr(t,{size:e.size}),Yr(t,{size:e.size})):t}function ch(r,e={}){let t="";for(let s=0;s<r.length;s++)t+=Up[r[s]];const i=`0x${t}`;return typeof e.size=="number"?(Jr(i,{size:e.size}),Yr(i,{dir:"right",size:e.size})):i}function lh(r,e={}){const{signed:t,size:i}=e,s=BigInt(r);let n;i?t?n=(1n<<BigInt(i)*8n-1n)-1n:n=2n**(BigInt(i)*8n)-1n:typeof r=="number"&&(n=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof n=="bigint"&&t?-n-1n:0;if(n&&s>n||s<o){const c=typeof r=="bigint"?"n":"";throw new Np({max:n?`${n}${c}`:void 0,min:`${o}${c}`,signed:t,size:i,value:`${r}${c}`})}const a=`0x${(t&&s<0?(1n<<BigInt(i*8))+BigInt(s):s).toString(16)}`;return i?Yr(a,{size:i}):a}const Lp=new TextEncoder;function kp(r,e={}){const t=Lp.encode(r);return ch(t,e)}const Mp=new TextEncoder;function zp(r,e={}){return typeof r=="number"||typeof r=="bigint"?Hp(r,e):typeof r=="boolean"?Fp(r,e):_i(r)?hh(r,e):uh(r,e)}function Fp(r,e={}){const t=new Uint8Array(1);return t[0]=Number(r),typeof e.size=="number"?(Jr(t,{size:e.size}),Yr(t,{size:e.size})):t}const Dt={zero:48,nine:57,A:65,F:70,a:97,f:102};function ga(r){if(r>=Dt.zero&&r<=Dt.nine)return r-Dt.zero;if(r>=Dt.A&&r<=Dt.F)return r-(Dt.A-10);if(r>=Dt.a&&r<=Dt.f)return r-(Dt.a-10)}function hh(r,e={}){let t=r;e.size&&(Jr(t,{size:e.size}),t=Yr(t,{dir:"right",size:e.size}));let i=t.slice(2);i.length%2&&(i=`0${i}`);const s=i.length/2,n=new Uint8Array(s);for(let o=0,a=0;o<s;o++){const c=ga(i.charCodeAt(a++)),l=ga(i.charCodeAt(a++));if(c===void 0||l===void 0)throw new cr(`Invalid byte sequence ("${i[a-2]}${i[a-1]}" in "${i}").`);n[o]=c*16+l}return n}function Hp(r,e){const t=lh(r,e);return hh(t)}function uh(r,e={}){const t=Mp.encode(r);return typeof e.size=="number"?(Jr(t,{size:e.size}),Yr(t,{dir:"right",size:e.size})):t}function hs(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function Vp(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}Is=function(r,...e){if(!Vp(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)};b$=function(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");hs(r.outputLen),hs(r.blockLen)};ya=function(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")};Kp=function(r,e){Is(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)};const ki=BigInt(2**32-1),ma=BigInt(32);function Wp(r,e=!1){return e?{h:Number(r&ki),l:Number(r>>ma&ki)}:{h:Number(r>>ma&ki)|0,l:Number(r&ki)|0}}function Gp(r,e=!1){let t=new Uint32Array(r.length),i=new Uint32Array(r.length);for(let s=0;s<r.length;s++){const{h:n,l:o}=Wp(r[s],e);[t[s],i[s]]=[n,o]}return[t,i]}const Yp=(r,e,t)=>r<<t|e>>>32-t,Jp=(r,e,t)=>e<<t|r>>>32-t,Zp=(r,e,t)=>e<<t-32|r>>>64-t,Qp=(r,e,t)=>r<<t-32|e>>>64-t,br=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Xp(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}v$=function(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)};E$=function(r,e){return r<<32-e|r>>>e};const wa=new Uint8Array(new Uint32Array([0x11223344]).buffer)[0]===68;function ef(r){return r<<24&0xff000000|r<<8&0xff0000|r>>>8&65280|r>>>24&255}function ba(r){for(let e=0;e<r.length;e++)r[e]=ef(r[e])}function tf(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}dh=function(r){return typeof r=="string"&&(r=tf(r)),Is(r),r};_$=function(...r){let e=0;for(let i=0;i<r.length;i++){const s=r[i];Is(s),e+=s.length}const t=new Uint8Array(e);for(let i=0,s=0;i<r.length;i++){const n=r[i];t.set(n,s),s+=n.length}return t};rf=class{clone(){return this._cloneInto()}};sf=function(r){const e=i=>r().update(dh(i)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e};I$=function(r=32){if(br&&typeof br.getRandomValues=="function")return br.getRandomValues(new Uint8Array(r));if(br&&typeof br.randomBytes=="function")return br.randomBytes(r);throw new Error("crypto.getRandomValues must be defined")};const ph=[],fh=[],gh=[],nf=BigInt(0),ni=BigInt(1),of=BigInt(2),af=BigInt(7),cf=BigInt(256),lf=BigInt(113);for(let r=0,e=ni,t=1,i=0;r<24;r++){[t,i]=[i,(2*t+3*i)%5],ph.push(2*(5*i+t)),fh.push((r+1)*(r+2)/2%64);let s=nf;for(let n=0;n<7;n++)e=(e<<ni^(e>>af)*lf)%cf,e&of&&(s^=ni<<(ni<<BigInt(n))-ni);gh.push(s)}const[hf,uf]=Gp(gh,!0),va=(r,e,t)=>t>32?Zp(r,e,t):Yp(r,e,t),Ea=(r,e,t)=>t>32?Qp(r,e,t):Jp(r,e,t);function df(r,e=24){const t=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let o=0;o<10;o++)t[o]=r[o]^r[o+10]^r[o+20]^r[o+30]^r[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=t[c],h=t[c+1],u=va(l,h,1)^t[a],d=Ea(l,h,1)^t[a+1];for(let f=0;f<50;f+=10)r[o+f]^=u,r[o+f+1]^=d}let s=r[2],n=r[3];for(let o=0;o<24;o++){const a=fh[o],c=va(s,n,a),l=Ea(s,n,a),h=ph[o];s=r[h],n=r[h+1],r[h]=c,r[h+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)t[a]=r[o+a];for(let a=0;a<10;a++)r[o+a]^=~t[(a+2)%10]&t[(a+4)%10]}r[0]^=hf[i],r[1]^=uf[i]}t.fill(0)}class Io extends rf{constructor(e,t,i,s=!1,n=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=i,this.enableXOF=s,this.rounds=n,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,hs(i),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=Xp(this.state)}keccak(){wa||ba(this.state32),df(this.state32,this.rounds),wa||ba(this.state32),this.posOut=0,this.pos=0}update(e){ya(this);const{blockLen:t,state:i}=this;e=dh(e);const s=e.length;for(let n=0;n<s;){const o=Math.min(t-this.pos,s-n);for(let a=0;a<o;a++)i[this.pos++]^=e[n++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:i,blockLen:s}=this;e[i]^=t,(t&128)!==0&&i===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){ya(this,!1),Is(e),this.finish();const t=this.state,{blockLen:i}=this;for(let s=0,n=e.length;s<n;){this.posOut>=i&&this.keccak();const o=Math.min(i-this.posOut,n-s);e.set(t.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return hs(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Kp(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:t,suffix:i,outputLen:s,rounds:n,enableXOF:o}=this;return e||(e=new Io(t,i,s,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=i,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}}const pf=(r,e,t)=>sf(()=>new Io(e,r,t)),ff=pf(1,136,256/8);function yh(r,e){const t=e||"hex",i=ff(_i(r,{strict:!1})?zp(r):r);return t==="bytes"?i:jn(i)}class gf extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const t=super.get(e);return super.has(e)&&t!==void 0&&(this.delete(e),super.set(e,t)),t}set(e,t){if(super.set(e,t),this.maxSize&&this.size>this.maxSize){const i=this.keys().next().value;i&&this.delete(i)}return this}}const Gs=new gf(8192);function yf(r,e){if(Gs.has(`${r}.${e}`))return Gs.get(`${r}.${e}`);const t=r.substring(2).toLowerCase(),i=yh(uh(t),"bytes"),s=t.split("");for(let o=0;o<40;o+=2)i[o>>1]>>4>=8&&s[o]&&(s[o]=s[o].toUpperCase()),(i[o>>1]&15)>=8&&s[o+1]&&(s[o+1]=s[o+1].toUpperCase());const n=`0x${s.join("")}`;return Gs.set(`${r}.${e}`,n),n}function mf(r){const e=yh(`0x${r.substring(4)}`).substring(26);return yf(`0x${e}`)}async function wf({hash:r,signature:e}){const t=_i(r)?r:jn(r),{secp256k1:i}=await eh(async()=>{const{secp256k1:o}=await import("./secp256k1-BJ4cPiH0.js");return{secp256k1:o}},__vite__mapDeps([0,1,2,3,4]));return`0x${(()=>{if(typeof e=="object"&&"r"in e&&"s"in e){const{r:l,s:h,v:u,yParity:d}=e,f=Number(d??u),p=_a(f);return new i.Signature(Nn(l),Nn(h)).addRecoveryBit(p)}const o=_i(e)?e:jn(e),a=Bp(`0x${o.slice(130)}`),c=_a(a);return i.Signature.fromCompact(o.substring(2,130)).addRecoveryBit(c)})().recoverPublicKey(t.substring(2)).toHex(!1)}`}function _a(r){if(r===0||r===1)return r;if(r===27)return 0;if(r===28)return 1;throw new Error("Invalid yParityOrV value")}async function bf({hash:r,signature:e}){return mf(await wf({hash:r,signature:e}))}const vf=r=>JSON.stringify(r,(e,t)=>typeof t=="bigint"?t.toString()+"n":t),Ef=r=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,t=r.replace(e,'$1"$2n"$3');return JSON.parse(t,(i,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};lr=function(r){if(typeof r!="string")throw new Error(`Cannot safe json parse value of type ${typeof r}`);try{return Ef(r)}catch{return r}};Ut=function(r){return typeof r=="string"?r:vf(r)||""};function _f(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function mh(r,...e){if(!_f(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function Ia(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function If(r,e){mh(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const vr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const Ys=r=>new DataView(r.buffer,r.byteOffset,r.byteLength);function Sf(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function wh(r){return typeof r=="string"&&(r=Sf(r)),mh(r),r}let Df=class{clone(){return this._cloneInto()}};function Of(r){const e=i=>r().update(wh(i)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function bh(r=32){if(vr&&typeof vr.getRandomValues=="function")return vr.getRandomValues(new Uint8Array(r));if(vr&&typeof vr.randomBytes=="function")return vr.randomBytes(r);throw new Error("crypto.getRandomValues must be defined")}function $f(r,e,t,i){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,i);const s=BigInt(32),n=BigInt(0xffffffff),o=Number(t>>s&n),a=Number(t&n),c=i?4:0,l=i?0:4;r.setUint32(e+c,o,i),r.setUint32(e+l,a,i)}let Pf=class extends Df{constructor(e,t,i,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=i,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Ys(this.buffer)}update(e){Ia(this);const{view:t,buffer:i,blockLen:s}=this;e=wh(e);const n=e.length;for(let o=0;o<n;){const a=Math.min(s-this.pos,n-o);if(a===s){const c=Ys(e);for(;s<=n-o;o+=s)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Ia(this),If(e,this),this.finished=!0;const{buffer:t,view:i,blockLen:s,isLE:n}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(i,0),o=0);for(let u=o;u<s;u++)t[u]=0;$f(i,s-8,BigInt(this.length*8),n),this.process(i,0);const a=Ys(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,h=this.get();if(l>h.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<l;u++)a.setUint32(4*u,h[u],n)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const i=e.slice(0,t);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:i,length:s,finished:n,destroyed:o,pos:a}=this;return e.length=s,e.pos=a,e.finished=n,e.destroyed=o,s%t&&e.buffer.set(i),e}};const Mi=BigInt(2**32-1),Bn=BigInt(32);function vh(r,e=!1){return e?{h:Number(r&Mi),l:Number(r>>Bn&Mi)}:{h:Number(r>>Bn&Mi)|0,l:Number(r&Mi)|0}}function xf(r,e=!1){let t=new Uint32Array(r.length),i=new Uint32Array(r.length);for(let s=0;s<r.length;s++){const{h:n,l:o}=vh(r[s],e);[t[s],i[s]]=[n,o]}return[t,i]}const Af=(r,e)=>BigInt(r>>>0)<<Bn|BigInt(e>>>0),Cf=(r,e,t)=>r>>>t,Tf=(r,e,t)=>r<<32-t|e>>>t,Rf=(r,e,t)=>r>>>t|e<<32-t,Nf=(r,e,t)=>r<<32-t|e>>>t,jf=(r,e,t)=>r<<64-t|e>>>t-32,Bf=(r,e,t)=>r>>>t-32|e<<64-t,Uf=(r,e)=>e,qf=(r,e)=>r,Lf=(r,e,t)=>r<<t|e>>>32-t,kf=(r,e,t)=>e<<t|r>>>32-t,Mf=(r,e,t)=>e<<t-32|r>>>64-t,zf=(r,e,t)=>r<<t-32|e>>>64-t;function Ff(r,e,t,i){const s=(e>>>0)+(i>>>0);return{h:r+t+(s/2**32|0)|0,l:s|0}}const Hf=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),Vf=(r,e,t,i)=>e+t+i+(r/2**32|0)|0,Kf=(r,e,t,i)=>(r>>>0)+(e>>>0)+(t>>>0)+(i>>>0),Wf=(r,e,t,i,s)=>e+t+i+s+(r/2**32|0)|0,Gf=(r,e,t,i,s)=>(r>>>0)+(e>>>0)+(t>>>0)+(i>>>0)+(s>>>0),Yf=(r,e,t,i,s,n)=>e+t+i+s+n+(r/2**32|0)|0,K={fromBig:vh,split:xf,toBig:Af,shrSH:Cf,shrSL:Tf,rotrSH:Rf,rotrSL:Nf,rotrBH:jf,rotrBL:Bf,rotr32H:Uf,rotr32L:qf,rotlSH:Lf,rotlSL:kf,rotlBH:Mf,rotlBL:zf,add:Ff,add3L:Hf,add3H:Vf,add4L:Kf,add4H:Wf,add5H:Yf,add5L:Gf},[Jf,Zf]=K.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),qt=new Uint32Array(80),Lt=new Uint32Array(80);let Qf=class extends Pf{constructor(){super(128,64,16,!1),this.Ah=0x6a09e667,this.Al=-0xc4336f8,this.Bh=-0x4498517b,this.Bl=-0x7b3558c5,this.Ch=0x3c6ef372,this.Cl=-0x16b07d5,this.Dh=-0x5ab00ac6,this.Dl=0x5f1d36f1,this.Eh=0x510e527f,this.El=-0x52197d2f,this.Fh=-0x64fa9774,this.Fl=0x2b3e6c1f,this.Gh=0x1f83d9ab,this.Gl=-0x4be4295,this.Hh=0x5be0cd19,this.Hl=0x137e2179}get(){const{Ah:e,Al:t,Bh:i,Bl:s,Ch:n,Cl:o,Dh:a,Dl:c,Eh:l,El:h,Fh:u,Fl:d,Gh:f,Gl:p,Hh:g,Hl:w}=this;return[e,t,i,s,n,o,a,c,l,h,u,d,f,p,g,w]}set(e,t,i,s,n,o,a,c,l,h,u,d,f,p,g,w){this.Ah=e|0,this.Al=t|0,this.Bh=i|0,this.Bl=s|0,this.Ch=n|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=h|0,this.Fh=u|0,this.Fl=d|0,this.Gh=f|0,this.Gl=p|0,this.Hh=g|0,this.Hl=w|0}process(e,t){for(let E=0;E<16;E++,t+=4)qt[E]=e.getUint32(t),Lt[E]=e.getUint32(t+=4);for(let E=16;E<80;E++){const x=qt[E-15]|0,T=Lt[E-15]|0,v=K.rotrSH(x,T,1)^K.rotrSH(x,T,8)^K.shrSH(x,T,7),I=K.rotrSL(x,T,1)^K.rotrSL(x,T,8)^K.shrSL(x,T,7),$=qt[E-2]|0,D=Lt[E-2]|0,j=K.rotrSH($,D,19)^K.rotrBH($,D,61)^K.shrSH($,D,6),N=K.rotrSL($,D,19)^K.rotrBL($,D,61)^K.shrSL($,D,6),B=K.add4L(I,N,Lt[E-7],Lt[E-16]),z=K.add4H(B,v,j,qt[E-7],qt[E-16]);qt[E]=z|0,Lt[E]=B|0}let{Ah:i,Al:s,Bh:n,Bl:o,Ch:a,Cl:c,Dh:l,Dl:h,Eh:u,El:d,Fh:f,Fl:p,Gh:g,Gl:w,Hh:_,Hl:b}=this;for(let E=0;E<80;E++){const x=K.rotrSH(u,d,14)^K.rotrSH(u,d,18)^K.rotrBH(u,d,41),T=K.rotrSL(u,d,14)^K.rotrSL(u,d,18)^K.rotrBL(u,d,41),v=u&f^~u&g,I=d&p^~d&w,$=K.add5L(b,T,I,Zf[E],Lt[E]),D=K.add5H($,_,x,v,Jf[E],qt[E]),j=$|0,N=K.rotrSH(i,s,28)^K.rotrBH(i,s,34)^K.rotrBH(i,s,39),B=K.rotrSL(i,s,28)^K.rotrBL(i,s,34)^K.rotrBL(i,s,39),z=i&n^i&a^n&a,P=s&o^s&c^o&c;_=g|0,b=w|0,g=f|0,w=p|0,f=u|0,p=d|0,{h:u,l:d}=K.add(l|0,h|0,D|0,j|0),l=a|0,h=c|0,a=n|0,c=o|0,n=i|0,o=s|0;const y=K.add3L(j,B,P);i=K.add3H(y,D,N,z),s=y|0}({h:i,l:s}=K.add(this.Ah|0,this.Al|0,i|0,s|0)),{h:n,l:o}=K.add(this.Bh|0,this.Bl|0,n|0,o|0),{h:a,l:c}=K.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:h}=K.add(this.Dh|0,this.Dl|0,l|0,h|0),{h:u,l:d}=K.add(this.Eh|0,this.El|0,u|0,d|0),{h:f,l:p}=K.add(this.Fh|0,this.Fl|0,f|0,p|0),{h:g,l:w}=K.add(this.Gh|0,this.Gl|0,g|0,w|0),{h:_,l:b}=K.add(this.Hh|0,this.Hl|0,_|0,b|0),this.set(i,s,n,o,a,c,l,h,u,d,f,p,g,w,_,b)}roundClean(){qt.fill(0),Lt.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const Xf=Of(()=>new Qf);const So=BigInt(0),Eh=BigInt(1),eg=BigInt(2);function Do(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Oo(r){if(!Do(r))throw new Error("Uint8Array expected")}function Js(r,e){if(typeof e!="boolean")throw new Error(r+" boolean expected, got "+e)}const tg=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function $o(r){Oo(r);let e="";for(let t=0;t<r.length;t++)e+=tg[r[t]];return e}function _h(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?So:BigInt("0x"+r)}const Ot={_0:48,_9:57,A:65,F:70,a:97,f:102};function Sa(r){if(r>=Ot._0&&r<=Ot._9)return r-Ot._0;if(r>=Ot.A&&r<=Ot.F)return r-(Ot.A-10);if(r>=Ot.a&&r<=Ot.f)return r-(Ot.a-10)}function Ih(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);const e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(t);for(let s=0,n=0;s<t;s++,n+=2){const o=Sa(r.charCodeAt(n)),a=Sa(r.charCodeAt(n+1));if(o===void 0||a===void 0){const c=r[n]+r[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}i[s]=o*16+a}return i}function rg(r){return _h($o(r))}function is(r){return Oo(r),_h($o(Uint8Array.from(r).reverse()))}function Sh(r,e){return Ih(r.toString(16).padStart(e*2,"0"))}function Un(r,e){return Sh(r,e).reverse()}function $t(r,e,t){let i;if(typeof e=="string")try{i=Ih(e)}catch(n){throw new Error(r+" must be hex string or Uint8Array, cause: "+n)}else if(Do(e))i=Uint8Array.from(e);else throw new Error(r+" must be hex string or Uint8Array");const s=i.length;if(typeof t=="number"&&s!==t)throw new Error(r+" of length "+t+" expected, got "+s);return i}function Da(...r){let e=0;for(let i=0;i<r.length;i++){const s=r[i];Oo(s),e+=s.length}const t=new Uint8Array(e);for(let i=0,s=0;i<r.length;i++){const n=r[i];t.set(n,s),s+=n.length}return t}const Zs=r=>typeof r=="bigint"&&So<=r;function ig(r,e,t){return Zs(r)&&Zs(e)&&Zs(t)&&e<=r&&r<t}function oi(r,e,t,i){if(!ig(e,t,i))throw new Error("expected valid "+r+": "+t+" <= n < "+i+", got "+e)}function sg(r){let e;for(e=0;r>So;r>>=Eh,e+=1);return e}const ng=r=>(eg<<BigInt(r-1))-Eh,og={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||Do(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function Po(r,e,t={}){const i=(s,n,o)=>{const a=og[n];if(typeof a!="function")throw new Error("invalid validator function");const c=r[s];if(!(o&&c===void 0)&&!a(c,r))throw new Error("param "+String(s)+" is invalid. Expected "+n+", got "+c)};for(const[s,n]of Object.entries(e))i(s,n,!1);for(const[s,n]of Object.entries(t))i(s,n,!0);return r}function Oa(r){const e=new WeakMap;return(t,...i)=>{const s=e.get(t);if(s!==void 0)return s;const n=r(t,...i);return e.set(t,n),n}}const be=BigInt(0),ce=BigInt(1),tr=BigInt(2),ag=BigInt(3),qn=BigInt(4),$a=BigInt(5),Pa=BigInt(8);function pe(r,e){const t=r%e;return t>=be?t:e+t}function cg(r,e,t){if(e<be)throw new Error("invalid exponent, negatives unsupported");if(t<=be)throw new Error("invalid modulus");if(t===ce)return be;let i=ce;for(;e>be;)e&ce&&(i=i*r%t),r=r*r%t,e>>=ce;return i}function ft(r,e,t){let i=r;for(;e-- >be;)i*=i,i%=t;return i}function xa(r,e){if(r===be)throw new Error("invert: expected non-zero number");if(e<=be)throw new Error("invert: expected positive modulus, got "+e);let t=pe(r,e),i=e,s=be,n=ce;for(;t!==be;){const o=i/t,a=i%t,c=s-n*o;i=t,t=a,s=n,n=c}if(i!==ce)throw new Error("invert: does not exist");return pe(s,e)}function lg(r){const e=(r-ce)/tr;let t,i,s;for(t=r-ce,i=0;t%tr===be;t/=tr,i++);for(s=tr;s<r&&cg(s,e,r)!==r-ce;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(i===1){const o=(r+ce)/qn;return function(a,c){const l=a.pow(c,o);if(!a.eql(a.sqr(l),c))throw new Error("Cannot find square root");return l}}const n=(t+ce)/tr;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=i,l=o.pow(o.mul(o.ONE,s),t),h=o.pow(a,n),u=o.pow(a,t);for(;!o.eql(u,o.ONE);){if(o.eql(u,o.ZERO))return o.ZERO;let d=1;for(let p=o.sqr(u);d<c&&!o.eql(p,o.ONE);d++)p=o.sqr(p);const f=o.pow(l,ce<<BigInt(c-d-1));l=o.sqr(f),h=o.mul(h,f),u=o.mul(u,l),c=d}return h}}function hg(r){if(r%qn===ag){const e=(r+ce)/qn;return function(t,i){const s=t.pow(i,e);if(!t.eql(t.sqr(s),i))throw new Error("Cannot find square root");return s}}if(r%Pa===$a){const e=(r-$a)/Pa;return function(t,i){const s=t.mul(i,tr),n=t.pow(s,e),o=t.mul(i,n),a=t.mul(t.mul(o,tr),n),c=t.mul(o,t.sub(a,t.ONE));if(!t.eql(t.sqr(c),i))throw new Error("Cannot find square root");return c}}return lg(r)}const ug=(r,e)=>(pe(r,e)&ce)===ce,dg=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function pg(r){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=dg.reduce((i,s)=>(i[s]="function",i),e);return Po(r,t)}function fg(r,e,t){if(t<be)throw new Error("invalid exponent, negatives unsupported");if(t===be)return r.ONE;if(t===ce)return e;let i=r.ONE,s=e;for(;t>be;)t&ce&&(i=r.mul(i,s)),s=r.sqr(s),t>>=ce;return i}function gg(r,e){const t=new Array(e.length),i=e.reduce((n,o,a)=>r.is0(o)?n:(t[a]=n,r.mul(n,o)),r.ONE),s=r.inv(i);return e.reduceRight((n,o,a)=>r.is0(o)?n:(t[a]=r.mul(n,t[a]),r.mul(n,o)),s),t}function Dh(r,e){const t=e!==void 0?e:r.toString(2).length,i=Math.ceil(t/8);return{nBitLength:t,nByteLength:i}}function Oh(r,e,t=!1,i={}){if(r<=be)throw new Error("invalid field: expected ORDER > 0, got "+r);const{nBitLength:s,nByteLength:n}=Dh(r,e);if(n>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:r,isLE:t,BITS:s,BYTES:n,MASK:ng(s),ZERO:be,ONE:ce,create:c=>pe(c,r),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return be<=c&&c<r},is0:c=>c===be,isOdd:c=>(c&ce)===ce,neg:c=>pe(-c,r),eql:(c,l)=>c===l,sqr:c=>pe(c*c,r),add:(c,l)=>pe(c+l,r),sub:(c,l)=>pe(c-l,r),mul:(c,l)=>pe(c*l,r),pow:(c,l)=>fg(a,c,l),div:(c,l)=>pe(c*xa(l,r),r),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>xa(c,r),sqrt:i.sqrt||(c=>(o||(o=hg(r)),o(a,c))),invertBatch:c=>gg(a,c),cmov:(c,l,h)=>h?l:c,toBytes:c=>t?Un(c,n):Sh(c,n),fromBytes:c=>{if(c.length!==n)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+c.length);return t?is(c):rg(c)}});return Object.freeze(a)}const Aa=BigInt(0),zi=BigInt(1);function Qs(r,e){const t=e.negate();return r?t:e}function $h(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function Xs(r,e){$h(r,e);const t=Math.ceil(e/r)+1,i=2**(r-1);return{windows:t,windowSize:i}}function yg(r,e){if(!Array.isArray(r))throw new Error("array expected");r.forEach((t,i)=>{if(!(t instanceof e))throw new Error("invalid point at index "+i)})}function mg(r,e){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((t,i)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+i)})}const en=new WeakMap,Ph=new WeakMap;function tn(r){return Ph.get(r)||1}function wg(r,e){return{constTimeNegate:Qs,hasPrecomputes(t){return tn(t)!==1},unsafeLadder(t,i,s=r.ZERO){let n=t;for(;i>Aa;)i&zi&&(s=s.add(n)),n=n.double(),i>>=zi;return s},precomputeWindow(t,i){const{windows:s,windowSize:n}=Xs(i,e),o=[];let a=t,c=a;for(let l=0;l<s;l++){c=a,o.push(c);for(let h=1;h<n;h++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(t,i,s){const{windows:n,windowSize:o}=Xs(t,e);let a=r.ZERO,c=r.BASE;const l=BigInt(2**t-1),h=2**t,u=BigInt(t);for(let d=0;d<n;d++){const f=d*o;let p=Number(s&l);s>>=u,p>o&&(p-=h,s+=zi);const g=f,w=f+Math.abs(p)-1,_=d%2!==0,b=p<0;p===0?c=c.add(Qs(_,i[g])):a=a.add(Qs(b,i[w]))}return{p:a,f:c}},wNAFUnsafe(t,i,s,n=r.ZERO){const{windows:o,windowSize:a}=Xs(t,e),c=BigInt(2**t-1),l=2**t,h=BigInt(t);for(let u=0;u<o;u++){const d=u*a;if(s===Aa)break;let f=Number(s&c);if(s>>=h,f>a&&(f-=l,s+=zi),f===0)continue;let p=i[d+Math.abs(f)-1];f<0&&(p=p.negate()),n=n.add(p)}return n},getPrecomputes(t,i,s){let n=en.get(i);return n||(n=this.precomputeWindow(i,t),t!==1&&en.set(i,s(n))),n},wNAFCached(t,i,s){const n=tn(t);return this.wNAF(n,this.getPrecomputes(n,t,s),i)},wNAFCachedUnsafe(t,i,s,n){const o=tn(t);return o===1?this.unsafeLadder(t,i,n):this.wNAFUnsafe(o,this.getPrecomputes(o,t,s),i,n)},setWindowSize(t,i){$h(i,e),Ph.set(t,i),en.delete(t)}}}function bg(r,e,t,i){if(yg(t,r),mg(i,e),t.length!==i.length)throw new Error("arrays of points and scalars must have equal length");const s=r.ZERO,n=sg(BigInt(t.length)),o=n>12?n-3:n>4?n-2:n?2:1,a=(1<<o)-1,c=new Array(a+1).fill(s),l=Math.floor((e.BITS-1)/o)*o;let h=s;for(let u=l;u>=0;u-=o){c.fill(s);for(let f=0;f<i.length;f++){const p=i[f],g=Number(p>>BigInt(u)&BigInt(a));c[g]=c[g].add(t[f])}let d=s;for(let f=c.length-1,p=s;f>0;f--)p=p.add(c[f]),d=d.add(p);if(h=h.add(d),u!==0)for(let f=0;f<o;f++)h=h.double()}return h}function vg(r){return pg(r.Fp),Po(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Dh(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}const ot=BigInt(0),Be=BigInt(1),Fi=BigInt(2),Eg=BigInt(8),_g={zip215:!0};function Ig(r){const e=vg(r);return Po(r,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function Sg(r){const e=Ig(r),{Fp:t,n:i,prehash:s,hash:n,randomBytes:o,nByteLength:a,h:c}=e,l=Fi<<BigInt(a*8)-Be,h=t.create,u=Oh(e.n,e.nBitLength),d=e.uvRatio||((y,m)=>{try{return{isValid:!0,value:t.sqrt(y*t.inv(m))}}catch{return{isValid:!1,value:ot}}}),f=e.adjustScalarBytes||(y=>y),p=e.domain||((y,m,S)=>{if(Js("phflag",S),m.length||S)throw new Error("Contexts/pre-hash are not supported");return y});function g(y,m){oi("coordinate "+y,m,ot,l)}function w(y){if(!(y instanceof E))throw new Error("ExtendedPoint expected")}const _=Oa((y,m)=>{const{ex:S,ey:A,ez:O}=y,C=y.is0();m==null&&(m=C?Eg:t.inv(O));const L=h(S*m),M=h(A*m),F=h(O*m);if(C)return{x:ot,y:Be};if(F!==Be)throw new Error("invZ was invalid");return{x:L,y:M}}),b=Oa(y=>{const{a:m,d:S}=e;if(y.is0())throw new Error("bad point: ZERO");const{ex:A,ey:O,ez:C,et:L}=y,M=h(A*A),F=h(O*O),k=h(C*C),H=h(k*k),V=h(M*m),ne=h(k*h(V+F)),ee=h(H+h(S*h(M*F)));if(ne!==ee)throw new Error("bad point: equation left != right (1)");const Y=h(A*O),Ae=h(C*L);if(Y!==Ae)throw new Error("bad point: equation left != right (2)");return!0});class E{constructor(m,S,A,O){this.ex=m,this.ey=S,this.ez=A,this.et=O,g("x",m),g("y",S),g("z",A),g("t",O),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(m){if(m instanceof E)throw new Error("extended point not allowed");const{x:S,y:A}=m||{};return g("x",S),g("y",A),new E(S,A,Be,h(S*A))}static normalizeZ(m){const S=t.invertBatch(m.map(A=>A.ez));return m.map((A,O)=>A.toAffine(S[O])).map(E.fromAffine)}static msm(m,S){return bg(E,u,m,S)}_setWindowSize(m){v.setWindowSize(this,m)}assertValidity(){b(this)}equals(m){w(m);const{ex:S,ey:A,ez:O}=this,{ex:C,ey:L,ez:M}=m,F=h(S*M),k=h(C*O),H=h(A*M),V=h(L*O);return F===k&&H===V}is0(){return this.equals(E.ZERO)}negate(){return new E(h(-this.ex),this.ey,this.ez,h(-this.et))}double(){const{a:m}=e,{ex:S,ey:A,ez:O}=this,C=h(S*S),L=h(A*A),M=h(Fi*h(O*O)),F=h(m*C),k=S+A,H=h(h(k*k)-C-L),V=F+L,ne=V-M,ee=F-L,Y=h(H*ne),Ae=h(V*ee),_e=h(H*ee),Te=h(ne*V);return new E(Y,Ae,Te,_e)}add(m){w(m);const{a:S,d:A}=e,{ex:O,ey:C,ez:L,et:M}=this,{ex:F,ey:k,ez:H,et:V}=m;if(S===BigInt(-1)){const Vo=h((C-O)*(k+F)),Ko=h((C+O)*(k-F)),Ms=h(Ko-Vo);if(Ms===ot)return this.double();const Wo=h(L*Fi*V),Go=h(M*Fi*H),Yo=Go+Wo,Jo=Ko+Vo,Zo=Go-Wo,Pd=h(Yo*Ms),xd=h(Jo*Zo),Ad=h(Yo*Zo),Cd=h(Ms*Jo);return new E(Pd,xd,Cd,Ad)}const ne=h(O*F),ee=h(C*k),Y=h(M*A*V),Ae=h(L*H),_e=h((O+C)*(F+k)-ne-ee),Te=Ae-Y,Ze=Ae+Y,St=h(ee-S*ne),mr=h(_e*Te),Dd=h(Ze*St),Od=h(_e*St),$d=h(Te*Ze);return new E(mr,Dd,$d,Od)}subtract(m){return this.add(m.negate())}wNAF(m){return v.wNAFCached(this,m,E.normalizeZ)}multiply(m){const S=m;oi("scalar",S,Be,i);const{p:A,f:O}=this.wNAF(S);return E.normalizeZ([A,O])[0]}multiplyUnsafe(m,S=E.ZERO){const A=m;return oi("scalar",A,ot,i),A===ot?T:this.is0()||A===Be?this:v.wNAFCachedUnsafe(this,A,E.normalizeZ,S)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return v.unsafeLadder(this,i).is0()}toAffine(m){return _(this,m)}clearCofactor(){const{h:m}=e;return m===Be?this:this.multiplyUnsafe(m)}static fromHex(m,S=!1){const{d:A,a:O}=e,C=t.BYTES;m=$t("pointHex",m,C),Js("zip215",S);const L=m.slice(),M=m[C-1];L[C-1]=M&-129;const F=is(L),k=S?l:t.ORDER;oi("pointHex.y",F,ot,k);const H=h(F*F),V=h(H-Be),ne=h(A*H-O);let{isValid:ee,value:Y}=d(V,ne);if(!ee)throw new Error("Point.fromHex: invalid y coordinate");const Ae=(Y&Be)===Be,_e=(M&128)!==0;if(!S&&Y===ot&&_e)throw new Error("Point.fromHex: x=0 and x_0=1");return _e!==Ae&&(Y=h(-Y)),E.fromAffine({x:Y,y:F})}static fromPrivateKey(m){return D(m).point}toRawBytes(){const{x:m,y:S}=this.toAffine(),A=Un(S,t.BYTES);return A[A.length-1]|=m&Be?128:0,A}toHex(){return $o(this.toRawBytes())}}E.BASE=new E(e.Gx,e.Gy,Be,h(e.Gx*e.Gy)),E.ZERO=new E(ot,Be,Be,ot);const{BASE:x,ZERO:T}=E,v=wg(E,a*8);function I(y){return pe(y,i)}function $(y){return I(is(y))}function D(y){const m=t.BYTES;y=$t("private key",y,m);const S=$t("hashed private key",n(y),2*m),A=f(S.slice(0,m)),O=S.slice(m,2*m),C=$(A),L=x.multiply(C),M=L.toRawBytes();return{head:A,prefix:O,scalar:C,point:L,pointBytes:M}}function j(y){return D(y).pointBytes}function N(y=new Uint8Array,...m){const S=Da(...m);return $(n(p(S,$t("context",y),!!s)))}function B(y,m,S={}){y=$t("message",y),s&&(y=s(y));const{prefix:A,scalar:O,pointBytes:C}=D(m),L=N(S.context,A,y),M=x.multiply(L).toRawBytes(),F=N(S.context,M,C,y),k=I(L+F*O);oi("signature.s",k,ot,i);const H=Da(M,Un(k,t.BYTES));return $t("result",H,t.BYTES*2)}const z=_g;function P(y,m,S,A=z){const{context:O,zip215:C}=A,L=t.BYTES;y=$t("signature",y,2*L),m=$t("message",m),S=$t("publicKey",S,L),C!==void 0&&Js("zip215",C),s&&(m=s(m));const M=is(y.slice(L,2*L));let F,k,H;try{F=E.fromHex(S,C),k=E.fromHex(y.slice(0,L),C),H=x.multiplyUnsafe(M)}catch{return!1}if(!C&&F.isSmallOrder())return!1;const V=N(O,k.toRawBytes(),F.toRawBytes(),m);return k.add(F.multiplyUnsafe(V)).subtract(H).clearCofactor().equals(E.ZERO)}return x._setWindowSize(8),{CURVE:e,getPublicKey:j,sign:B,verify:P,ExtendedPoint:E,utils:{getExtendedPublicKey:D,randomPrivateKey:()=>o(t.BYTES),precompute(y=8,m=E.BASE){return m._setWindowSize(y),m.multiply(BigInt(3)),m}}}}BigInt(0),BigInt(1);const xo=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Ca=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const Dg=BigInt(1),Ta=BigInt(2);BigInt(3);const Og=BigInt(5),$g=BigInt(8);function Pg(r){const e=BigInt(10),t=BigInt(20),i=BigInt(40),s=BigInt(80),n=xo,o=r*r%n*r%n,a=ft(o,Ta,n)*o%n,c=ft(a,Dg,n)*r%n,l=ft(c,Og,n)*c%n,h=ft(l,e,n)*l%n,u=ft(h,t,n)*h%n,d=ft(u,i,n)*u%n,f=ft(d,s,n)*d%n,p=ft(f,s,n)*d%n,g=ft(p,e,n)*l%n;return{pow_p_5_8:ft(g,Ta,n)*r%n,b2:o}}function xg(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function Ag(r,e){const t=xo,i=pe(e*e*e,t),s=pe(i*i*e,t),n=Pg(r*s).pow_p_5_8;let o=pe(r*i*n,t);const a=pe(e*o*o,t),c=o,l=pe(o*Ca,t),h=a===r,u=a===pe(-r,t),d=a===pe(-r*Ca,t);return h&&(o=c),(u||d)&&(o=l),ug(o,t)&&(o=pe(-o,t)),{isValid:h||u,value:o}}const Cg=Oh(xo,void 0,!0),Tg={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:Cg,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:$g,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Xf,randomBytes:bh,adjustScalarBytes:xg,uvRatio:Ag},xh=Sg(Tg),Rg="EdDSA",Ng="JWT",us=".",Ss="base64url",Ah="utf8",Ch="utf8",jg=":",Bg="did",Ug="key",Ra="base58btc",qg="z",Lg="K36",kg=32;function Ao(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function Th(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Ao(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function Rh(r,e){e||(e=r.reduce((s,n)=>s+n.length,0));const t=Th(e);let i=0;for(const s of r)t.set(s,i),i+=s.length;return Ao(t)}function Mg(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var s=0;s<r.length;s++){var n=r.charAt(s),o=n.charCodeAt(0);if(t[o]!==255)throw new TypeError(n+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function u(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,w=0,_=0,b=p.length;_!==b&&p[_]===0;)_++,g++;for(var E=(b-_)*h+1>>>0,x=new Uint8Array(E);_!==b;){for(var T=p[_],v=0,I=E-1;(T!==0||v<w)&&I!==-1;I--,v++)T+=256*x[I]>>>0,x[I]=T%a>>>0,T=T/a>>>0;if(T!==0)throw new Error("Non-zero carry");w=v,_++}for(var $=E-w;$!==E&&x[$]===0;)$++;for(var D=c.repeat(g);$<E;++$)D+=r.charAt(x[$]);return D}function d(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var w=0,_=0;p[g]===c;)w++,g++;for(var b=(p.length-g)*l+1>>>0,E=new Uint8Array(b);p[g];){var x=t[p.charCodeAt(g)];if(x===255)return;for(var T=0,v=b-1;(x!==0||T<_)&&v!==-1;v--,T++)x+=a*E[v]>>>0,E[v]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");_=T,g++}if(p[g]!==" "){for(var I=b-_;I!==b&&E[I]===0;)I++;for(var $=new Uint8Array(w+(b-I)),D=w;I!==b;)$[D++]=E[I++];return $}}}function f(p){var g=d(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:u,decodeUnsafe:d,decode:f}}var zg=Mg,Fg=zg;const Nh=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},Hg=r=>new TextEncoder().encode(r),Vg=r=>new TextDecoder().decode(r);let Kg=class{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Wg=class{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return jh(this,e)}},Gg=class{constructor(e){this.decoders=e}or(e){return jh(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const jh=(r,e)=>new Gg({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let Yg=class{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new Kg(e,t,i),this.decoder=new Wg(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const Ds=({name:r,prefix:e,encode:t,decode:i})=>new Yg(r,e,t,i),xi=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:s}=Fg(t,e);return Ds({prefix:r,name:e,encode:i,decode:n=>Nh(s(n))})},Jg=(r,e,t,i)=>{const s={};for(let h=0;h<e.length;++h)s[e[h]]=h;let n=r.length;for(;r[n-1]==="=";)--n;const o=new Uint8Array(n*t/8|0);let a=0,c=0,l=0;for(let h=0;h<n;++h){const u=s[r[h]];if(u===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<t|u,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Zg=(r,e,t)=>{const i=e[e.length-1]==="=",s=(1<<t)-1;let n="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,n+=e[s&a>>o];if(o&&(n+=e[s&a<<t-o]),i)for(;n.length*t&7;)n+="=";return n},$e=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>Ds({prefix:e,name:r,encode(s){return Zg(s,i,t)},decode(s){return Jg(s,i,t,r)}}),Qg=Ds({prefix:"\0",name:"identity",encode:r=>Vg(r),decode:r=>Hg(r)});var Xg=Object.freeze({__proto__:null,identity:Qg});const ey=$e({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var ty=Object.freeze({__proto__:null,base2:ey});const ry=$e({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var iy=Object.freeze({__proto__:null,base8:ry});const sy=xi({prefix:"9",name:"base10",alphabet:"0123456789"});var ny=Object.freeze({__proto__:null,base10:sy});const oy=$e({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),ay=$e({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var cy=Object.freeze({__proto__:null,base16:oy,base16upper:ay});const ly=$e({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),hy=$e({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),uy=$e({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),dy=$e({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),py=$e({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),fy=$e({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),gy=$e({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),yy=$e({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),my=$e({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var wy=Object.freeze({__proto__:null,base32:ly,base32upper:hy,base32pad:uy,base32padupper:dy,base32hex:py,base32hexupper:fy,base32hexpad:gy,base32hexpadupper:yy,base32z:my});const by=xi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),vy=xi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Ey=Object.freeze({__proto__:null,base36:by,base36upper:vy});const _y=xi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Iy=xi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Sy=Object.freeze({__proto__:null,base58btc:_y,base58flickr:Iy});const Dy=$e({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Oy=$e({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),$y=$e({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Py=$e({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var xy=Object.freeze({__proto__:null,base64:Dy,base64pad:Oy,base64url:$y,base64urlpad:Py});const Bh=Array.from("\uD83D\uDE80\uD83E\uDE90\uD83D\uDEF0\uD83C\uDF0C\uD83C\uDF11\uD83C\uDF12\uD83C\uDF13\uD83C\uDF14\uD83C\uDF15\uD83C\uDF16\uD83C\uDF17\uD83C\uDF18\uD83C\uDF0D\uD83C\uDF0F\uD83C\uDF0E\uD83D\uDC09\uD83D\uDCBB\uD83D\uDDA5\uD83D\uDCBE\uD83D\uDCBF\uD83D\uDE02\uD83D\uDE0D\uD83E\uDD23\uD83D\uDE0A\uD83D\uDE4F\uD83D\uDC95\uD83D\uDE2D\uD83D\uDE18\uD83D\uDC4D\uD83D\uDE05\uD83D\uDC4F\uD83D\uDE01\uD83D\uDD25\uD83E\uDD70\uD83D\uDC94\uD83D\uDC96\uD83D\uDC99\uD83D\uDE22\uD83E\uDD14\uD83D\uDE06\uD83D\uDE44\uD83D\uDCAA\uD83D\uDE09\uD83D\uDC4C\uD83E\uDD17\uD83D\uDC9C\uD83D\uDE14\uD83D\uDE0E\uD83D\uDE07\uD83C\uDF39\uD83E\uDD26\uD83C\uDF89\uD83D\uDC9E\uD83E\uDD37\uD83D\uDE31\uD83D\uDE0C\uD83C\uDF38\uD83D\uDE4C\uD83D\uDE0B\uD83D\uDC97\uD83D\uDC9A\uD83D\uDE0F\uD83D\uDC9B\uD83D\uDE42\uD83D\uDC93\uD83E\uDD29\uD83D\uDE04\uD83D\uDE00\uD83D\uDDA4\uD83D\uDE03\uD83D\uDCAF\uD83D\uDE48\uD83D\uDC47\uD83C\uDFB6\uD83D\uDE12\uD83E\uDD2D\uD83D\uDE1C\uD83D\uDC8B\uD83D\uDC40\uD83D\uDE2A\uD83D\uDE11\uD83D\uDCA5\uD83D\uDE4B\uD83D\uDE1E\uD83D\uDE29\uD83D\uDE21\uD83E\uDD2A\uD83D\uDC4A\uD83E\uDD73\uD83D\uDE25\uD83E\uDD24\uD83D\uDC49\uD83D\uDC83\uD83D\uDE33\uD83D\uDE1A\uD83D\uDE1D\uD83D\uDE34\uD83C\uDF1F\uD83D\uDE2C\uD83D\uDE43\uD83C\uDF40\uD83C\uDF37\uD83D\uDE3B\uD83D\uDE13\uD83E\uDD7A\uD83C\uDF08\uD83D\uDE08\uD83E\uDD18\uD83D\uDCA6\uD83D\uDE23\uD83C\uDFC3\uD83D\uDC90\uD83C\uDF8A\uD83D\uDC98\uD83D\uDE20\uD83D\uDE15\uD83C\uDF3A\uD83C\uDF82\uD83C\uDF3B\uD83D\uDE10\uD83D\uDD95\uD83D\uDC9D\uD83D\uDE4A\uD83D\uDE39\uD83D\uDDE3\uD83D\uDCAB\uD83D\uDC80\uD83D\uDC51\uD83C\uDFB5\uD83E\uDD1E\uD83D\uDE1B\uD83D\uDD34\uD83D\uDE24\uD83C\uDF3C\uD83D\uDE2B\uD83E\uDD19\uD83C\uDFC6\uD83E\uDD2B\uD83D\uDC48\uD83D\uDE2E\uD83D\uDE46\uD83C\uDF7B\uD83C\uDF43\uD83D\uDC36\uD83D\uDC81\uD83D\uDE32\uD83C\uDF3F\uD83E\uDDE1\uD83C\uDF81\uD83C\uDF1E\uD83C\uDF88\uD83D\uDC4B\uD83D\uDE30\uD83E\uDD28\uD83D\uDE36\uD83E\uDD1D\uD83D\uDEB6\uD83D\uDCB0\uD83C\uDF53\uD83D\uDCA2\uD83E\uDD1F\uD83D\uDE41\uD83D\uDEA8\uD83D\uDCA8\uD83E\uDD2C\uD83C\uDF80\uD83C\uDF7A\uD83E\uDD13\uD83D\uDE19\uD83D\uDC9F\uD83C\uDF31\uD83D\uDE16\uD83D\uDC76\uD83E\uDD74\uD83D\uDC8E\uD83D\uDCB8\uD83D\uDE28\uD83C\uDF1A\uD83E\uDD8B\uD83D\uDE37\uD83D\uDD7A\uD83D\uDE45\uD83D\uDE1F\uD83D\uDE35\uD83D\uDC4E\uD83E\uDD32\uD83E\uDD20\uD83E\uDD27\uD83D\uDCCC\uD83D\uDD35\uD83D\uDC85\uD83E\uDDD0\uD83D\uDC3E\uD83C\uDF52\uD83D\uDE17\uD83E\uDD11\uD83C\uDF0A\uD83E\uDD2F\uD83D\uDC37\uD83D\uDCA7\uD83D\uDE2F\uD83D\uDC86\uD83D\uDC46\uD83C\uDFA4\uD83D\uDE47\uD83C\uDF51\uD83C\uDF34\uD83D\uDCA3\uD83D\uDC38\uD83D\uDC8C\uD83D\uDCCD\uD83E\uDD40\uD83E\uDD22\uD83D\uDC45\uD83D\uDCA1\uD83D\uDCA9\uD83D\uDC50\uD83D\uDCF8\uD83D\uDC7B\uD83E\uDD10\uD83E\uDD2E\uD83C\uDFBC\uD83E\uDD75\uD83D\uDEA9\uD83C\uDF4E\uD83C\uDF4A\uD83D\uDC7C\uD83D\uDC8D\uD83D\uDCE3\uD83E\uDD42"),Ay=Bh.reduce((r,e,t)=>(r[t]=e,r),[]),Cy=Bh.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function Ty(r){return r.reduce((e,t)=>(e+=Ay[t],e),"")}function Ry(r){const e=[];for(const t of r){const i=Cy[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const Ny=Ds({prefix:"\uD83D\uDE80",name:"base256emoji",encode:Ty,decode:Ry});var jy=Object.freeze({__proto__:null,base256emoji:Ny}),By=Uh,Na=128,Uy=-128,qy=Math.pow(2,31);function Uh(r,e,t){e=e||[],t=t||0;for(var i=t;r>=qy;)e[t++]=r&255|Na,r/=128;for(;r&Uy;)e[t++]=r&255|Na,r>>>=7;return e[t]=r|0,Uh.bytes=t-i+1,e}var Ly=Ln,ky=128,ja=127;function Ln(r,i){var t=0,i=i||0,s=0,n=i,o,a=r.length;do{if(n>=a)throw Ln.bytes=0,new RangeError("Could not decode varint");o=r[n++],t+=s<28?(o&ja)<<s:(o&ja)*Math.pow(2,s),s+=7}while(o>=ky);return Ln.bytes=n-i,t}var My=Math.pow(2,7),zy=Math.pow(2,14),Fy=Math.pow(2,21),Hy=Math.pow(2,28),Vy=Math.pow(2,35),Ky=Math.pow(2,42),Wy=Math.pow(2,49),Gy=Math.pow(2,56),Yy=Math.pow(2,63),Jy=function(r){return r<My?1:r<zy?2:r<Fy?3:r<Hy?4:r<Vy?5:r<Ky?6:r<Wy?7:r<Gy?8:r<Yy?9:10},Zy={encode:By,decode:Ly,encodingLength:Jy},qh=Zy;const Ba=(r,e,t=0)=>(qh.encode(r,e,t),e),Ua=r=>qh.encodingLength(r),kn=(r,e)=>{const t=e.byteLength,i=Ua(r),s=i+Ua(t),n=new Uint8Array(s+t);return Ba(r,n,0),Ba(t,n,i),n.set(e,s),new Qy(r,t,e,n)};let Qy=class{constructor(e,t,i,s){this.code=e,this.size=t,this.digest=i,this.bytes=s}};const Lh=({name:r,code:e,encode:t})=>new Xy(r,e,t);let Xy=class{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?kn(this.code,t):t.then(i=>kn(this.code,i))}else throw Error("Unknown type, must be binary type")}};const kh=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),em=Lh({name:"sha2-256",code:18,encode:kh("SHA-256")}),tm=Lh({name:"sha2-512",code:19,encode:kh("SHA-512")});var rm=Object.freeze({__proto__:null,sha256:em,sha512:tm});const Mh=0,im="identity",zh=Nh,sm=r=>kn(Mh,zh(r)),nm={code:Mh,name:im,encode:zh,digest:sm};var om=Object.freeze({__proto__:null,identity:nm});new TextEncoder,new TextDecoder;const qa={...Xg,...ty,...iy,...ny,...cy,...wy,...Ey,...Sy,...xy,...jy};({...rm,...om});function Fh(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const La=Fh("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),rn=Fh("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=Th(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),Hh={utf8:La,"utf-8":La,hex:qa.base16,latin1:rn,ascii:rn,binary:rn,...qa};function Os(r,e="utf8"){const t=Hh[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}function Zr(r,e="utf8"){const t=Hh[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Ao(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}function ka(r){return lr(Os(Zr(r,Ss),Ah))}function ds(r){return Os(Zr(Ut(r),Ah),Ss)}Vh=function(r){const e=Zr(Lg,Ra),t=qg+Os(Rh([e,r]),Ra);return[Bg,Ug,t].join(jg)};function am(r){return Os(r,Ss)}function cm(r){return Zr(r,Ss)}function lm(r){return Zr([ds(r.header),ds(r.payload)].join(us),Ch)}function hm(r){return[ds(r.header),ds(r.payload),am(r.signature)].join(us)}Mn=function(r){const e=r.split(us),t=ka(e[0]),i=ka(e[1]),s=cm(e[2]),n=Zr(e.slice(0,2).join(us),Ch);return{header:t,payload:i,signature:s,data:n}};Ma=function(r=bh(kg)){const e=xh.getPublicKey(r);return{secretKey:Rh([r,e]),publicKey:e}};um=async function(r,e,t,i,s=U.fromMiliseconds(Date.now())){const n={alg:Rg,typ:Ng},o=Vh(i.publicKey),a=s+t,c={iss:o,sub:r,aud:e,iat:s,exp:a},l=lm({header:n,payload:c}),h=xh.sign(l,i.secretKey.slice(0,32));return hm({header:n,payload:c,signature:h})};function Kh(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}yi=function(r,e){e||(e=r.reduce((s,n)=>s+n.length,0));const t=Kh(e);let i=0;for(const s of r)t.set(s,i),i+=s.length;return t};function dm(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var s=0;s<r.length;s++){var n=r.charAt(s),o=n.charCodeAt(0);if(t[o]!==255)throw new TypeError(n+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function u(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,w=0,_=0,b=p.length;_!==b&&p[_]===0;)_++,g++;for(var E=(b-_)*h+1>>>0,x=new Uint8Array(E);_!==b;){for(var T=p[_],v=0,I=E-1;(T!==0||v<w)&&I!==-1;I--,v++)T+=256*x[I]>>>0,x[I]=T%a>>>0,T=T/a>>>0;if(T!==0)throw new Error("Non-zero carry");w=v,_++}for(var $=E-w;$!==E&&x[$]===0;)$++;for(var D=c.repeat(g);$<E;++$)D+=r.charAt(x[$]);return D}function d(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var w=0,_=0;p[g]===c;)w++,g++;for(var b=(p.length-g)*l+1>>>0,E=new Uint8Array(b);p[g];){var x=t[p.charCodeAt(g)];if(x===255)return;for(var T=0,v=b-1;(x!==0||T<_)&&v!==-1;v--,T++)x+=a*E[v]>>>0,E[v]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");_=T,g++}if(p[g]!==" "){for(var I=b-_;I!==b&&E[I]===0;)I++;for(var $=new Uint8Array(w+(b-I)),D=w;I!==b;)$[D++]=E[I++];return $}}}function f(p){var g=d(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:u,decodeUnsafe:d,decode:f}}var pm=dm,fm=pm;const gm=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},ym=r=>new TextEncoder().encode(r),mm=r=>new TextDecoder().decode(r);class wm{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class bm{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Wh(this,e)}}class vm{constructor(e){this.decoders=e}or(e){return Wh(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Wh=(r,e)=>new vm({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class Em{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new wm(e,t,i),this.decoder=new bm(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const $s=({name:r,prefix:e,encode:t,decode:i})=>new Em(r,e,t,i),Ai=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:s}=fm(t,e);return $s({prefix:r,name:e,encode:i,decode:n=>gm(s(n))})},_m=(r,e,t,i)=>{const s={};for(let h=0;h<e.length;++h)s[e[h]]=h;let n=r.length;for(;r[n-1]==="=";)--n;const o=new Uint8Array(n*t/8|0);let a=0,c=0,l=0;for(let h=0;h<n;++h){const u=s[r[h]];if(u===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<t|u,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Im=(r,e,t)=>{const i=e[e.length-1]==="=",s=(1<<t)-1;let n="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,n+=e[s&a>>o];if(o&&(n+=e[s&a<<t-o]),i)for(;n.length*t&7;)n+="=";return n},Pe=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>$s({prefix:e,name:r,encode(s){return Im(s,i,t)},decode(s){return _m(s,i,t,r)}}),Sm=$s({prefix:"\0",name:"identity",encode:r=>mm(r),decode:r=>ym(r)}),Dm=Object.freeze(Object.defineProperty({__proto__:null,identity:Sm},Symbol.toStringTag,{value:"Module"})),Om=Pe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),$m=Object.freeze(Object.defineProperty({__proto__:null,base2:Om},Symbol.toStringTag,{value:"Module"})),Pm=Pe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),xm=Object.freeze(Object.defineProperty({__proto__:null,base8:Pm},Symbol.toStringTag,{value:"Module"})),Am=Ai({prefix:"9",name:"base10",alphabet:"0123456789"}),Cm=Object.freeze(Object.defineProperty({__proto__:null,base10:Am},Symbol.toStringTag,{value:"Module"})),Tm=Pe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Rm=Pe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Nm=Object.freeze(Object.defineProperty({__proto__:null,base16:Tm,base16upper:Rm},Symbol.toStringTag,{value:"Module"})),jm=Pe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Bm=Pe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Um=Pe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),qm=Pe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Lm=Pe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),km=Pe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Mm=Pe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),zm=Pe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Fm=Pe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Hm=Object.freeze(Object.defineProperty({__proto__:null,base32:jm,base32hex:Lm,base32hexpad:Mm,base32hexpadupper:zm,base32hexupper:km,base32pad:Um,base32padupper:qm,base32upper:Bm,base32z:Fm},Symbol.toStringTag,{value:"Module"})),Vm=Ai({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Km=Ai({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Wm=Object.freeze(Object.defineProperty({__proto__:null,base36:Vm,base36upper:Km},Symbol.toStringTag,{value:"Module"})),Gm=Ai({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Ym=Ai({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Jm=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Gm,base58flickr:Ym},Symbol.toStringTag,{value:"Module"})),Zm=Pe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Qm=Pe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Xm=Pe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),ew=Pe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),tw=Object.freeze(Object.defineProperty({__proto__:null,base64:Zm,base64pad:Qm,base64url:Xm,base64urlpad:ew},Symbol.toStringTag,{value:"Module"})),Gh=Array.from("\uD83D\uDE80\uD83E\uDE90\uD83D\uDEF0\uD83C\uDF0C\uD83C\uDF11\uD83C\uDF12\uD83C\uDF13\uD83C\uDF14\uD83C\uDF15\uD83C\uDF16\uD83C\uDF17\uD83C\uDF18\uD83C\uDF0D\uD83C\uDF0F\uD83C\uDF0E\uD83D\uDC09\uD83D\uDCBB\uD83D\uDDA5\uD83D\uDCBE\uD83D\uDCBF\uD83D\uDE02\uD83D\uDE0D\uD83E\uDD23\uD83D\uDE0A\uD83D\uDE4F\uD83D\uDC95\uD83D\uDE2D\uD83D\uDE18\uD83D\uDC4D\uD83D\uDE05\uD83D\uDC4F\uD83D\uDE01\uD83D\uDD25\uD83E\uDD70\uD83D\uDC94\uD83D\uDC96\uD83D\uDC99\uD83D\uDE22\uD83E\uDD14\uD83D\uDE06\uD83D\uDE44\uD83D\uDCAA\uD83D\uDE09\uD83D\uDC4C\uD83E\uDD17\uD83D\uDC9C\uD83D\uDE14\uD83D\uDE0E\uD83D\uDE07\uD83C\uDF39\uD83E\uDD26\uD83C\uDF89\uD83D\uDC9E\uD83E\uDD37\uD83D\uDE31\uD83D\uDE0C\uD83C\uDF38\uD83D\uDE4C\uD83D\uDE0B\uD83D\uDC97\uD83D\uDC9A\uD83D\uDE0F\uD83D\uDC9B\uD83D\uDE42\uD83D\uDC93\uD83E\uDD29\uD83D\uDE04\uD83D\uDE00\uD83D\uDDA4\uD83D\uDE03\uD83D\uDCAF\uD83D\uDE48\uD83D\uDC47\uD83C\uDFB6\uD83D\uDE12\uD83E\uDD2D\uD83D\uDE1C\uD83D\uDC8B\uD83D\uDC40\uD83D\uDE2A\uD83D\uDE11\uD83D\uDCA5\uD83D\uDE4B\uD83D\uDE1E\uD83D\uDE29\uD83D\uDE21\uD83E\uDD2A\uD83D\uDC4A\uD83E\uDD73\uD83D\uDE25\uD83E\uDD24\uD83D\uDC49\uD83D\uDC83\uD83D\uDE33\uD83D\uDE1A\uD83D\uDE1D\uD83D\uDE34\uD83C\uDF1F\uD83D\uDE2C\uD83D\uDE43\uD83C\uDF40\uD83C\uDF37\uD83D\uDE3B\uD83D\uDE13\uD83E\uDD7A\uD83C\uDF08\uD83D\uDE08\uD83E\uDD18\uD83D\uDCA6\uD83D\uDE23\uD83C\uDFC3\uD83D\uDC90\uD83C\uDF8A\uD83D\uDC98\uD83D\uDE20\uD83D\uDE15\uD83C\uDF3A\uD83C\uDF82\uD83C\uDF3B\uD83D\uDE10\uD83D\uDD95\uD83D\uDC9D\uD83D\uDE4A\uD83D\uDE39\uD83D\uDDE3\uD83D\uDCAB\uD83D\uDC80\uD83D\uDC51\uD83C\uDFB5\uD83E\uDD1E\uD83D\uDE1B\uD83D\uDD34\uD83D\uDE24\uD83C\uDF3C\uD83D\uDE2B\uD83E\uDD19\uD83C\uDFC6\uD83E\uDD2B\uD83D\uDC48\uD83D\uDE2E\uD83D\uDE46\uD83C\uDF7B\uD83C\uDF43\uD83D\uDC36\uD83D\uDC81\uD83D\uDE32\uD83C\uDF3F\uD83E\uDDE1\uD83C\uDF81\uD83C\uDF1E\uD83C\uDF88\uD83D\uDC4B\uD83D\uDE30\uD83E\uDD28\uD83D\uDE36\uD83E\uDD1D\uD83D\uDEB6\uD83D\uDCB0\uD83C\uDF53\uD83D\uDCA2\uD83E\uDD1F\uD83D\uDE41\uD83D\uDEA8\uD83D\uDCA8\uD83E\uDD2C\uD83C\uDF80\uD83C\uDF7A\uD83E\uDD13\uD83D\uDE19\uD83D\uDC9F\uD83C\uDF31\uD83D\uDE16\uD83D\uDC76\uD83E\uDD74\uD83D\uDC8E\uD83D\uDCB8\uD83D\uDE28\uD83C\uDF1A\uD83E\uDD8B\uD83D\uDE37\uD83D\uDD7A\uD83D\uDE45\uD83D\uDE1F\uD83D\uDE35\uD83D\uDC4E\uD83E\uDD32\uD83E\uDD20\uD83E\uDD27\uD83D\uDCCC\uD83D\uDD35\uD83D\uDC85\uD83E\uDDD0\uD83D\uDC3E\uD83C\uDF52\uD83D\uDE17\uD83E\uDD11\uD83C\uDF0A\uD83E\uDD2F\uD83D\uDC37\uD83D\uDCA7\uD83D\uDE2F\uD83D\uDC86\uD83D\uDC46\uD83C\uDFA4\uD83D\uDE47\uD83C\uDF51\uD83C\uDF34\uD83D\uDCA3\uD83D\uDC38\uD83D\uDC8C\uD83D\uDCCD\uD83E\uDD40\uD83E\uDD22\uD83D\uDC45\uD83D\uDCA1\uD83D\uDCA9\uD83D\uDC50\uD83D\uDCF8\uD83D\uDC7B\uD83E\uDD10\uD83E\uDD2E\uD83C\uDFBC\uD83E\uDD75\uD83D\uDEA9\uD83C\uDF4E\uD83C\uDF4A\uD83D\uDC7C\uD83D\uDC8D\uD83D\uDCE3\uD83E\uDD42"),rw=Gh.reduce((r,e,t)=>(r[t]=e,r),[]),iw=Gh.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function sw(r){return r.reduce((e,t)=>(e+=rw[t],e),"")}function nw(r){const e=[];for(const t of r){const i=iw[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const ow=$s({prefix:"\uD83D\uDE80",name:"base256emoji",encode:sw,decode:nw}),aw=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:ow},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const za={...Dm,...$m,...xm,...Cm,...Nm,...Hm,...Wm,...Jm,...tw,...aw};function Yh(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const Fa=Yh("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),sn=Yh("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=Kh(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),Jh={utf8:Fa,"utf-8":Fa,hex:za.base16,latin1:sn,ascii:sn,binary:sn,...za};rt=function(r,e="utf8"){const t=Jh[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r,"utf8"):t.decoder.decode(`${t.prefix}${r}`)};Me=function(r,e="utf8"){const t=Jh[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)};cw={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var lw={};const hw=":";function Mr(r){const[e,t]=r.split(hw);return{namespace:e,reference:t}}function Ha(r,e=[]){const t=[];return Object.keys(r).forEach(i=>{if(e.length&&!e.includes(i))return;const s=r[i];t.push(...s.accounts)}),t}function Zh(r,e){return r.includes(":")?[r]:e.chains||[]}var uw=Object.defineProperty,dw=Object.defineProperties,pw=Object.getOwnPropertyDescriptors,Va=Object.getOwnPropertySymbols,fw=Object.prototype.hasOwnProperty,gw=Object.prototype.propertyIsEnumerable,Ka=(r,e,t)=>e in r?uw(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Wa=(r,e)=>{for(var t in e||(e={}))fw.call(e,t)&&Ka(r,t,e[t]);if(Va)for(var t of Va(e))gw.call(e,t)&&Ka(r,t,e[t]);return r},yw=(r,e)=>dw(r,pw(e));const mw="ReactNative",Ge={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},ww="js";function ps(){return typeof it<"u"&&typeof it.versions<"u"&&typeof it.versions.node<"u"}function Gt(){return!Bt.getDocument()&&!!Bt.getNavigator()&&navigator.product===mw}function bw(){return Gt()&&typeof globalThis<"u"&&typeof globalThis?.Platform<"u"&&globalThis?.Platform.OS==="android"}function vw(){return Gt()&&typeof globalThis<"u"&&typeof globalThis?.Platform<"u"&&globalThis?.Platform.OS==="ios"}function Qr(){return!ps()&&!!Bt.getNavigator()&&!!Bt.getDocument()}function Ci(){return Gt()?Ge.reactNative:ps()?Ge.node:Qr()?Ge.browser:Ge.unknown}function Ga(){var r;try{return Gt()&&typeof globalThis<"u"&&typeof globalThis?.Application<"u"?(r=globalThis.Application)==null?void 0:r.applicationId:void 0}catch{return}}function Ew(r,e){const t=new URLSearchParams(r);for(const i of Object.keys(e).sort())if(e.hasOwnProperty(i)){const s=e[i];s!==void 0&&t.set(i,s)}return t.toString()}function _w(r){var e,t;const i=Qh();try{return r!=null&&r.url&&i.url&&new URL(r.url).host!==new URL(i.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${r.url} differs from the actual page url:${i.url}. This is probably unintended and can lead to issues.`),r.url=i.url),(e=r?.icons)!=null&&e.length&&r.icons.length>0&&(r.icons=r.icons.filter(s=>s!=="")),yw(Wa(Wa({},i),r),{url:r?.url||i.url,name:r?.name||i.name,description:r?.description||i.description,icons:(t=r?.icons)!=null&&t.length&&r.icons.length>0?r.icons:i.icons})}catch(s){return console.warn("Error populating app metadata",s),r||i}}function Qh(){return Cp.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function Iw(){if(Ci()===Ge.reactNative&&typeof globalThis<"u"&&typeof globalThis?.Platform<"u"){const{OS:t,Version:i}=globalThis.Platform;return[t,i].join("-")}const r=Yd();if(r===null)return"unknown";const e=r.os?r.os.replace(" ","").toLowerCase():"unknown";return r.type==="browser"?[e,r.name,r.version].join("-"):[e,r.version].join("-")}function Sw(){var r;const e=Ci();return e===Ge.browser?[e,((r=Bt.getLocation())==null?void 0:r.host)||"unknown"].join(":"):e}function Xh(r,e,t){const i=Iw(),s=Sw();return[[r,e].join("-"),[ww,t].join("-"),i,s].join("/")}function Dw({protocol:r,version:e,relayUrl:t,sdkVersion:i,auth:s,projectId:n,useOnCloseEvent:o,bundleId:a,packageName:c}){const l=t.split("?"),h=Xh(r,e,i),u={auth:s,ua:h,projectId:n,useOnCloseEvent:o,packageName:c||void 0,bundleId:a||void 0},d=Ew(l[1]||"",u);return l[0]+"?"+d}function nr(r,e){return r.filter(t=>e.includes(t)).length===r.length}function zn(r){return Object.fromEntries(r.entries())}function Fn(r){return new Map(Object.entries(r))}function Xt(r=U.FIVE_MINUTES,e){const t=U.toMiliseconds(r||U.FIVE_MINUTES);let i,s,n,o;return{resolve:a=>{n&&i&&(clearTimeout(n),i(a),o=Promise.resolve(a))},reject:a=>{n&&s&&(clearTimeout(n),s(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);n=setTimeout(()=>{const l=new Error(e);o=Promise.reject(l),c(l)},t),i=a,s=c})}}function Ht(r,e,t){return new Promise(async(i,s)=>{const n=setTimeout(()=>s(new Error(t)),e);try{const o=await r;i(o)}catch(o){s(o)}clearTimeout(n)})}function eu(r,e){if(typeof e=="string"&&e.startsWith(`${r}:`))return e;if(r.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(r.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${r}`)}function Ow(r){return eu("topic",r)}function $w(r){return eu("id",r)}function tu(r){const[e,t]=r.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof t=="string")i.topic=t;else if(e==="id"&&Number.isInteger(Number(t)))i.id=Number(t);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${t}`);return i}function de(r,e){return U.fromMiliseconds(Date.now()+U.toMiliseconds(r))}function zt(r){return Date.now()>=U.toMiliseconds(r)}function X(r,e){return`${r}${e?`:${e}`:""}`}function _t(r=[],e=[]){return[...new Set([...r,...e])]}async function Pw({id:r,topic:e,wcDeepLink:t}){var i;try{if(!t)return;const s=typeof t=="string"?JSON.parse(t):t,n=s?.href;if(typeof n!="string")return;const o=xw(n,r,e),a=Ci();if(a===Ge.browser){if(!((i=Bt.getDocument())!=null&&i.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}Aw(o)}else a===Ge.reactNative&&typeof globalThis?.Linking<"u"&&await globalThis.Linking.openURL(o)}catch(s){console.error(s)}}function xw(r,e,t){const i=`requestId=${e}&sessionTopic=${t}`;r.endsWith("/")&&(r=r.slice(0,-1));let s=`${r}`;if(r.startsWith("https://t.me")){const n=r.includes("?")?"&startapp=":"?startapp=";s=`${s}${n}${Nw(i,!0)}`}else s=`${s}/wc?${i}`;return s}function Aw(r){let e="_self";Rw()?e="_top":(Tw()||r.startsWith("https://")||r.startsWith("http://"))&&(e="_blank"),window.open(r,e,"noreferrer noopener")}async function Cw(r,e){let t="";try{if(Qr()&&(t=localStorage.getItem(e),t))return t;t=await r.getItem(e)}catch(i){console.error(i)}return t}function Ya(r,e){if(!r.includes(e))return null;const t=r.split(/([&,?,=])/),i=t.indexOf(e);return t[i+2]}function Ja(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,r=>{const e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)})}function Co(){return typeof it<"u"&&lw.IS_VITEST==="true"}function Tw(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function Rw(){try{return window.self!==window.top}catch{return!1}}function Nw(r,e=!1){const t=Ee.from(r).toString("base64");return e?t.replace(/[=]/g,""):t}function ru(r){return Ee.from(r,"base64").toString("utf-8")}function jw(r){return new Promise(e=>setTimeout(e,r))}function Ii(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function Bw(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Ti(r,...e){if(!Bw(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function To(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Ii(r.outputLen),Ii(r.blockLen)}function zr(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function iu(r,e){Ti(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const Hi=BigInt(2**32-1),Za=BigInt(32);function Uw(r,e=!1){return e?{h:Number(r&Hi),l:Number(r>>Za&Hi)}:{h:Number(r>>Za&Hi)|0,l:Number(r&Hi)|0}}function qw(r,e=!1){let t=new Uint32Array(r.length),i=new Uint32Array(r.length);for(let s=0;s<r.length;s++){const{h:n,l:o}=Uw(r[s],e);[t[s],i[s]]=[n,o]}return[t,i]}const Lw=(r,e,t)=>r<<t|e>>>32-t,kw=(r,e,t)=>e<<t|r>>>32-t,Mw=(r,e,t)=>e<<t-32|r>>>64-t,zw=(r,e,t)=>r<<t-32|e>>>64-t,Er=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Fw(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}function nn(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function gt(r,e){return r<<32-e|r>>>e}const Qa=new Uint8Array(new Uint32Array([0x11223344]).buffer)[0]===68;function Hw(r){return r<<24&0xff000000|r<<8&0xff0000|r>>>8&65280|r>>>24&255}function Xa(r){for(let e=0;e<r.length;e++)r[e]=Hw(r[e])}function Vw(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function Fr(r){return typeof r=="string"&&(r=Vw(r)),Ti(r),r}function Kw(...r){let e=0;for(let i=0;i<r.length;i++){const s=r[i];Ti(s),e+=s.length}const t=new Uint8Array(e);for(let i=0,s=0;i<r.length;i++){const n=r[i];t.set(n,s),s+=n.length}return t}let Ro=class{clone(){return this._cloneInto()}};function su(r){const e=i=>r().update(Fr(i)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function Xr(r=32){if(Er&&typeof Er.getRandomValues=="function")return Er.getRandomValues(new Uint8Array(r));if(Er&&typeof Er.randomBytes=="function")return Er.randomBytes(r);throw new Error("crypto.getRandomValues must be defined")}const nu=[],ou=[],au=[],Ww=BigInt(0),ai=BigInt(1),Gw=BigInt(2),Yw=BigInt(7),Jw=BigInt(256),Zw=BigInt(113);for(let r=0,e=ai,t=1,i=0;r<24;r++){[t,i]=[i,(2*t+3*i)%5],nu.push(2*(5*i+t)),ou.push((r+1)*(r+2)/2%64);let s=Ww;for(let n=0;n<7;n++)e=(e<<ai^(e>>Yw)*Zw)%Jw,e&Gw&&(s^=ai<<(ai<<BigInt(n))-ai);au.push(s)}const[Qw,Xw]=qw(au,!0),ec=(r,e,t)=>t>32?Mw(r,e,t):Lw(r,e,t),tc=(r,e,t)=>t>32?zw(r,e,t):kw(r,e,t);function eb(r,e=24){const t=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let o=0;o<10;o++)t[o]=r[o]^r[o+10]^r[o+20]^r[o+30]^r[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=t[c],h=t[c+1],u=ec(l,h,1)^t[a],d=tc(l,h,1)^t[a+1];for(let f=0;f<50;f+=10)r[o+f]^=u,r[o+f+1]^=d}let s=r[2],n=r[3];for(let o=0;o<24;o++){const a=ou[o],c=ec(s,n,a),l=tc(s,n,a),h=nu[o];s=r[h],n=r[h+1],r[h]=c,r[h+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)t[a]=r[o+a];for(let a=0;a<10;a++)r[o+a]^=~t[(a+2)%10]&t[(a+4)%10]}r[0]^=Qw[i],r[1]^=Xw[i]}t.fill(0)}let tb=class cu extends Ro{constructor(e,t,i,s=!1,n=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=i,this.enableXOF=s,this.rounds=n,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Ii(i),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=Fw(this.state)}keccak(){Qa||Xa(this.state32),eb(this.state32,this.rounds),Qa||Xa(this.state32),this.posOut=0,this.pos=0}update(e){zr(this);const{blockLen:t,state:i}=this;e=Fr(e);const s=e.length;for(let n=0;n<s;){const o=Math.min(t-this.pos,s-n);for(let a=0;a<o;a++)i[this.pos++]^=e[n++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:i,blockLen:s}=this;e[i]^=t,(t&128)!==0&&i===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){zr(this,!1),Ti(e),this.finish();const t=this.state,{blockLen:i}=this;for(let s=0,n=e.length;s<n;){this.posOut>=i&&this.keccak();const o=Math.min(i-this.posOut,n-s);e.set(t.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Ii(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(iu(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:t,suffix:i,outputLen:s,rounds:n,enableXOF:o}=this;return e||(e=new cu(t,i,s,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=i,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}};const rb=(r,e,t)=>su(()=>new tb(e,r,t)),ib=rb(1,136,256/8),sb="https://rpc.walletconnect.org/v1";function lu(r){const e=`Ethereum Signed Message:
${r.length}`,t=new TextEncoder().encode(e+r);return"0x"+Ee.from(ib(t)).toString("hex")}async function nb(r,e,t,i,s,n){switch(t.t){case"eip191":return await ob(r,e,t.s);case"eip1271":return await ab(r,e,t.s,i,s,n);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${t.t}`)}}async function ob(r,e,t){return(await bf({hash:lu(e),signature:t})).toLowerCase()===r.toLowerCase()}async function ab(r,e,t,i,s,n){const o=Mr(i);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${i}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",l="0000000000000000000000000000000000000000000000000000000000000041",h=t.substring(2),u=lu(e).substring(2),d=a+u+c+l+h,f=await fetch(`${n||sb}/?chainId=${i}&projectId=${s}`,{method:"POST",body:JSON.stringify({id:cb(),jsonrpc:"2.0",method:"eth_call",params:[{to:r,data:d},"latest"]})}),{result:p}=await f.json();return p?p.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function cb(){return Date.now()+Math.floor(Math.random()*1e3)}function lb(r){const e=atob(r),t=new Uint8Array(e.length);for(let o=0;o<e.length;o++)t[o]=e.charCodeAt(o);const i=t[0];if(i===0)throw new Error("No signatures found");const s=1+i*64;if(t.length<s)throw new Error("Transaction data too short for claimed signature count");if(t.length<100)throw new Error("Transaction too short");const n=Ee.from(r,"base64").slice(1,65);return kd.encode(n)}var hb=Object.defineProperty,ub=Object.defineProperties,db=Object.getOwnPropertyDescriptors,rc=Object.getOwnPropertySymbols,pb=Object.prototype.hasOwnProperty,fb=Object.prototype.propertyIsEnumerable,ic=(r,e,t)=>e in r?hb(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,gb=(r,e)=>{for(var t in e||(e={}))pb.call(e,t)&&ic(r,t,e[t]);if(rc)for(var t of rc(e))fb.call(e,t)&&ic(r,t,e[t]);return r},yb=(r,e)=>ub(r,db(e));const mb="did:pkh:",No=r=>r?.split(":"),wb=r=>{const e=r&&No(r);if(e)return r.includes(mb)?e[3]:e[1]},Hn=r=>{const e=r&&No(r);if(e)return e[2]+":"+e[3]},fs=r=>{const e=r&&No(r);if(e)return e.pop()};async function sc(r){const{cacao:e,projectId:t}=r,{s:i,p:s}=e,n=hu(s,s.iss),o=fs(s.iss);return await nb(o,n,i,Hn(s.iss),t)}const hu=(r,e)=>{const t=`${r.domain} wants you to sign in with your Ethereum account:`,i=fs(e);if(!r.aud&&!r.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let s=r.statement||void 0;const n=`URI: ${r.aud||r.uri}`,o=`Version: ${r.version}`,a=`Chain ID: ${wb(e)}`,c=`Nonce: ${r.nonce}`,l=`Issued At: ${r.iat}`,h=r.exp?`Expiration Time: ${r.exp}`:void 0,u=r.nbf?`Not Before: ${r.nbf}`:void 0,d=r.requestId?`Request ID: ${r.requestId}`:void 0,f=r.resources?`Resources:${r.resources.map(g=>`
- ${g}`).join("")}`:void 0,p=ss(r.resources);if(p){const g=Si(p);s=$b(s,g)}return[t,i,"",s,"",n,o,a,c,l,h,u,d,f].filter(g=>g!=null).join(`
`)};function bb(r){return Ee.from(JSON.stringify(r)).toString("base64")}function vb(r){return JSON.parse(Ee.from(r,"base64").toString("utf-8"))}function hr(r){if(!r)throw new Error("No recap provided, value is undefined");if(!r.att)throw new Error("No `att` property found");const e=Object.keys(r.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(t=>{const i=r.att[t];if(Array.isArray(i))throw new Error(`Resource must be an object: ${t}`);if(typeof i!="object")throw new Error(`Resource must be an object: ${t}`);if(!Object.keys(i).length)throw new Error(`Resource object is empty: ${t}`);Object.keys(i).forEach(s=>{const n=i[s];if(!Array.isArray(n))throw new Error(`Ability limits ${s} must be an array of objects, found: ${n}`);if(!n.length)throw new Error(`Value of ${s} is empty array, must be an array with objects`);n.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${s}) must be an array of objects, found: ${o}`)})})})}function Eb(r,e,t,i={}){return t?.sort((s,n)=>s.localeCompare(n)),{att:{[r]:_b(e,t,i)}}}function _b(r,e,t={}){e=e?.sort((s,n)=>s.localeCompare(n));const i=e.map(s=>({[`${r}/${s}`]:[t]}));return Object.assign({},...i)}function uu(r){return hr(r),`urn:recap:${bb(r).replace(/=/g,"")}`}function Si(r){const e=vb(r.replace("urn:recap:",""));return hr(e),e}function Ib(r,e,t){const i=Eb(r,e,t);return uu(i)}function Sb(r){return r&&r.includes("urn:recap:")}function Db(r,e){const t=Si(r),i=Si(e),s=Ob(t,i);return uu(s)}function Ob(r,e){hr(r),hr(e);const t=Object.keys(r.att).concat(Object.keys(e.att)).sort((s,n)=>s.localeCompare(n)),i={att:{}};return t.forEach(s=>{var n,o;Object.keys(((n=r.att)==null?void 0:n[s])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[s])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,l;i.att[s]=yb(gb({},i.att[s]),{[a]:((c=r.att[s])==null?void 0:c[a])||((l=e.att[s])==null?void 0:l[a])})})}),i}function $b(r="",e){hr(e);const t="I further authorize the stated URI to perform the following actions on my behalf: ";if(r.includes(t))return r;const i=[];let s=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(u=>({ability:u.split("/")[0],action:u.split("/")[1]}));c.sort((u,d)=>u.action.localeCompare(d.action));const l={};c.forEach(u=>{l[u.ability]||(l[u.ability]=[]),l[u.ability].push(u.action)});const h=Object.keys(l).map(u=>(s++,`(${s}) '${u}': '${l[u].join("', '")}' for '${a}'.`));i.push(h.join(", ").replace(".,","."))});const n=i.join(" "),o=`${t}${n}`;return`${r?r+" ":""}${o}`}function nc(r){var e;const t=Si(r);hr(t);const i=(e=t.att)==null?void 0:e.eip155;return i?Object.keys(i).map(s=>s.split("/")[1]):[]}function oc(r){const e=Si(r);hr(e);const t=[];return Object.values(e.att).forEach(i=>{Object.values(i).forEach(s=>{var n;(n=s?.[0])!=null&&n.chains&&t.push(s[0].chains)})}),[...new Set(t.flat())]}function ss(r){if(!r)return;const e=r?.[r.length-1];return Sb(e)?e:void 0}function on(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function du(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function We(r,...e){if(!du(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function ac(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Pb(r,e){We(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function cc(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}const Kt=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),xb=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),Ab=new Uint8Array(new Uint32Array([0x11223344]).buffer)[0]===68;if(!Ab)throw new Error("Non little-endian hardware is not supported");function Cb(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function Vn(r){if(typeof r=="string")r=Cb(r);else if(du(r))r=Kn(r);else throw new Error("Uint8Array expected, got "+typeof r);return r}function Tb(r,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(r,e)}function Rb(r,e){if(r.length!==e.length)return!1;let t=0;for(let i=0;i<r.length;i++)t|=r[i]^e[i];return t===0}const Nb=(r,e)=>{function t(i,...s){if(We(i),r.nonceLength!==void 0){const l=s[0];if(!l)throw new Error("nonce / iv required");r.varSizeNonce?We(l):We(l,r.nonceLength)}const n=r.tagLength;n&&s[1]!==void 0&&We(s[1]);const o=e(i,...s),a=(l,h)=>{if(h!==void 0){if(l!==2)throw new Error("cipher output not supported");We(h)}};let c=!1;return{encrypt(l,h){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,We(l),a(o.encrypt.length,h),o.encrypt(l,h)},decrypt(l,h){if(We(l),n&&l.length<n)throw new Error("invalid ciphertext length: smaller than tagLength="+n);return a(o.decrypt.length,h),o.decrypt(l,h)}}}return Object.assign(t,r),t};function lc(r,e,t=!0){if(e===void 0)return new Uint8Array(r);if(e.length!==r)throw new Error("invalid output length, expected "+r+", got: "+e.length);if(t&&!jb(e))throw new Error("invalid output, must be aligned");return e}function hc(r,e,t,i){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,i);const s=BigInt(32),n=BigInt(0xffffffff),o=Number(t>>s&n),a=Number(t&n);r.setUint32(e+4,o,i),r.setUint32(e+0,a,i)}function jb(r){return r.byteOffset%4===0}function Kn(r){return Uint8Array.from(r)}function Hr(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}const pu=r=>Uint8Array.from(r.split("").map(e=>e.charCodeAt(0))),Bb=pu("expand 16-byte k"),Ub=pu("expand 32-byte k"),qb=Kt(Bb),Lb=Kt(Ub);function J(r,e){return r<<e|r>>>32-e}function Wn(r){return r.byteOffset%4===0}const Vi=64,kb=16,fu=2**32-1,uc=new Uint32Array;function Mb(r,e,t,i,s,n,o,a){const c=s.length,l=new Uint8Array(Vi),h=Kt(l),u=Wn(s)&&Wn(n),d=u?Kt(s):uc,f=u?Kt(n):uc;for(let p=0;p<c;o++){if(r(e,t,i,h,o,a),o>=fu)throw new Error("arx: counter overflow");const g=Math.min(Vi,c-p);if(u&&g===Vi){const w=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let _=0,b;_<kb;_++)b=w+_,f[b]=d[b]^h[_];p+=Vi;continue}for(let w=0,_;w<g;w++)_=p+w,n[_]=s[_]^l[w];p+=g}}function zb(r,e){const{allowShortKeys:t,extendNonceFn:i,counterLength:s,counterRight:n,rounds:o}=Tb({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof r!="function")throw new Error("core must be a function");return on(s),on(o),cc(n),cc(t),(a,c,l,h,u=0)=>{We(a),We(c),We(l);const d=l.length;if(h===void 0&&(h=new Uint8Array(d)),We(h),on(u),u<0||u>=fu)throw new Error("arx: counter overflow");if(h.length<d)throw new Error(`arx: output (${h.length}) is shorter than data (${d})`);const f=[];let p=a.length,g,w;if(p===32)f.push(g=Kn(a)),w=Lb;else if(p===16&&t)g=new Uint8Array(32),g.set(a),g.set(a,16),w=qb,f.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${p}`);Wn(c)||f.push(c=Kn(c));const _=Kt(g);if(i){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");i(w,_,Kt(c.subarray(0,16)),_),c=c.subarray(16)}const b=16-s;if(b!==c.length)throw new Error(`arx: nonce must be ${b} or 16 bytes`);if(b!==12){const x=new Uint8Array(12);x.set(c,n?0:12-c.length),c=x,f.push(c)}const E=Kt(c);return Mb(r,w,_,E,l,h,u,o),Hr(...f),h}}const Ie=(r,e)=>r[e++]&255|(r[e++]&255)<<8;class Fb{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Vn(e),We(e,32);const t=Ie(e,0),i=Ie(e,2),s=Ie(e,4),n=Ie(e,6),o=Ie(e,8),a=Ie(e,10),c=Ie(e,12),l=Ie(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|i<<3)&8191,this.r[2]=(i>>>10|s<<6)&7939,this.r[3]=(s>>>7|n<<9)&8191,this.r[4]=(n>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let h=0;h<8;h++)this.pad[h]=Ie(e,16+2*h)}process(e,t,i=!1){const s=i?0:2048,{h:n,r:o}=this,a=o[0],c=o[1],l=o[2],h=o[3],u=o[4],d=o[5],f=o[6],p=o[7],g=o[8],w=o[9],_=Ie(e,t+0),b=Ie(e,t+2),E=Ie(e,t+4),x=Ie(e,t+6),T=Ie(e,t+8),v=Ie(e,t+10),I=Ie(e,t+12),$=Ie(e,t+14);let D=n[0]+(_&8191),j=n[1]+((_>>>13|b<<3)&8191),N=n[2]+((b>>>10|E<<6)&8191),B=n[3]+((E>>>7|x<<9)&8191),z=n[4]+((x>>>4|T<<12)&8191),P=n[5]+(T>>>1&8191),y=n[6]+((T>>>14|v<<2)&8191),m=n[7]+((v>>>11|I<<5)&8191),S=n[8]+((I>>>8|$<<8)&8191),A=n[9]+($>>>5|s),O=0,C=O+D*a+j*(5*w)+N*(5*g)+B*(5*p)+z*(5*f);O=C>>>13,C&=8191,C+=P*(5*d)+y*(5*u)+m*(5*h)+S*(5*l)+A*(5*c),O+=C>>>13,C&=8191;let L=O+D*c+j*a+N*(5*w)+B*(5*g)+z*(5*p);O=L>>>13,L&=8191,L+=P*(5*f)+y*(5*d)+m*(5*u)+S*(5*h)+A*(5*l),O+=L>>>13,L&=8191;let M=O+D*l+j*c+N*a+B*(5*w)+z*(5*g);O=M>>>13,M&=8191,M+=P*(5*p)+y*(5*f)+m*(5*d)+S*(5*u)+A*(5*h),O+=M>>>13,M&=8191;let F=O+D*h+j*l+N*c+B*a+z*(5*w);O=F>>>13,F&=8191,F+=P*(5*g)+y*(5*p)+m*(5*f)+S*(5*d)+A*(5*u),O+=F>>>13,F&=8191;let k=O+D*u+j*h+N*l+B*c+z*a;O=k>>>13,k&=8191,k+=P*(5*w)+y*(5*g)+m*(5*p)+S*(5*f)+A*(5*d),O+=k>>>13,k&=8191;let H=O+D*d+j*u+N*h+B*l+z*c;O=H>>>13,H&=8191,H+=P*a+y*(5*w)+m*(5*g)+S*(5*p)+A*(5*f),O+=H>>>13,H&=8191;let V=O+D*f+j*d+N*u+B*h+z*l;O=V>>>13,V&=8191,V+=P*c+y*a+m*(5*w)+S*(5*g)+A*(5*p),O+=V>>>13,V&=8191;let ne=O+D*p+j*f+N*d+B*u+z*h;O=ne>>>13,ne&=8191,ne+=P*l+y*c+m*a+S*(5*w)+A*(5*g),O+=ne>>>13,ne&=8191;let ee=O+D*g+j*p+N*f+B*d+z*u;O=ee>>>13,ee&=8191,ee+=P*h+y*l+m*c+S*a+A*(5*w),O+=ee>>>13,ee&=8191;let Y=O+D*w+j*g+N*p+B*f+z*d;O=Y>>>13,Y&=8191,Y+=P*u+y*h+m*l+S*c+A*a,O+=Y>>>13,Y&=8191,O=(O<<2)+O|0,O=O+C|0,C=O&8191,O=O>>>13,L+=O,n[0]=C,n[1]=L,n[2]=M,n[3]=F,n[4]=k,n[5]=H,n[6]=V,n[7]=ne,n[8]=ee,n[9]=Y}finalize(){const{h:e,pad:t}=this,i=new Uint16Array(10);let s=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=s,s=e[a]>>>13,e[a]&=8191;e[0]+=s*5,s=e[0]>>>13,e[0]&=8191,e[1]+=s,s=e[1]>>>13,e[1]&=8191,e[2]+=s,i[0]=e[0]+5,s=i[0]>>>13,i[0]&=8191;for(let a=1;a<10;a++)i[a]=e[a]+s,s=i[a]>>>13,i[a]&=8191;i[9]-=8192;let n=(s^1)-1;for(let a=0;a<10;a++)i[a]&=n;n=~n;for(let a=0;a<10;a++)e[a]=e[a]&n|i[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+t[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+t[a]|0)+(o>>>16)|0,e[a]=o&65535;Hr(i)}update(e){ac(this);const{buffer:t,blockLen:i}=this;e=Vn(e);const s=e.length;for(let n=0;n<s;){const o=Math.min(i-this.pos,s-n);if(o===i){for(;i<=s-n;n+=i)this.process(e,n);continue}t.set(e.subarray(n,n+o),this.pos),this.pos+=o,n+=o,this.pos===i&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){Hr(this.h,this.r,this.buffer,this.pad)}digestInto(e){ac(this),Pb(e,this),this.finished=!0;const{buffer:t,h:i}=this;let{pos:s}=this;if(s){for(t[s++]=1;s<16;s++)t[s]=0;this.process(t,0,!0)}this.finalize();let n=0;for(let o=0;o<8;o++)e[n++]=i[o]>>>0,e[n++]=i[o]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const i=e.slice(0,t);return this.destroy(),i}}function Hb(r){const e=(i,s)=>r(s).update(Vn(i)).digest(),t=r(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=i=>r(i),e}const Vb=Hb(r=>new Fb(r));function Kb(r,e,t,i,s,n=20){let o=r[0],a=r[1],c=r[2],l=r[3],h=e[0],u=e[1],d=e[2],f=e[3],p=e[4],g=e[5],w=e[6],_=e[7],b=s,E=t[0],x=t[1],T=t[2],v=o,I=a,$=c,D=l,j=h,N=u,B=d,z=f,P=p,y=g,m=w,S=_,A=b,O=E,C=x,L=T;for(let F=0;F<n;F+=2)v=v+j|0,A=J(A^v,16),P=P+A|0,j=J(j^P,12),v=v+j|0,A=J(A^v,8),P=P+A|0,j=J(j^P,7),I=I+N|0,O=J(O^I,16),y=y+O|0,N=J(N^y,12),I=I+N|0,O=J(O^I,8),y=y+O|0,N=J(N^y,7),$=$+B|0,C=J(C^$,16),m=m+C|0,B=J(B^m,12),$=$+B|0,C=J(C^$,8),m=m+C|0,B=J(B^m,7),D=D+z|0,L=J(L^D,16),S=S+L|0,z=J(z^S,12),D=D+z|0,L=J(L^D,8),S=S+L|0,z=J(z^S,7),v=v+N|0,L=J(L^v,16),m=m+L|0,N=J(N^m,12),v=v+N|0,L=J(L^v,8),m=m+L|0,N=J(N^m,7),I=I+B|0,A=J(A^I,16),S=S+A|0,B=J(B^S,12),I=I+B|0,A=J(A^I,8),S=S+A|0,B=J(B^S,7),$=$+z|0,O=J(O^$,16),P=P+O|0,z=J(z^P,12),$=$+z|0,O=J(O^$,8),P=P+O|0,z=J(z^P,7),D=D+j|0,C=J(C^D,16),y=y+C|0,j=J(j^y,12),D=D+j|0,C=J(C^D,8),y=y+C|0,j=J(j^y,7);let M=0;i[M++]=o+v|0,i[M++]=a+I|0,i[M++]=c+$|0,i[M++]=l+D|0,i[M++]=h+j|0,i[M++]=u+N|0,i[M++]=d+B|0,i[M++]=f+z|0,i[M++]=p+P|0,i[M++]=g+y|0,i[M++]=w+m|0,i[M++]=_+S|0,i[M++]=b+A|0,i[M++]=E+O|0,i[M++]=x+C|0,i[M++]=T+L|0}const Wb=zb(Kb,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Gb=new Uint8Array(16),dc=(r,e)=>{r.update(e);const t=e.length%16;t&&r.update(Gb.subarray(t))},Yb=new Uint8Array(32);function pc(r,e,t,i,s){const n=r(e,t,Yb),o=Vb.create(n);s&&dc(o,s),dc(o,i);const a=new Uint8Array(16),c=xb(a);hc(c,0,BigInt(s?s.length:0),!0),hc(c,8,BigInt(i.length),!0),o.update(a);const l=o.digest();return Hr(n,a),l}const Jb=r=>(e,t,i)=>({encrypt(s,n){const o=s.length;n=lc(o+16,n,!1),n.set(s);const a=n.subarray(0,-16);r(e,t,a,a,1);const c=pc(r,e,t,a,i);return n.set(c,o),Hr(c),n},decrypt(s,n){n=lc(s.length-16,n,!1);const o=s.subarray(0,-16),a=s.subarray(-16),c=pc(r,e,t,o,i);if(!Rb(a,c))throw new Error("invalid tag");return n.set(s.subarray(0,-16)),r(e,t,n,n,1),Hr(c),n}}),gu=Nb({blockSize:64,nonceLength:12,tagLength:16},Jb(Wb));let yu=class extends Ro{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,To(e);const i=Fr(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,n=new Uint8Array(s);n.set(i.length>s?e.create().update(i).digest():i);for(let o=0;o<n.length;o++)n[o]^=54;this.iHash.update(n),this.oHash=e.create();for(let o=0;o<n.length;o++)n[o]^=106;this.oHash.update(n),n.fill(0)}update(e){return zr(this),this.iHash.update(e),this}digestInto(e){zr(this),Ti(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:i,finished:s,destroyed:n,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=n,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Ps=(r,e,t)=>new yu(r,e).update(t).digest();Ps.create=(r,e)=>new yu(r,e);function Zb(r,e,t){return To(r),t===void 0&&(t=new Uint8Array(r.outputLen)),Ps(r,Fr(t),Fr(e))}const an=new Uint8Array([0]),fc=new Uint8Array;function Qb(r,e,t,i=32){if(To(r),Ii(i),i>255*r.outputLen)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(i/r.outputLen);t===void 0&&(t=fc);const n=new Uint8Array(s*r.outputLen),o=Ps.create(r,e),a=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let l=0;l<s;l++)an[0]=l+1,a.update(l===0?fc:c).update(t).update(an).digestInto(c),n.set(c,r.outputLen*l),o._cloneInto(a);return o.destroy(),a.destroy(),c.fill(0),an.fill(0),n.slice(0,i)}const Xb=(r,e,t,i,s)=>Qb(r,Zb(r,e,t),i,s);function ev(r,e,t,i){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,i);const s=BigInt(32),n=BigInt(0xffffffff),o=Number(t>>s&n),a=Number(t&n),c=i?4:0,l=i?0:4;r.setUint32(e+c,o,i),r.setUint32(e+l,a,i)}function tv(r,e,t){return r&e^~r&t}function rv(r,e,t){return r&e^r&t^e&t}let iv=class extends Ro{constructor(e,t,i,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=i,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=nn(this.buffer)}update(e){zr(this);const{view:t,buffer:i,blockLen:s}=this;e=Fr(e);const n=e.length;for(let o=0;o<n;){const a=Math.min(s-this.pos,n-o);if(a===s){const c=nn(e);for(;s<=n-o;o+=s)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){zr(this),iu(e,this),this.finished=!0;const{buffer:t,view:i,blockLen:s,isLE:n}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(i,0),o=0);for(let u=o;u<s;u++)t[u]=0;ev(i,s-8,BigInt(this.length*8),n),this.process(i,0);const a=nn(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,h=this.get();if(l>h.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<l;u++)a.setUint32(4*u,h[u],n)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const i=e.slice(0,t);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:i,length:s,finished:n,destroyed:o,pos:a}=this;return e.length=s,e.pos=a,e.finished=n,e.destroyed=o,s%t&&e.buffer.set(i),e}};const sv=new Uint32Array([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),kt=new Uint32Array([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),Mt=new Uint32Array(64);class nv extends iv{constructor(){super(64,32,8,!1),this.A=kt[0]|0,this.B=kt[1]|0,this.C=kt[2]|0,this.D=kt[3]|0,this.E=kt[4]|0,this.F=kt[5]|0,this.G=kt[6]|0,this.H=kt[7]|0}get(){const{A:e,B:t,C:i,D:s,E:n,F:o,G:a,H:c}=this;return[e,t,i,s,n,o,a,c]}set(e,t,i,s,n,o,a,c){this.A=e|0,this.B=t|0,this.C=i|0,this.D=s|0,this.E=n|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let u=0;u<16;u++,t+=4)Mt[u]=e.getUint32(t,!1);for(let u=16;u<64;u++){const d=Mt[u-15],f=Mt[u-2],p=gt(d,7)^gt(d,18)^d>>>3,g=gt(f,17)^gt(f,19)^f>>>10;Mt[u]=g+Mt[u-7]+p+Mt[u-16]|0}let{A:i,B:s,C:n,D:o,E:a,F:c,G:l,H:h}=this;for(let u=0;u<64;u++){const d=gt(a,6)^gt(a,11)^gt(a,25),f=h+d+tv(a,c,l)+sv[u]+Mt[u]|0,p=(gt(i,2)^gt(i,13)^gt(i,22))+rv(i,s,n)|0;h=l,l=c,c=a,a=o+f|0,o=n,n=s,s=i,i=f+p|0}i=i+this.A|0,s=s+this.B|0,n=n+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,h=h+this.H|0,this.set(i,s,n,o,a,c,l,h)}roundClean(){Mt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Ri=su(()=>new nv);const xs=BigInt(0),As=BigInt(1),ov=BigInt(2);function ur(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Ni(r){if(!ur(r))throw new Error("Uint8Array expected")}function Vr(r,e){if(typeof e!="boolean")throw new Error(r+" boolean expected, got "+e)}const av=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function Kr(r){Ni(r);let e="";for(let t=0;t<r.length;t++)e+=av[r[t]];return e}function qr(r){const e=r.toString(16);return e.length&1?"0"+e:e}function jo(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?xs:BigInt("0x"+r)}const Pt={_0:48,_9:57,A:65,F:70,a:97,f:102};function gc(r){if(r>=Pt._0&&r<=Pt._9)return r-Pt._0;if(r>=Pt.A&&r<=Pt.F)return r-(Pt.A-10);if(r>=Pt.a&&r<=Pt.f)return r-(Pt.a-10)}function Wr(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);const e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(t);for(let s=0,n=0;s<t;s++,n+=2){const o=gc(r.charCodeAt(n)),a=gc(r.charCodeAt(n+1));if(o===void 0||a===void 0){const c=r[n]+r[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}i[s]=o*16+a}return i}function ar(r){return jo(Kr(r))}function Di(r){return Ni(r),jo(Kr(Uint8Array.from(r).reverse()))}function Gr(r,e){return Wr(r.toString(16).padStart(e*2,"0"))}function Cs(r,e){return Gr(r,e).reverse()}function cv(r){return Wr(qr(r))}function Ke(r,e,t){let i;if(typeof e=="string")try{i=Wr(e)}catch(n){throw new Error(r+" must be hex string or Uint8Array, cause: "+n)}else if(ur(e))i=Uint8Array.from(e);else throw new Error(r+" must be hex string or Uint8Array");const s=i.length;if(typeof t=="number"&&s!==t)throw new Error(r+" of length "+t+" expected, got "+s);return i}function Oi(...r){let e=0;for(let i=0;i<r.length;i++){const s=r[i];Ni(s),e+=s.length}const t=new Uint8Array(e);for(let i=0,s=0;i<r.length;i++){const n=r[i];t.set(n,s),s+=n.length}return t}function lv(r,e){if(r.length!==e.length)return!1;let t=0;for(let i=0;i<r.length;i++)t|=r[i]^e[i];return t===0}function hv(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}const cn=r=>typeof r=="bigint"&&xs<=r;function Ts(r,e,t){return cn(r)&&cn(e)&&cn(t)&&e<=r&&r<t}function Nt(r,e,t,i){if(!Ts(e,t,i))throw new Error("expected valid "+r+": "+t+" <= n < "+i+", got "+e)}function mu(r){let e;for(e=0;r>xs;r>>=As,e+=1);return e}function uv(r,e){return r>>BigInt(e)&As}function dv(r,e,t){return r|(t?As:xs)<<BigInt(e)}const Bo=r=>(ov<<BigInt(r-1))-As,ln=r=>new Uint8Array(r),yc=r=>Uint8Array.from(r);function wu(r,e,t){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let i=ln(r),s=ln(r),n=0;const o=()=>{i.fill(1),s.fill(0),n=0},a=(...h)=>t(s,i,...h),c=(h=ln())=>{s=a(yc([0]),h),i=a(),h.length!==0&&(s=a(yc([1]),h),i=a())},l=()=>{if(n++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const u=[];for(;h<e;){i=a();const d=i.slice();u.push(d),h+=i.length}return Oi(...u)};return(h,u)=>{o(),c(h);let d;for(;!(d=u(l()));)c();return o(),d}}const pv={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||ur(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function ei(r,e,t={}){const i=(s,n,o)=>{const a=pv[n];if(typeof a!="function")throw new Error("invalid validator function");const c=r[s];if(!(o&&c===void 0)&&!a(c,r))throw new Error("param "+String(s)+" is invalid. Expected "+n+", got "+c)};for(const[s,n]of Object.entries(e))i(s,n,!1);for(const[s,n]of Object.entries(t))i(s,n,!0);return r}const fv=()=>{throw new Error("not implemented")};function Gn(r){const e=new WeakMap;return(t,...i)=>{const s=e.get(t);if(s!==void 0)return s;const n=r(t,...i);return e.set(t,n),n}}var gv=Object.freeze({__proto__:null,isBytes:ur,abytes:Ni,abool:Vr,bytesToHex:Kr,numberToHexUnpadded:qr,hexToNumber:jo,hexToBytes:Wr,bytesToNumberBE:ar,bytesToNumberLE:Di,numberToBytesBE:Gr,numberToBytesLE:Cs,numberToVarBytesBE:cv,ensureBytes:Ke,concatBytes:Oi,equalBytes:lv,utf8ToBytes:hv,inRange:Ts,aInRange:Nt,bitLen:mu,bitGet:uv,bitSet:dv,bitMask:Bo,createHmacDrbg:wu,validateObject:ei,notImplemented:fv,memoized:Gn});const ve=BigInt(0),le=BigInt(1),rr=BigInt(2),yv=BigInt(3),Yn=BigInt(4),mc=BigInt(5),wc=BigInt(8);function ke(r,e){const t=r%e;return t>=ve?t:e+t}function bu(r,e,t){if(e<ve)throw new Error("invalid exponent, negatives unsupported");if(t<=ve)throw new Error("invalid modulus");if(t===le)return ve;let i=le;for(;e>ve;)e&le&&(i=i*r%t),r=r*r%t,e>>=le;return i}function ht(r,e,t){let i=r;for(;e-- >ve;)i*=i,i%=t;return i}function Jn(r,e){if(r===ve)throw new Error("invert: expected non-zero number");if(e<=ve)throw new Error("invert: expected positive modulus, got "+e);let t=ke(r,e),i=e,s=ve,n=le;for(;t!==ve;){const o=i/t,a=i%t,c=s-n*o;i=t,t=a,s=n,n=c}if(i!==le)throw new Error("invert: does not exist");return ke(s,e)}function mv(r){const e=(r-le)/rr;let t,i,s;for(t=r-le,i=0;t%rr===ve;t/=rr,i++);for(s=rr;s<r&&bu(s,e,r)!==r-le;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(i===1){const o=(r+le)/Yn;return function(a,c){const l=a.pow(c,o);if(!a.eql(a.sqr(l),c))throw new Error("Cannot find square root");return l}}const n=(t+le)/rr;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=i,l=o.pow(o.mul(o.ONE,s),t),h=o.pow(a,n),u=o.pow(a,t);for(;!o.eql(u,o.ONE);){if(o.eql(u,o.ZERO))return o.ZERO;let d=1;for(let p=o.sqr(u);d<c&&!o.eql(p,o.ONE);d++)p=o.sqr(p);const f=o.pow(l,le<<BigInt(c-d-1));l=o.sqr(f),h=o.mul(h,f),u=o.mul(u,l),c=d}return h}}function wv(r){if(r%Yn===yv){const e=(r+le)/Yn;return function(t,i){const s=t.pow(i,e);if(!t.eql(t.sqr(s),i))throw new Error("Cannot find square root");return s}}if(r%wc===mc){const e=(r-mc)/wc;return function(t,i){const s=t.mul(i,rr),n=t.pow(s,e),o=t.mul(i,n),a=t.mul(t.mul(o,rr),n),c=t.mul(o,t.sub(a,t.ONE));if(!t.eql(t.sqr(c),i))throw new Error("Cannot find square root");return c}}return mv(r)}const bv=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function vv(r){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=bv.reduce((i,s)=>(i[s]="function",i),e);return ei(r,t)}function Ev(r,e,t){if(t<ve)throw new Error("invalid exponent, negatives unsupported");if(t===ve)return r.ONE;if(t===le)return e;let i=r.ONE,s=e;for(;t>ve;)t&le&&(i=r.mul(i,s)),s=r.sqr(s),t>>=le;return i}function _v(r,e){const t=new Array(e.length),i=e.reduce((n,o,a)=>r.is0(o)?n:(t[a]=n,r.mul(n,o)),r.ONE),s=r.inv(i);return e.reduceRight((n,o,a)=>r.is0(o)?n:(t[a]=r.mul(n,t[a]),r.mul(n,o)),s),t}function vu(r,e){const t=e!==void 0?e:r.toString(2).length,i=Math.ceil(t/8);return{nBitLength:t,nByteLength:i}}function Eu(r,e,t=!1,i={}){if(r<=ve)throw new Error("invalid field: expected ORDER > 0, got "+r);const{nBitLength:s,nByteLength:n}=vu(r,e);if(n>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:r,isLE:t,BITS:s,BYTES:n,MASK:Bo(s),ZERO:ve,ONE:le,create:c=>ke(c,r),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return ve<=c&&c<r},is0:c=>c===ve,isOdd:c=>(c&le)===le,neg:c=>ke(-c,r),eql:(c,l)=>c===l,sqr:c=>ke(c*c,r),add:(c,l)=>ke(c+l,r),sub:(c,l)=>ke(c-l,r),mul:(c,l)=>ke(c*l,r),pow:(c,l)=>Ev(a,c,l),div:(c,l)=>ke(c*Jn(l,r),r),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>Jn(c,r),sqrt:i.sqrt||(c=>(o||(o=wv(r)),o(a,c))),invertBatch:c=>_v(a,c),cmov:(c,l,h)=>h?l:c,toBytes:c=>t?Cs(c,n):Gr(c,n),fromBytes:c=>{if(c.length!==n)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+c.length);return t?Di(c):ar(c)}});return Object.freeze(a)}function _u(r){if(typeof r!="bigint")throw new Error("field order must be bigint");const e=r.toString(2).length;return Math.ceil(e/8)}function Iu(r){const e=_u(r);return e+Math.ceil(e/2)}function Iv(r,e,t=!1){const i=r.length,s=_u(e),n=Iu(e);if(i<16||i<n||i>1024)throw new Error("expected "+n+"-1024 bytes of input, got "+i);const o=t?Di(r):ar(r),a=ke(o,e-le)+le;return t?Cs(a,s):Gr(a,s)}const bc=BigInt(0),Ki=BigInt(1);function hn(r,e){const t=e.negate();return r?t:e}function Su(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function un(r,e){Su(r,e);const t=Math.ceil(e/r)+1,i=2**(r-1);return{windows:t,windowSize:i}}function Sv(r,e){if(!Array.isArray(r))throw new Error("array expected");r.forEach((t,i)=>{if(!(t instanceof e))throw new Error("invalid point at index "+i)})}function Dv(r,e){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((t,i)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+i)})}const dn=new WeakMap,Du=new WeakMap;function pn(r){return Du.get(r)||1}function Ov(r,e){return{constTimeNegate:hn,hasPrecomputes(t){return pn(t)!==1},unsafeLadder(t,i,s=r.ZERO){let n=t;for(;i>bc;)i&Ki&&(s=s.add(n)),n=n.double(),i>>=Ki;return s},precomputeWindow(t,i){const{windows:s,windowSize:n}=un(i,e),o=[];let a=t,c=a;for(let l=0;l<s;l++){c=a,o.push(c);for(let h=1;h<n;h++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(t,i,s){const{windows:n,windowSize:o}=un(t,e);let a=r.ZERO,c=r.BASE;const l=BigInt(2**t-1),h=2**t,u=BigInt(t);for(let d=0;d<n;d++){const f=d*o;let p=Number(s&l);s>>=u,p>o&&(p-=h,s+=Ki);const g=f,w=f+Math.abs(p)-1,_=d%2!==0,b=p<0;p===0?c=c.add(hn(_,i[g])):a=a.add(hn(b,i[w]))}return{p:a,f:c}},wNAFUnsafe(t,i,s,n=r.ZERO){const{windows:o,windowSize:a}=un(t,e),c=BigInt(2**t-1),l=2**t,h=BigInt(t);for(let u=0;u<o;u++){const d=u*a;if(s===bc)break;let f=Number(s&c);if(s>>=h,f>a&&(f-=l,s+=Ki),f===0)continue;let p=i[d+Math.abs(f)-1];f<0&&(p=p.negate()),n=n.add(p)}return n},getPrecomputes(t,i,s){let n=dn.get(i);return n||(n=this.precomputeWindow(i,t),t!==1&&dn.set(i,s(n))),n},wNAFCached(t,i,s){const n=pn(t);return this.wNAF(n,this.getPrecomputes(n,t,s),i)},wNAFCachedUnsafe(t,i,s,n){const o=pn(t);return o===1?this.unsafeLadder(t,i,n):this.wNAFUnsafe(o,this.getPrecomputes(o,t,s),i,n)},setWindowSize(t,i){Su(i,e),Du.set(t,i),dn.delete(t)}}}function $v(r,e,t,i){if(Sv(t,r),Dv(i,e),t.length!==i.length)throw new Error("arrays of points and scalars must have equal length");const s=r.ZERO,n=mu(BigInt(t.length)),o=n>12?n-3:n>4?n-2:n?2:1,a=(1<<o)-1,c=new Array(a+1).fill(s),l=Math.floor((e.BITS-1)/o)*o;let h=s;for(let u=l;u>=0;u-=o){c.fill(s);for(let f=0;f<i.length;f++){const p=i[f],g=Number(p>>BigInt(u)&BigInt(a));c[g]=c[g].add(t[f])}let d=s;for(let f=c.length-1,p=s;f>0;f--)p=p.add(c[f]),d=d.add(p);if(h=h.add(d),u!==0)for(let f=0;f<o;f++)h=h.double()}return h}function Ou(r){return vv(r.Fp),ei(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...vu(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}BigInt(0),BigInt(1),BigInt(2),BigInt(8);const _r=BigInt(0),fn=BigInt(1);function Pv(r){return ei(r,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...r})}function xv(r){const e=Pv(r),{P:t}=e,i=b=>ke(b,t),s=e.montgomeryBits,n=Math.ceil(s/8),o=e.nByteLength,a=e.adjustScalarBytes||(b=>b),c=e.powPminus2||(b=>bu(b,t-BigInt(2),t));function l(b,E,x){const T=i(b*(E-x));return E=i(E-T),x=i(x+T),[E,x]}const h=(e.a-BigInt(2))/BigInt(4);function u(b,E){Nt("u",b,_r,t),Nt("scalar",E,_r,t);const x=E,T=b;let v=fn,I=_r,$=b,D=fn,j=_r,N;for(let z=BigInt(s-1);z>=_r;z--){const P=x>>z&fn;j^=P,N=l(j,v,$),v=N[0],$=N[1],N=l(j,I,D),I=N[0],D=N[1],j=P;const y=v+I,m=i(y*y),S=v-I,A=i(S*S),O=m-A,C=$+D,L=$-D,M=i(L*y),F=i(C*S),k=M+F,H=M-F;$=i(k*k),D=i(T*i(H*H)),v=i(m*A),I=i(O*(m+i(h*O)))}N=l(j,v,$),v=N[0],$=N[1],N=l(j,I,D),I=N[0],D=N[1];const B=c(I);return i(v*B)}function d(b){return Cs(i(b),n)}function f(b){const E=Ke("u coordinate",b,n);return o===32&&(E[31]&=127),Di(E)}function p(b){const E=Ke("scalar",b),x=E.length;if(x!==n&&x!==o){let T=""+n+" or "+o;throw new Error("invalid scalar, expected "+T+" bytes, got "+x)}return Di(a(E))}function g(b,E){const x=f(E),T=p(b),v=u(x,T);if(v===_r)throw new Error("invalid private or public key received");return d(v)}const w=d(e.Gu);function _(b){return g(b,w)}return{scalarMult:g,scalarMultBase:_,getSharedSecret:(b,E)=>g(b,E),getPublicKey:b=>_(b),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:w}}const Zn=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);const Av=BigInt(1),vc=BigInt(2),Cv=BigInt(3),Tv=BigInt(5);BigInt(8);function Rv(r){const e=BigInt(10),t=BigInt(20),i=BigInt(40),s=BigInt(80),n=Zn,o=r*r%n*r%n,a=ht(o,vc,n)*o%n,c=ht(a,Av,n)*r%n,l=ht(c,Tv,n)*c%n,h=ht(l,e,n)*l%n,u=ht(h,t,n)*h%n,d=ht(u,i,n)*u%n,f=ht(d,s,n)*d%n,p=ht(f,s,n)*d%n,g=ht(p,e,n)*l%n;return{pow_p_5_8:ht(g,vc,n)*r%n,b2:o}}function Nv(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}const Qn=xv({P:Zn,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:r=>{const e=Zn,{pow_p_5_8:t,b2:i}=Rv(r);return ke(ht(t,Cv,e)*i,e)},adjustScalarBytes:Nv,randomBytes:Xr});function Ec(r){r.lowS!==void 0&&Vr("lowS",r.lowS),r.prehash!==void 0&&Vr("prehash",r.prehash)}function jv(r){const e=Ou(r);ei(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:t,Fp:i,a:s}=e;if(t){if(!i.eql(s,i.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof t!="object"||typeof t.beta!="bigint"||typeof t.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:Bv,hexToBytes:Uv}=gv;class qv extends Error{constructor(e=""){super(e)}}const Tt={Err:qv,_tlv:{encode:(r,e)=>{const{Err:t}=Tt;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");const i=e.length/2,s=qr(i);if(s.length/2&128)throw new t("tlv.encode: long form length too big");const n=i>127?qr(s.length/2|128):"";return qr(r)+n+s+e},decode(r,e){const{Err:t}=Tt;let i=0;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[i++]!==r)throw new t("tlv.decode: wrong tlv");const s=e[i++],n=!!(s&128);let o=0;if(!n)o=s;else{const c=s&127;if(!c)throw new t("tlv.decode(long): indefinite length not supported");if(c>4)throw new t("tlv.decode(long): byte length is too big");const l=e.subarray(i,i+c);if(l.length!==c)throw new t("tlv.decode: length bytes not complete");if(l[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(const h of l)o=o<<8|h;if(i+=c,o<128)throw new t("tlv.decode(long): not minimal encoding")}const a=e.subarray(i,i+o);if(a.length!==o)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(i+o)}}},_int:{encode(r){const{Err:e}=Tt;if(r<Rt)throw new e("integer: negative integers are not allowed");let t=qr(r);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(r){const{Err:e}=Tt;if(r[0]&128)throw new e("invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Bv(r)}},toSig(r){const{Err:e,_int:t,_tlv:i}=Tt,s=typeof r=="string"?Uv(r):r;Ni(s);const{v:n,l:o}=i.decode(48,s);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=i.decode(2,n),{v:l,l:h}=i.decode(2,c);if(h.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(l)}},hexFromSig(r){const{_tlv:e,_int:t}=Tt,i=e.encode(2,t.encode(r.r)),s=e.encode(2,t.encode(r.s)),n=i+s;return e.encode(48,n)}},Rt=BigInt(0),me=BigInt(1);BigInt(2);const _c=BigInt(3);BigInt(4);function Lv(r){const e=jv(r),{Fp:t}=e,i=Eu(e.n,e.nBitLength),s=e.toBytes||((g,w,_)=>{const b=w.toAffine();return Oi(Uint8Array.from([4]),t.toBytes(b.x),t.toBytes(b.y))}),n=e.fromBytes||(g=>{const w=g.subarray(1),_=t.fromBytes(w.subarray(0,t.BYTES)),b=t.fromBytes(w.subarray(t.BYTES,2*t.BYTES));return{x:_,y:b}});function o(g){const{a:w,b:_}=e,b=t.sqr(g),E=t.mul(b,g);return t.add(t.add(E,t.mul(g,w)),_)}if(!t.eql(t.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(g){return Ts(g,me,e.n)}function c(g){const{allowedPrivateKeyLengths:w,nByteLength:_,wrapPrivateKey:b,n:E}=e;if(w&&typeof g!="bigint"){if(ur(g)&&(g=Kr(g)),typeof g!="string"||!w.includes(g.length))throw new Error("invalid private key");g=g.padStart(_*2,"0")}let x;try{x=typeof g=="bigint"?g:ar(Ke("private key",g,_))}catch{throw new Error("invalid private key, expected hex or "+_+" bytes, got "+typeof g)}return b&&(x=ke(x,E)),Nt("private key",x,me,E),x}function l(g){if(!(g instanceof d))throw new Error("ProjectivePoint expected")}const h=Gn((g,w)=>{const{px:_,py:b,pz:E}=g;if(t.eql(E,t.ONE))return{x:_,y:b};const x=g.is0();w==null&&(w=x?t.ONE:t.inv(E));const T=t.mul(_,w),v=t.mul(b,w),I=t.mul(E,w);if(x)return{x:t.ZERO,y:t.ZERO};if(!t.eql(I,t.ONE))throw new Error("invZ was invalid");return{x:T,y:v}}),u=Gn(g=>{if(g.is0()){if(e.allowInfinityPoint&&!t.is0(g.py))return;throw new Error("bad point: ZERO")}const{x:w,y:_}=g.toAffine();if(!t.isValid(w)||!t.isValid(_))throw new Error("bad point: x or y not FE");const b=t.sqr(_),E=o(w);if(!t.eql(b,E))throw new Error("bad point: equation left != right");if(!g.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class d{constructor(w,_,b){if(this.px=w,this.py=_,this.pz=b,w==null||!t.isValid(w))throw new Error("x required");if(_==null||!t.isValid(_))throw new Error("y required");if(b==null||!t.isValid(b))throw new Error("z required");Object.freeze(this)}static fromAffine(w){const{x:_,y:b}=w||{};if(!w||!t.isValid(_)||!t.isValid(b))throw new Error("invalid affine point");if(w instanceof d)throw new Error("projective point not allowed");const E=x=>t.eql(x,t.ZERO);return E(_)&&E(b)?d.ZERO:new d(_,b,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(w){const _=t.invertBatch(w.map(b=>b.pz));return w.map((b,E)=>b.toAffine(_[E])).map(d.fromAffine)}static fromHex(w){const _=d.fromAffine(n(Ke("pointHex",w)));return _.assertValidity(),_}static fromPrivateKey(w){return d.BASE.multiply(c(w))}static msm(w,_){return $v(d,i,w,_)}_setWindowSize(w){p.setWindowSize(this,w)}assertValidity(){u(this)}hasEvenY(){const{y:w}=this.toAffine();if(t.isOdd)return!t.isOdd(w);throw new Error("Field doesn't support isOdd")}equals(w){l(w);const{px:_,py:b,pz:E}=this,{px:x,py:T,pz:v}=w,I=t.eql(t.mul(_,v),t.mul(x,E)),$=t.eql(t.mul(b,v),t.mul(T,E));return I&&$}negate(){return new d(this.px,t.neg(this.py),this.pz)}double(){const{a:w,b:_}=e,b=t.mul(_,_c),{px:E,py:x,pz:T}=this;let v=t.ZERO,I=t.ZERO,$=t.ZERO,D=t.mul(E,E),j=t.mul(x,x),N=t.mul(T,T),B=t.mul(E,x);return B=t.add(B,B),$=t.mul(E,T),$=t.add($,$),v=t.mul(w,$),I=t.mul(b,N),I=t.add(v,I),v=t.sub(j,I),I=t.add(j,I),I=t.mul(v,I),v=t.mul(B,v),$=t.mul(b,$),N=t.mul(w,N),B=t.sub(D,N),B=t.mul(w,B),B=t.add(B,$),$=t.add(D,D),D=t.add($,D),D=t.add(D,N),D=t.mul(D,B),I=t.add(I,D),N=t.mul(x,T),N=t.add(N,N),D=t.mul(N,B),v=t.sub(v,D),$=t.mul(N,j),$=t.add($,$),$=t.add($,$),new d(v,I,$)}add(w){l(w);const{px:_,py:b,pz:E}=this,{px:x,py:T,pz:v}=w;let I=t.ZERO,$=t.ZERO,D=t.ZERO;const j=e.a,N=t.mul(e.b,_c);let B=t.mul(_,x),z=t.mul(b,T),P=t.mul(E,v),y=t.add(_,b),m=t.add(x,T);y=t.mul(y,m),m=t.add(B,z),y=t.sub(y,m),m=t.add(_,E);let S=t.add(x,v);return m=t.mul(m,S),S=t.add(B,P),m=t.sub(m,S),S=t.add(b,E),I=t.add(T,v),S=t.mul(S,I),I=t.add(z,P),S=t.sub(S,I),D=t.mul(j,m),I=t.mul(N,P),D=t.add(I,D),I=t.sub(z,D),D=t.add(z,D),$=t.mul(I,D),z=t.add(B,B),z=t.add(z,B),P=t.mul(j,P),m=t.mul(N,m),z=t.add(z,P),P=t.sub(B,P),P=t.mul(j,P),m=t.add(m,P),B=t.mul(z,m),$=t.add($,B),B=t.mul(S,m),I=t.mul(y,I),I=t.sub(I,B),B=t.mul(y,z),D=t.mul(S,D),D=t.add(D,B),new d(I,$,D)}subtract(w){return this.add(w.negate())}is0(){return this.equals(d.ZERO)}wNAF(w){return p.wNAFCached(this,w,d.normalizeZ)}multiplyUnsafe(w){const{endo:_,n:b}=e;Nt("scalar",w,Rt,b);const E=d.ZERO;if(w===Rt)return E;if(this.is0()||w===me)return this;if(!_||p.hasPrecomputes(this))return p.wNAFCachedUnsafe(this,w,d.normalizeZ);let{k1neg:x,k1:T,k2neg:v,k2:I}=_.splitScalar(w),$=E,D=E,j=this;for(;T>Rt||I>Rt;)T&me&&($=$.add(j)),I&me&&(D=D.add(j)),j=j.double(),T>>=me,I>>=me;return x&&($=$.negate()),v&&(D=D.negate()),D=new d(t.mul(D.px,_.beta),D.py,D.pz),$.add(D)}multiply(w){const{endo:_,n:b}=e;Nt("scalar",w,me,b);let E,x;if(_){const{k1neg:T,k1:v,k2neg:I,k2:$}=_.splitScalar(w);let{p:D,f:j}=this.wNAF(v),{p:N,f:B}=this.wNAF($);D=p.constTimeNegate(T,D),N=p.constTimeNegate(I,N),N=new d(t.mul(N.px,_.beta),N.py,N.pz),E=D.add(N),x=j.add(B)}else{const{p:T,f:v}=this.wNAF(w);E=T,x=v}return d.normalizeZ([E,x])[0]}multiplyAndAddUnsafe(w,_,b){const E=d.BASE,x=(v,I)=>I===Rt||I===me||!v.equals(E)?v.multiplyUnsafe(I):v.multiply(I),T=x(this,_).add(x(w,b));return T.is0()?void 0:T}toAffine(w){return h(this,w)}isTorsionFree(){const{h:w,isTorsionFree:_}=e;if(w===me)return!0;if(_)return _(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:w,clearCofactor:_}=e;return w===me?this:_?_(d,this):this.multiplyUnsafe(e.h)}toRawBytes(w=!0){return Vr("isCompressed",w),this.assertValidity(),s(d,this,w)}toHex(w=!0){return Vr("isCompressed",w),Kr(this.toRawBytes(w))}}d.BASE=new d(e.Gx,e.Gy,t.ONE),d.ZERO=new d(t.ZERO,t.ONE,t.ZERO);const f=e.nBitLength,p=Ov(d,e.endo?Math.ceil(f/2):f);return{CURVE:e,ProjectivePoint:d,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:a}}function kv(r){const e=Ou(r);return ei(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function Mv(r){const e=kv(r),{Fp:t,n:i}=e,s=t.BYTES+1,n=2*t.BYTES+1;function o(P){return ke(P,i)}function a(P){return Jn(P,i)}const{ProjectivePoint:c,normPrivateKeyToScalar:l,weierstrassEquation:h,isWithinCurveOrder:u}=Lv({...e,toBytes(P,y,m){const S=y.toAffine(),A=t.toBytes(S.x),O=Oi;return Vr("isCompressed",m),m?O(Uint8Array.from([y.hasEvenY()?2:3]),A):O(Uint8Array.from([4]),A,t.toBytes(S.y))},fromBytes(P){const y=P.length,m=P[0],S=P.subarray(1);if(y===s&&(m===2||m===3)){const A=ar(S);if(!Ts(A,me,t.ORDER))throw new Error("Point is not on curve");const O=h(A);let C;try{C=t.sqrt(O)}catch(M){const F=M instanceof Error?": "+M.message:"";throw new Error("Point is not on curve"+F)}const L=(C&me)===me;return(m&1)===1!==L&&(C=t.neg(C)),{x:A,y:C}}else if(y===n&&m===4){const A=t.fromBytes(S.subarray(0,t.BYTES)),O=t.fromBytes(S.subarray(t.BYTES,2*t.BYTES));return{x:A,y:O}}else{const A=s,O=n;throw new Error("invalid Point, expected length of "+A+", or uncompressed "+O+", got "+y)}}}),d=P=>Kr(Gr(P,e.nByteLength));function f(P){const y=i>>me;return P>y}function p(P){return f(P)?o(-P):P}const g=(P,y,m)=>ar(P.slice(y,m));class w{constructor(y,m,S){this.r=y,this.s=m,this.recovery=S,this.assertValidity()}static fromCompact(y){const m=e.nByteLength;return y=Ke("compactSignature",y,m*2),new w(g(y,0,m),g(y,m,2*m))}static fromDER(y){const{r:m,s:S}=Tt.toSig(Ke("DER",y));return new w(m,S)}assertValidity(){Nt("r",this.r,me,i),Nt("s",this.s,me,i)}addRecoveryBit(y){return new w(this.r,this.s,y)}recoverPublicKey(y){const{r:m,s:S,recovery:A}=this,O=v(Ke("msgHash",y));if(A==null||![0,1,2,3].includes(A))throw new Error("recovery id invalid");const C=A===2||A===3?m+e.n:m;if(C>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");const L=(A&1)===0?"02":"03",M=c.fromHex(L+d(C)),F=a(C),k=o(-O*F),H=o(S*F),V=c.BASE.multiplyAndAddUnsafe(M,k,H);if(!V)throw new Error("point at infinify");return V.assertValidity(),V}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new w(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return Wr(this.toDERHex())}toDERHex(){return Tt.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Wr(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const _={isValidPrivateKey(P){try{return l(P),!0}catch{return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{const P=Iu(e.n);return Iv(e.randomBytes(P),e.n)},precompute(P=8,y=c.BASE){return y._setWindowSize(P),y.multiply(BigInt(3)),y}};function b(P,y=!0){return c.fromPrivateKey(P).toRawBytes(y)}function E(P){const y=ur(P),m=typeof P=="string",S=(y||m)&&P.length;return y?S===s||S===n:m?S===2*s||S===2*n:P instanceof c}function x(P,y,m=!0){if(E(P))throw new Error("first arg must be private key");if(!E(y))throw new Error("second arg must be public key");return c.fromHex(y).multiply(l(P)).toRawBytes(m)}const T=e.bits2int||function(P){if(P.length>8192)throw new Error("input is too large");const y=ar(P),m=P.length*8-e.nBitLength;return m>0?y>>BigInt(m):y},v=e.bits2int_modN||function(P){return o(T(P))},I=Bo(e.nBitLength);function $(P){return Nt("num < 2^"+e.nBitLength,P,Rt,I),Gr(P,e.nByteLength)}function D(P,y,m=j){if(["recovered","canonical"].some(ee=>ee in m))throw new Error("sign() legacy options not supported");const{hash:S,randomBytes:A}=e;let{lowS:O,prehash:C,extraEntropy:L}=m;O==null&&(O=!0),P=Ke("msgHash",P),Ec(m),C&&(P=Ke("prehashed msgHash",S(P)));const M=v(P),F=l(y),k=[$(F),$(M)];if(L!=null&&L!==!1){const ee=L===!0?A(t.BYTES):L;k.push(Ke("extraEntropy",ee))}const H=Oi(...k),V=M;function ne(ee){const Y=T(ee);if(!u(Y))return;const Ae=a(Y),_e=c.BASE.multiply(Y).toAffine(),Te=o(_e.x);if(Te===Rt)return;const Ze=o(Ae*o(V+Te*F));if(Ze===Rt)return;let St=(_e.x===Te?0:2)|Number(_e.y&me),mr=Ze;return O&&f(Ze)&&(mr=p(Ze),St^=1),new w(Te,mr,St)}return{seed:H,k2sig:ne}}const j={lowS:e.lowS,prehash:!1},N={lowS:e.lowS,prehash:!1};function B(P,y,m=j){const{seed:S,k2sig:A}=D(P,y,m),O=e;return wu(O.hash.outputLen,O.nByteLength,O.hmac)(S,A)}c.BASE._setWindowSize(8);function z(P,y,m,S=N){const A=P;y=Ke("msgHash",y),m=Ke("publicKey",m);const{lowS:O,prehash:C,format:L}=S;if(Ec(S),"strict"in S)throw new Error("options.strict was renamed to lowS");if(L!==void 0&&L!=="compact"&&L!=="der")throw new Error("format must be compact or der");const M=typeof A=="string"||ur(A),F=!M&&!L&&typeof A=="object"&&A!==null&&typeof A.r=="bigint"&&typeof A.s=="bigint";if(!M&&!F)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let k,H;try{if(F&&(k=new w(A.r,A.s)),M){try{L!=="compact"&&(k=w.fromDER(A))}catch(Ze){if(!(Ze instanceof Tt.Err))throw Ze}!k&&L!=="der"&&(k=w.fromCompact(A))}H=c.fromHex(m)}catch{return!1}if(!k||O&&k.hasHighS())return!1;C&&(y=e.hash(y));const{r:V,s:ne}=k,ee=v(y),Y=a(ne),Ae=o(ee*Y),_e=o(V*Y),Te=c.BASE.multiplyAndAddUnsafe(H,Ae,_e)?.toAffine();return Te?o(Te.x)===V:!1}return{CURVE:e,getPublicKey:b,getSharedSecret:x,sign:B,verify:z,ProjectivePoint:c,Signature:w,utils:_}}function zv(r){return{hash:r,hmac:(e,...t)=>Ps(r,e,Kw(...t)),randomBytes:Xr}}function Fv(r,e){const t=i=>Mv({...r,...zv(i)});return{...t(e),create:t}}const $u=Eu(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),Hv=$u.create(BigInt("-3")),Vv=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Kv=Fv({a:Hv,b:Vv,Fp:$u,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},Ri),Pu="base10",Ne="base16",ut="base64pad",Ft="base64url",ji="utf8",xu=0,jt=1,Bi=2,Wv=0,Ic=1,mi=12,Uo=32;function Gv(){const r=Qn.utils.randomPrivateKey(),e=Qn.getPublicKey(r);return{privateKey:Me(r,Ne),publicKey:Me(e,Ne)}}function Xn(){const r=Xr(Uo);return Me(r,Ne)}function Yv(r,e){const t=Qn.getSharedSecret(rt(r,Ne),rt(e,Ne)),i=Xb(Ri,t,void 0,void 0,Uo);return Me(i,Ne)}function ns(r){const e=Ri(rt(r,Ne));return Me(e,Ne)}function Et(r){const e=Ri(rt(r,ji));return Me(e,Ne)}function Au(r){return rt(`${r}`,Pu)}function dr(r){return Number(Me(r,Pu))}function Cu(r){return r.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function Tu(r){const e=r.replace(/-/g,"+").replace(/_/g,"/"),t=(4-e.length%4)%4;return e+"=".repeat(t)}function Jv(r){const e=Au(typeof r.type<"u"?r.type:xu);if(dr(e)===jt&&typeof r.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const t=typeof r.senderPublicKey<"u"?rt(r.senderPublicKey,Ne):void 0,i=typeof r.iv<"u"?rt(r.iv,Ne):Xr(mi),s=rt(r.symKey,Ne),n=gu(s,i).encrypt(rt(r.message,ji)),o=Ru({type:e,sealed:n,iv:i,senderPublicKey:t});return r.encoding===Ft?Cu(o):o}function Zv(r){const e=rt(r.symKey,Ne),{sealed:t,iv:i}=$i({encoded:r.encoded,encoding:r.encoding}),s=gu(e,i).decrypt(t);if(s===null)throw new Error("Failed to decrypt");return Me(s,ji)}function Qv(r,e){const t=Au(Bi),i=Xr(mi),s=rt(r,ji),n=Ru({type:t,sealed:s,iv:i});return e===Ft?Cu(n):n}function Xv(r,e){const{sealed:t}=$i({encoded:r,encoding:e});return Me(t,ji)}function Ru(r){if(dr(r.type)===Bi)return Me(yi([r.type,r.sealed]),ut);if(dr(r.type)===jt){if(typeof r.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Me(yi([r.type,r.senderPublicKey,r.iv,r.sealed]),ut)}return Me(yi([r.type,r.iv,r.sealed]),ut)}function $i(r){const e=(r.encoding||ut)===Ft?Tu(r.encoded):r.encoded,t=rt(e,ut),i=t.slice(Wv,Ic),s=Ic;if(dr(i)===jt){const c=s+Uo,l=c+mi,h=t.slice(s,c),u=t.slice(c,l),d=t.slice(l);return{type:i,sealed:d,iv:u,senderPublicKey:h}}if(dr(i)===Bi){const c=t.slice(s),l=Xr(mi);return{type:i,sealed:c,iv:l}}const n=s+mi,o=t.slice(s,n),a=t.slice(n);return{type:i,sealed:a,iv:o}}function e0(r,e){const t=$i({encoded:r,encoding:e?.encoding});return Nu({type:dr(t.type),senderPublicKey:typeof t.senderPublicKey<"u"?Me(t.senderPublicKey,Ne):void 0,receiverPublicKey:e?.receiverPublicKey})}function Nu(r){const e=r?.type||xu;if(e===jt){if(typeof r?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof r?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:r?.senderPublicKey,receiverPublicKey:r?.receiverPublicKey}}function Sc(r){return r.type===jt&&typeof r.senderPublicKey=="string"&&typeof r.receiverPublicKey=="string"}function Dc(r){return r.type===Bi}function t0(r){const e=Ee.from(r.x,"base64"),t=Ee.from(r.y,"base64");return yi([new Uint8Array([4]),e,t])}function r0(r,e){const[t,i,s]=r.split("."),n=Ee.from(Tu(s),"base64");if(n.length!==64)throw new Error("Invalid signature length");const o=n.slice(0,32),a=n.slice(32,64),c=`${t}.${i}`,l=Ri(c),h=t0(e);if(!Kv.verify(yi([o,a]),l,h))throw new Error("Invalid signature");return Mn(r).payload}const i0="irn";function gs(r){return r?.relay||{protocol:i0}}function fi(r){const e=cw[r];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${r}`);return e}function s0(r,e="-"){const t={},i="relay"+e;return Object.keys(r).forEach(s=>{if(s.startsWith(i)){const n=s.replace(i,""),o=r[s];t[n]=o}}),t}function Oc(r){if(!r.includes("wc:")){const l=ru(r);l!=null&&l.includes("wc:")&&(r=l)}r=r.includes("wc://")?r.replace("wc://",""):r,r=r.includes("wc:")?r.replace("wc:",""):r;const e=r.indexOf(":"),t=r.indexOf("?")!==-1?r.indexOf("?"):void 0,i=r.substring(0,e),s=r.substring(e+1,t).split("@"),n=typeof t<"u"?r.substring(t):"",o=new URLSearchParams(n),a={};o.forEach((l,h)=>{a[h]=l});const c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:i,topic:n0(s[0]),version:parseInt(s[1],10),symKey:a.symKey,relay:s0(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function n0(r){return r.startsWith("//")?r.substring(2):r}function o0(r,e="-"){const t="relay",i={};return Object.keys(r).forEach(s=>{const n=s,o=t+e+n;r[n]&&(i[o]=r[n])}),i}function $c(r){const e=new URLSearchParams,t=o0(r.relay);Object.keys(t).sort().forEach(s=>{e.set(s,t[s])}),e.set("symKey",r.symKey),r.expiryTimestamp&&e.set("expiryTimestamp",r.expiryTimestamp.toString()),r.methods&&e.set("methods",r.methods.join(","));const i=e.toString();return`${r.protocol}:${r.topic}@${r.version}?${i}`}function Wi(r,e,t){return`${r}?wc_ev=${t}&topic=${e}`}var a0=Object.defineProperty,c0=Object.defineProperties,l0=Object.getOwnPropertyDescriptors,Pc=Object.getOwnPropertySymbols,h0=Object.prototype.hasOwnProperty,u0=Object.prototype.propertyIsEnumerable,xc=(r,e,t)=>e in r?a0(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,d0=(r,e)=>{for(var t in e||(e={}))h0.call(e,t)&&xc(r,t,e[t]);if(Pc)for(var t of Pc(e))u0.call(e,t)&&xc(r,t,e[t]);return r},p0=(r,e)=>c0(r,l0(e));function ti(r){const e=[];return r.forEach(t=>{const[i,s]=t.split(":");e.push(`${i}:${s}`)}),e}function f0(r){const e=[];return Object.values(r).forEach(t=>{e.push(...ti(t.accounts))}),e}function g0(r,e){const t=[];return Object.values(r).forEach(i=>{ti(i.accounts).includes(e)&&t.push(...i.methods)}),t}function y0(r,e){const t=[];return Object.values(r).forEach(i=>{ti(i.accounts).includes(e)&&t.push(...i.events)}),t}function Rs(r){return r.includes(":")}function Lr(r){return Rs(r)?r.split(":")[0]:r}function Ac(r){var e,t,i;const s={};if(!Wt(r))return s;for(const[n,o]of Object.entries(r)){const a=Rs(n)?[n]:o.chains,c=o.methods||[],l=o.events||[],h=Lr(n);s[h]=p0(d0({},s[h]),{chains:_t(a,(e=s[h])==null?void 0:e.chains),methods:_t(c,(t=s[h])==null?void 0:t.methods),events:_t(l,(i=s[h])==null?void 0:i.events)})}return s}function m0(r){const e={};return r?.forEach(t=>{var i;const[s,n]=t.split(":");e[s]||(e[s]={accounts:[],chains:[],events:[],methods:[]}),e[s].accounts.push(t),(i=e[s].chains)==null||i.push(`${s}:${n}`)}),e}function Cc(r,e){e=e.map(i=>i.replace("did:pkh:",""));const t=m0(e);for(const[i,s]of Object.entries(t))s.methods?s.methods=_t(s.methods,r):s.methods=r,s.events=["chainChanged","accountsChanged"];return t}function w0(r,e){var t,i,s,n,o,a;const c=Ac(r),l=Ac(e),h={},u=Object.keys(c).concat(Object.keys(l));for(const d of u)h[d]={chains:_t((t=c[d])==null?void 0:t.chains,(i=l[d])==null?void 0:i.chains),methods:_t((s=c[d])==null?void 0:s.methods,(n=l[d])==null?void 0:n.methods),events:_t((o=c[d])==null?void 0:o.events,(a=l[d])==null?void 0:a.events)};return h}const b0={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},v0={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function q(r,e){const{message:t,code:i}=v0[r];return{message:e?`${t} ${e}`:t,code:i}}function te(r,e){const{message:t,code:i}=b0[r];return{message:e?`${t} ${e}`:t,code:i}}function dt(r,e){return!!Array.isArray(r)}function Wt(r){return Object.getPrototypeOf(r)===Object.prototype&&Object.keys(r).length}function Oe(r){return typeof r>"u"}function ue(r,e){return e&&Oe(r)?!0:typeof r=="string"&&!!r.trim().length}function qo(r,e){return e&&Oe(r)?!0:typeof r=="number"&&!isNaN(r)}function E0(r,e){const{requiredNamespaces:t}=e,i=Object.keys(r.namespaces),s=Object.keys(t);let n=!0;return nr(s,i)?(i.forEach(o=>{const{accounts:a,methods:c,events:l}=r.namespaces[o],h=ti(a),u=t[o];(!nr(Zh(o,u),h)||!nr(u.methods,c)||!nr(u.events,l))&&(n=!1)}),n):!1}function ys(r){return ue(r,!1)&&r.includes(":")?r.split(":").length===2:!1}function _0(r){if(ue(r,!1)&&r.includes(":")){const e=r.split(":");if(e.length===3){const t=e[0]+":"+e[1];return!!e[2]&&ys(t)}}return!1}function I0(r){function e(t){try{return typeof new URL(t)<"u"}catch{return!1}}try{if(ue(r,!1)){if(e(r))return!0;const t=ru(r);return e(t)}}catch{}return!1}function S0(r){var e;return(e=r?.proposer)==null?void 0:e.publicKey}function D0(r){return r?.topic}function O0(r,e){let t=null;return ue(r?.publicKey,!1)||(t=q("MISSING_OR_INVALID",`${e} controller public key should be a string`)),t}function Tc(r){let e=!0;return dt(r)?r.length&&(e=r.every(t=>ue(t,!1))):e=!1,e}function $0(r,e,t){let i=null;return dt(e)&&e.length?e.forEach(s=>{i||ys(s)||(i=te("UNSUPPORTED_CHAINS",`${t}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):ys(r)||(i=te("UNSUPPORTED_CHAINS",`${t}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function P0(r,e,t){let i=null;return Object.entries(r).forEach(([s,n])=>{if(i)return;const o=$0(s,Zh(s,n),`${e} ${t}`);o&&(i=o)}),i}function x0(r,e){let t=null;return dt(r)?r.forEach(i=>{t||_0(i)||(t=te("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):t=te("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),t}function A0(r,e){let t=null;return Object.values(r).forEach(i=>{if(t)return;const s=x0(i?.accounts,`${e} namespace`);s&&(t=s)}),t}function C0(r,e){let t=null;return Tc(r?.methods)?Tc(r?.events)||(t=te("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):t=te("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),t}function ju(r,e){let t=null;return Object.values(r).forEach(i=>{if(t)return;const s=C0(i,`${e}, namespace`);s&&(t=s)}),t}function T0(r,e,t){let i=null;if(r&&Wt(r)){const s=ju(r,e);s&&(i=s);const n=P0(r,e,t);n&&(i=n)}else i=q("MISSING_OR_INVALID",`${e}, ${t} should be an object with data`);return i}function gn(r,e){let t=null;if(r&&Wt(r)){const i=ju(r,e);i&&(t=i);const s=A0(r,e);s&&(t=s)}else t=q("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return t}function Bu(r){return ue(r.protocol,!0)}function R0(r,e){let t=!1;return r?r&&dt(r)&&r.length&&r.forEach(i=>{t=Bu(i)}):t=!0,t}function N0(r){return typeof r=="number"}function Le(r){return typeof r<"u"&&typeof r!==null}function j0(r){return!(!r||typeof r!="object"||!r.code||!qo(r.code,!1)||!r.message||!ue(r.message,!1))}function B0(r){return!(Oe(r)||!ue(r.method,!1))}function U0(r){return!(Oe(r)||Oe(r.result)&&Oe(r.error)||!qo(r.id,!1)||!ue(r.jsonrpc,!1))}function q0(r){return!(Oe(r)||!ue(r.name,!1))}function Rc(r,e){return!(!ys(e)||!f0(r).includes(e))}function L0(r,e,t){return ue(t,!1)?g0(r,e).includes(t):!1}function k0(r,e,t){return ue(t,!1)?y0(r,e).includes(t):!1}function Nc(r,e,t){let i=null;const s=M0(r),n=z0(e),o=Object.keys(s),a=Object.keys(n),c=jc(Object.keys(r)),l=jc(Object.keys(e)),h=c.filter(u=>!l.includes(u));return h.length&&(i=q("NON_CONFORMING_NAMESPACES",`${t} namespaces keys don't satisfy requiredNamespaces.
      Required: ${h.toString()}
      Received: ${Object.keys(e).toString()}`)),nr(o,a)||(i=q("NON_CONFORMING_NAMESPACES",`${t} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(u=>{if(!u.includes(":")||i)return;const d=ti(e[u].accounts);d.includes(u)||(i=q("NON_CONFORMING_NAMESPACES",`${t} namespaces accounts don't satisfy namespace accounts for ${u}
        Required: ${u}
        Approved: ${d.toString()}`))}),o.forEach(u=>{i||(nr(s[u].methods,n[u].methods)?nr(s[u].events,n[u].events)||(i=q("NON_CONFORMING_NAMESPACES",`${t} namespaces events don't satisfy namespace events for ${u}`)):i=q("NON_CONFORMING_NAMESPACES",`${t} namespaces methods don't satisfy namespace methods for ${u}`))}),i}function M0(r){const e={};return Object.keys(r).forEach(t=>{var i;t.includes(":")?e[t]=r[t]:(i=r[t].chains)==null||i.forEach(s=>{e[s]={methods:r[t].methods,events:r[t].events}})}),e}function jc(r){return[...new Set(r.map(e=>e.includes(":")?e.split(":")[0]:e))]}function z0(r){const e={};return Object.keys(r).forEach(t=>{t.includes(":")?e[t]=r[t]:ti(r[t].accounts)?.forEach(s=>{e[s]={accounts:r[t].accounts.filter(n=>n.includes(`${s}:`)),methods:r[t].methods,events:r[t].events}})}),e}function F0(r,e){return qo(r,!1)&&r<=e.max&&r>=e.min}function Bc(){const r=Ci();return new Promise(e=>{switch(r){case Ge.browser:e(H0());break;case Ge.reactNative:e(V0());break;case Ge.node:e(K0());break;default:e(!0)}})}function H0(){return Qr()&&navigator?.onLine}async function V0(){return Gt()&&typeof globalThis<"u"&&globalThis!=null&&globalThis.NetInfo?(await globalThis?.NetInfo.fetch())?.isConnected:!0}function K0(){return!0}function W0(r){switch(Ci()){case Ge.browser:G0(r);break;case Ge.reactNative:Y0(r);break}}function G0(r){!Gt()&&Qr()&&(window.addEventListener("online",()=>r(!0)),window.addEventListener("offline",()=>r(!1)))}function Y0(r){Gt()&&typeof globalThis<"u"&&globalThis!=null&&globalThis.NetInfo&&globalThis?.NetInfo.addEventListener(e=>r(e?.isConnected))}function J0(){var r;return Qr()&&Bt.getDocument()?((r=Bt.getDocument())==null?void 0:r.visibilityState)==="visible":!0}const yn={};class ci{static get(e){return yn[e]}static set(e,t){yn[e]=t}static delete(e){delete yn[e]}}pr=class{};let Z0=class extends pr{constructor(e){super()}};let Uc;Uc=U.FIVE_SECONDS;fr={pulse:"heartbeat_pulse"};Q0=class Uu extends Z0{constructor(e){super(e),this.events=new Je.EventEmitter,this.interval=Uc,this.interval=e?.interval||Uc}static async init(e){const t=new Uu(e);return await t.init(),t}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),U.toMiliseconds(this.interval))}pulse(){this.events.emit(fr.pulse)}};const X0=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,eE=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,tE=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function rE(r,e){if(r==="__proto__"||r==="constructor"&&e&&typeof e=="object"&&"prototype"in e){iE(r);return}return e}function iE(r){console.warn(`[destr] Dropping "${r}" key to prevent prototype pollution.`)}function Gi(r,e={}){if(typeof r!="string")return r;if(r[0]==='"'&&r[r.length-1]==='"'&&r.indexOf("\\")===-1)return r.slice(1,-1);const t=r.trim();if(t.length<=9)switch(t.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!tE.test(r)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return r}try{if(X0.test(r)||eE.test(r)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(r,rE)}return JSON.parse(r)}catch(i){if(e.strict)throw i;return r}}function sE(r){return!r||typeof r.then!="function"?Promise.resolve(r):r}function ye(r,...e){try{return sE(r(...e))}catch(t){return Promise.reject(t)}}function nE(r){const e=typeof r;return r===null||e!=="object"&&e!=="function"}function oE(r){const e=Object.getPrototypeOf(r);return!e||e.isPrototypeOf(Object)}function os(r){if(nE(r))return String(r);if(oE(r)||Array.isArray(r))return JSON.stringify(r);if(typeof r.toJSON=="function")return os(r.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const eo="base64:";function aE(r){return typeof r=="string"?r:eo+hE(r)}function cE(r){return typeof r!="string"||!r.startsWith(eo)?r:lE(r.slice(eo.length))}function lE(r){return globalThis.Buffer?Ee.from(r,"base64"):Uint8Array.from(globalThis.atob(r),e=>e.codePointAt(0))}function hE(r){return globalThis.Buffer?Ee.from(r).toString("base64"):globalThis.btoa(String.fromCodePoint(...r))}function qe(r){return r&&r.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function uE(...r){return qe(r.join(":"))}function Yi(r){return r=qe(r),r?r+":":""}function dE(r,e){if(e===void 0)return!0;let t=0,i=r.indexOf(":");for(;i>-1;)t++,i=r.indexOf(":",i+1);return t<=e}function pE(r,e){return e?r.startsWith(e)&&r[r.length-1]!=="$":r[r.length-1]!=="$"}const fE="memory",gE=()=>{const r=new Map;return{name:fE,getInstance:()=>r,hasItem(e){return r.has(e)},getItem(e){return r.get(e)??null},getItemRaw(e){return r.get(e)??null},setItem(e,t){r.set(e,t)},setItemRaw(e,t){r.set(e,t)},removeItem(e){r.delete(e)},getKeys(){return[...r.keys()]},clear(){r.clear()},dispose(){r.clear()}}};function yE(r={}){const e={mounts:{"":r.driver||gE()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},t=l=>{for(const h of e.mountpoints)if(l.startsWith(h))return{base:h,relativeKey:l.slice(h.length),driver:e.mounts[h]};return{base:"",relativeKey:l,driver:e.mounts[""]}},i=(l,h)=>e.mountpoints.filter(u=>u.startsWith(l)||h&&l.startsWith(u)).map(u=>({relativeBase:l.length>u.length?l.slice(u.length):void 0,mountpoint:u,driver:e.mounts[u]})),s=(l,h)=>{if(e.watching){h=qe(h);for(const u of e.watchListeners)u(l,h)}},n=async()=>{if(!e.watching){e.watching=!0;for(const l in e.mounts)e.unwatch[l]=await qc(e.mounts[l],s,l)}},o=async()=>{if(e.watching){for(const l in e.unwatch)await e.unwatch[l]();e.unwatch={},e.watching=!1}},a=(l,h,u)=>{const d=new Map,f=p=>{let g=d.get(p.base);return g||(g={driver:p.driver,base:p.base,items:[]},d.set(p.base,g)),g};for(const p of l){const g=typeof p=="string",w=qe(g?p:p.key),_=g?void 0:p.value,b=g||!p.options?h:{...h,...p.options},E=t(w);f(E).items.push({key:w,value:_,relativeKey:E.relativeKey,options:b})}return Promise.all([...d.values()].map(p=>u(p))).then(p=>p.flat())},c={hasItem(l,h={}){l=qe(l);const{relativeKey:u,driver:d}=t(l);return ye(d.hasItem,u,h)},getItem(l,h={}){l=qe(l);const{relativeKey:u,driver:d}=t(l);return ye(d.getItem,u,h).then(f=>Gi(f))},getItems(l,h={}){return a(l,h,u=>u.driver.getItems?ye(u.driver.getItems,u.items.map(d=>({key:d.relativeKey,options:d.options})),h).then(d=>d.map(f=>({key:uE(u.base,f.key),value:Gi(f.value)}))):Promise.all(u.items.map(d=>ye(u.driver.getItem,d.relativeKey,d.options).then(f=>({key:d.key,value:Gi(f)})))))},getItemRaw(l,h={}){l=qe(l);const{relativeKey:u,driver:d}=t(l);return d.getItemRaw?ye(d.getItemRaw,u,h):ye(d.getItem,u,h).then(f=>cE(f))},async setItem(l,h,u={}){if(h===void 0)return c.removeItem(l);l=qe(l);const{relativeKey:d,driver:f}=t(l);f.setItem&&(await ye(f.setItem,d,os(h),u),f.watch||s("update",l))},async setItems(l,h){await a(l,h,async u=>{if(u.driver.setItems)return ye(u.driver.setItems,u.items.map(d=>({key:d.relativeKey,value:os(d.value),options:d.options})),h);u.driver.setItem&&await Promise.all(u.items.map(d=>ye(u.driver.setItem,d.relativeKey,os(d.value),d.options)))})},async setItemRaw(l,h,u={}){if(h===void 0)return c.removeItem(l,u);l=qe(l);const{relativeKey:d,driver:f}=t(l);if(f.setItemRaw)await ye(f.setItemRaw,d,h,u);else if(f.setItem)await ye(f.setItem,d,aE(h),u);else return;f.watch||s("update",l)},async removeItem(l,h={}){typeof h=="boolean"&&(h={removeMeta:h}),l=qe(l);const{relativeKey:u,driver:d}=t(l);d.removeItem&&(await ye(d.removeItem,u,h),(h.removeMeta||h.removeMata)&&await ye(d.removeItem,u+"$",h),d.watch||s("remove",l))},async getMeta(l,h={}){typeof h=="boolean"&&(h={nativeOnly:h}),l=qe(l);const{relativeKey:u,driver:d}=t(l),f=Object.create(null);if(d.getMeta&&Object.assign(f,await ye(d.getMeta,u,h)),!h.nativeOnly){const p=await ye(d.getItem,u+"$",h).then(g=>Gi(g));p&&typeof p=="object"&&(typeof p.atime=="string"&&(p.atime=new Date(p.atime)),typeof p.mtime=="string"&&(p.mtime=new Date(p.mtime)),Object.assign(f,p))}return f},setMeta(l,h,u={}){return this.setItem(l+"$",h,u)},removeMeta(l,h={}){return this.removeItem(l+"$",h)},async getKeys(l,h={}){l=Yi(l);const u=i(l,!0);let d=[];const f=[];let p=!0;for(const w of u){w.driver.flags?.maxDepth||(p=!1);const _=await ye(w.driver.getKeys,w.relativeBase,h);for(const b of _){const E=w.mountpoint+qe(b);d.some(x=>E.startsWith(x))||f.push(E)}d=[w.mountpoint,...d.filter(b=>!b.startsWith(w.mountpoint))]}const g=h.maxDepth!==void 0&&!p;return f.filter(w=>(!g||dE(w,h.maxDepth))&&pE(w,l))},async clear(l,h={}){l=Yi(l),await Promise.all(i(l,!1).map(async u=>{if(u.driver.clear)return ye(u.driver.clear,u.relativeBase,h);if(u.driver.removeItem){const d=await u.driver.getKeys(u.relativeBase||"",h);return Promise.all(d.map(f=>u.driver.removeItem(f,h)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(l=>Lc(l)))},async watch(l){return await n(),e.watchListeners.push(l),async()=>{e.watchListeners=e.watchListeners.filter(h=>h!==l),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(l,h){if(l=Yi(l),l&&e.mounts[l])throw new Error(`already mounted at ${l}`);return l&&(e.mountpoints.push(l),e.mountpoints.sort((u,d)=>d.length-u.length)),e.mounts[l]=h,e.watching&&Promise.resolve(qc(h,s,l)).then(u=>{e.unwatch[l]=u}).catch(console.error),c},async unmount(l,h=!0){l=Yi(l),!(!l||!e.mounts[l])&&(e.watching&&l in e.unwatch&&(e.unwatch[l]?.(),delete e.unwatch[l]),h&&await Lc(e.mounts[l]),e.mountpoints=e.mountpoints.filter(u=>u!==l),delete e.mounts[l])},getMount(l=""){l=qe(l)+":";const h=t(l);return{driver:h.driver,base:h.base}},getMounts(l="",h={}){return l=qe(l),i(l,h.parents).map(d=>({driver:d.driver,base:d.mountpoint}))},keys:(l,h={})=>c.getKeys(l,h),get:(l,h={})=>c.getItem(l,h),set:(l,h,u={})=>c.setItem(l,h,u),has:(l,h={})=>c.hasItem(l,h),del:(l,h={})=>c.removeItem(l,h),remove:(l,h={})=>c.removeItem(l,h)};return c}function qc(r,e,t){return r.watch?r.watch((i,s)=>e(i,t+s)):()=>{}}async function Lc(r){typeof r.dispose=="function"&&await ye(r.dispose)}const mE="idb-keyval";var wE=(r={})=>{const e=r.base&&r.base.length>0?`${r.base}:`:"",t=s=>e+s;let i;return r.dbName&&r.storeName&&(i=Rd(r.dbName,r.storeName)),{name:mE,options:r,async hasItem(s){return!(typeof await Qo(t(s),i)>"u")},async getItem(s){return await Qo(t(s),i)??null},setItem(s,n){return Ud(t(s),n,i)},removeItem(s){return Bd(t(s),i)},getKeys(){return jd(i)},clear(){return Nd(i)}}};const bE="WALLET_CONNECT_V2_INDEXED_DB",vE="keyvaluestorage";let EE=class{constructor(){this.indexedDb=yE({driver:wE({dbName:bE,storeName:vE})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const t=await this.indexedDb.getItem(e);if(t!==null)return t}async setItem(e,t){await this.indexedDb.setItem(e,Ut(t))}async removeItem(e){await this.indexedDb.removeItem(e)}};var mn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},as={exports:{}};(function(){let r;function e(){}r=e,r.prototype.getItem=function(t){return this.hasOwnProperty(t)?String(this[t]):null},r.prototype.setItem=function(t,i){this[t]=String(i)},r.prototype.removeItem=function(t){delete this[t]},r.prototype.clear=function(){const t=this;Object.keys(t).forEach(function(i){t[i]=void 0,delete t[i]})},r.prototype.key=function(t){return t=t||0,Object.keys(this)[t]},r.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof mn<"u"&&mn.localStorage?as.exports=mn.localStorage:typeof window<"u"&&window.localStorage?as.exports=window.localStorage:as.exports=new e})();function _E(r){var e;return[r[0],lr((e=r[1])!=null?e:"")]}let IE=class{constructor(){this.localStorage=as.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(_E)}async getItem(e){const t=this.localStorage.getItem(e);if(t!==null)return lr(t)}async setItem(e,t){this.localStorage.setItem(e,Ut(t))}async removeItem(e){this.localStorage.removeItem(e)}};const SE="wc_storage_version",kc=1,DE=async(r,e,t)=>{const i=SE,s=await e.getItem(i);if(s&&s>=kc){t(e);return}const n=await r.getKeys();if(!n.length){t(e);return}const o=[];for(;n.length;){const a=n.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const l=await r.getItem(a);await e.setItem(a,l),o.push(a)}}await e.setItem(i,kc),t(e),OE(r,o)},OE=async(r,e)=>{e.length&&e.forEach(async t=>{await r.removeItem(t)})};$E=class{constructor(){this.initialized=!1,this.setInitialized=t=>{this.storage=t,this.initialized=!0};const e=new IE;this.storage=e;try{const t=new EE;DE(e,t,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,t){return await this.initialize(),this.storage.setItem(e,t)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const t=setInterval(()=>{this.initialized&&(clearInterval(t),e())},20)})}};var wn,Mc;function PE(){if(Mc)return wn;Mc=1;function r(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}wn=e;function e(t,i,s){var n=s&&s.stringify||r,o=1;if(typeof t=="object"&&t!==null){var a=i.length+o;if(a===1)return t;var c=new Array(a);c[0]=n(t);for(var l=1;l<a;l++)c[l]=n(i[l]);return c.join(" ")}if(typeof t!="string")return t;var h=i.length;if(h===0)return t;for(var u="",d=1-o,f=-1,p=t&&t.length||0,g=0;g<p;){if(t.charCodeAt(g)===37&&g+1<p){switch(f=f>-1?f:0,t.charCodeAt(g+1)){case 100:case 102:if(d>=h||i[d]==null)break;f<g&&(u+=t.slice(f,g)),u+=Number(i[d]),f=g+2,g++;break;case 105:if(d>=h||i[d]==null)break;f<g&&(u+=t.slice(f,g)),u+=Math.floor(Number(i[d])),f=g+2,g++;break;case 79:case 111:case 106:if(d>=h||i[d]===void 0)break;f<g&&(u+=t.slice(f,g));var w=typeof i[d];if(w==="string"){u+="'"+i[d]+"'",f=g+2,g++;break}if(w==="function"){u+=i[d].name||"<anonymous>",f=g+2,g++;break}u+=n(i[d]),f=g+2,g++;break;case 115:if(d>=h)break;f<g&&(u+=t.slice(f,g)),u+=String(i[d]),f=g+2,g++;break;case 37:f<g&&(u+=t.slice(f,g)),u+="%",f=g+2,g++,d--;break}++d}++g}return f===-1?t:(f<p&&(u+=t.slice(f)),u)}return wn}var bn,zc;function xE(){if(zc)return bn;zc=1;const r=PE();bn=s;const e=T().console||{},t={mapHttpRequest:p,mapHttpResponse:p,wrapRequestSerializer:g,wrapResponseSerializer:g,wrapErrorSerializer:g,req:p,res:p,err:d};function i(v,I){return Array.isArray(v)?v.filter(function(D){return D!=="!stdSerializers.err"}):v===!0?Object.keys(I):!1}function s(v){v=v||{},v.browser=v.browser||{};const I=v.browser.transmit;if(I&&typeof I.send!="function")throw Error("pino: transmit option must have a send function");const $=v.browser.write||e;v.browser.write&&(v.browser.asObject=!0);const D=v.serializers||{},j=i(v.browser.serialize,D);let N=v.browser.serialize;Array.isArray(v.browser.serialize)&&v.browser.serialize.indexOf("!stdSerializers.err")>-1&&(N=!1);const B=["error","fatal","warn","info","debug","trace"];typeof $=="function"&&($.error=$.fatal=$.warn=$.info=$.debug=$.trace=$),v.enabled===!1&&(v.level="silent");const z=v.level||"info",P=Object.create($);P.log||(P.log=w),Object.defineProperty(P,"levelVal",{get:m}),Object.defineProperty(P,"level",{get:S,set:A});const y={transmit:I,serialize:j,asObject:v.browser.asObject,levels:B,timestamp:f(v)};P.levels=s.levels,P.level=z,P.setMaxListeners=P.getMaxListeners=P.emit=P.addListener=P.on=P.prependListener=P.once=P.prependOnceListener=P.removeListener=P.removeAllListeners=P.listeners=P.listenerCount=P.eventNames=P.write=P.flush=w,P.serializers=D,P._serialize=j,P._stdErrSerialize=N,P.child=O,I&&(P._logEvent=u());function m(){return this.level==="silent"?1/0:this.levels.values[this.level]}function S(){return this._level}function A(C){if(C!=="silent"&&!this.levels.values[C])throw Error("unknown level "+C);this._level=C,n(y,P,"error","log"),n(y,P,"fatal","error"),n(y,P,"warn","error"),n(y,P,"info","log"),n(y,P,"debug","log"),n(y,P,"trace","log")}function O(C,L){if(!C)throw new Error("missing bindings for child Pino");L=L||{},j&&C.serializers&&(L.serializers=C.serializers);const M=L.serializers;if(j&&M){var F=Object.assign({},D,M),k=v.browser.serialize===!0?Object.keys(F):j;delete C.serializers,c([C],k,F,this._stdErrSerialize)}function H(V){this._childLevel=(V._childLevel|0)+1,this.error=l(V,C,"error"),this.fatal=l(V,C,"fatal"),this.warn=l(V,C,"warn"),this.info=l(V,C,"info"),this.debug=l(V,C,"debug"),this.trace=l(V,C,"trace"),F&&(this.serializers=F,this._serialize=k),I&&(this._logEvent=u([].concat(V._logEvent.bindings,C)))}return H.prototype=this,new H(this)}return P}s.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},s.stdSerializers=t,s.stdTimeFunctions=Object.assign({},{nullTime:_,epochTime:b,unixTime:E,isoTime:x});function n(v,I,$,D){const j=Object.getPrototypeOf(I);I[$]=I.levelVal>I.levels.values[$]?w:j[$]?j[$]:e[$]||e[D]||w,o(v,I,$)}function o(v,I,$){!v.transmit&&I[$]===w||(I[$]=(function(D){return function(){const N=v.timestamp(),B=new Array(arguments.length),z=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var P=0;P<B.length;P++)B[P]=arguments[P];if(v.serialize&&!v.asObject&&c(B,this._serialize,this.serializers,this._stdErrSerialize),v.asObject?D.call(z,a(this,$,B,N)):D.apply(z,B),v.transmit){const y=v.transmit.level||I.level,m=s.levels.values[y],S=s.levels.values[$];if(S<m)return;h(this,{ts:N,methodLevel:$,methodValue:S,transmitValue:s.levels.values[v.transmit.level||I.level],send:v.transmit.send,val:I.levelVal},B)}}})(I[$]))}function a(v,I,$,D){v._serialize&&c($,v._serialize,v.serializers,v._stdErrSerialize);const j=$.slice();let N=j[0];const B={};D&&(B.time=D),B.level=s.levels.values[I];let z=(v._childLevel|0)+1;if(z<1&&(z=1),N!==null&&typeof N=="object"){for(;z--&&typeof j[0]=="object";)Object.assign(B,j.shift());N=j.length?r(j.shift(),j):void 0}else typeof N=="string"&&(N=r(j.shift(),j));return N!==void 0&&(B.msg=N),B}function c(v,I,$,D){for(const j in v)if(D&&v[j]instanceof Error)v[j]=s.stdSerializers.err(v[j]);else if(typeof v[j]=="object"&&!Array.isArray(v[j]))for(const N in v[j])I&&I.indexOf(N)>-1&&N in $&&(v[j][N]=$[N](v[j][N]))}function l(v,I,$){return function(){const D=new Array(1+arguments.length);D[0]=I;for(var j=1;j<D.length;j++)D[j]=arguments[j-1];return v[$].apply(this,D)}}function h(v,I,$){const D=I.send,j=I.ts,N=I.methodLevel,B=I.methodValue,z=I.val,P=v._logEvent.bindings;c($,v._serialize||Object.keys(v.serializers),v.serializers,v._stdErrSerialize===void 0?!0:v._stdErrSerialize),v._logEvent.ts=j,v._logEvent.messages=$.filter(function(y){return P.indexOf(y)===-1}),v._logEvent.level.label=N,v._logEvent.level.value=B,D(N,v._logEvent,z),v._logEvent=u(P)}function u(v){return{ts:0,messages:[],bindings:v||[],level:{label:"",value:0}}}function d(v){const I={type:v.constructor.name,msg:v.message,stack:v.stack};for(const $ in v)I[$]===void 0&&(I[$]=v[$]);return I}function f(v){return typeof v.timestamp=="function"?v.timestamp:v.timestamp===!1?_:b}function p(){return{}}function g(v){return v}function w(){}function _(){return!1}function b(){return Date.now()}function E(){return Math.round(Date.now()/1e3)}function x(){return new Date(Date.now()).toISOString()}function T(){function v(I){return typeof I<"u"&&I}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return v(self)||v(window)||v(this)||{}}}return bn}var Br=xE();let AE,qi,Lo;Ui=Eo(Br);AE={level:"info"};qi="custom_context";Lo=1e3*1024;let CE=class{constructor(e){this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},Fc=class{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const t=new CE(e);if(t.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${t.size}`);for(;this.size+t.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=t),this.tail=t):(this.head=t,this.tail=t),this.lengthInNodes++,this.sizeInBytes+=t.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let t=this.head;for(;t!==null;)e.push(t.value),t=t.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const t=e.value;return e=e.next,{done:!1,value:t}}}}},qu=class{constructor(e,t=Lo){this.level=e??"error",this.levelValue=Br.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=t,this.logs=new Fc(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,t){t===Br.levels.values.error?console.error(e):t===Br.levels.values.warn?console.warn(e):t===Br.levels.values.debug?console.debug(e):t===Br.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(Ut({timestamp:new Date().toISOString(),log:e}));const t=typeof e=="string"?JSON.parse(e).level:e.level;t>=this.levelValue&&this.forwardToConsole(e,t)}getLogs(){return this.logs}clearLogs(){this.logs=new Fc(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const t=this.getLogArray();return t.push(Ut({extraMetadata:e})),new Blob(t,{type:"application/json"})}},TE=class{constructor(e,t=Lo){this.baseChunkLogger=new qu(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const t=URL.createObjectURL(this.logsToBlob(e)),i=document.createElement("a");i.href=t,i.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(t)}},RE=class{constructor(e,t=Lo){this.baseChunkLogger=new qu(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var NE=Object.defineProperty,jE=Object.defineProperties,BE=Object.getOwnPropertyDescriptors,Hc=Object.getOwnPropertySymbols,UE=Object.prototype.hasOwnProperty,qE=Object.prototype.propertyIsEnumerable,Vc=(r,e,t)=>e in r?NE(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ms=(r,e)=>{for(var t in e||(e={}))UE.call(e,t)&&Vc(r,t,e[t]);if(Hc)for(var t of Hc(e))qE.call(e,t)&&Vc(r,t,e[t]);return r},ws=(r,e)=>jE(r,BE(e));Ns=function(r){return ws(ms({},r),{level:r?.level||AE.level})};function LE(r,e=qi){return r[e]||""}function kE(r,e,t=qi){return r[t]=e,r}ze=function(r,e=qi){let t="";return typeof r.bindings>"u"?t=LE(r,e):t=r.bindings().context||"",t};function ME(r,e,t=qi){const i=ze(r,t);return i.trim()?`${i}/${e}`:e}je=function(r,e,t=qi){const i=ME(r,e,t),s=r.child({context:i});return kE(s,i,t)};function zE(r){var e,t;const i=new TE((e=r.opts)==null?void 0:e.level,r.maxSizeInBytes);return{logger:Ui(ws(ms({},r.opts),{level:"trace",browser:ws(ms({},(t=r.opts)==null?void 0:t.browser),{write:s=>i.write(s)})})),chunkLoggerController:i}}function FE(r){var e;const t=new RE((e=r.opts)==null?void 0:e.level,r.maxSizeInBytes);return{logger:Ui(ws(ms({},r.opts),{level:"trace"}),t),chunkLoggerController:t}}HE=function(r){return typeof r.loggerOverride<"u"&&typeof r.loggerOverride!="string"?{logger:r.loggerOverride,chunkLoggerController:null}:typeof window<"u"?zE(r):FE(r)};var VE=Object.defineProperty,KE=(r,e,t)=>e in r?VE(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Kc=(r,e,t)=>KE(r,typeof e!="symbol"?e+"":e,t);let WE=class extends pr{constructor(e){super(),this.opts=e,Kc(this,"protocol","wc"),Kc(this,"version",2)}};var GE=Object.defineProperty,YE=(r,e,t)=>e in r?GE(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,JE=(r,e,t)=>YE(r,e+"",t);let ZE=class extends pr{constructor(e,t){super(),this.core=e,this.logger=t,JE(this,"records",new Map)}},QE=class{constructor(e,t){this.logger=e,this.core=t}};class XE extends pr{constructor(e,t){super(),this.relayer=e,this.logger=t}}let e_=class extends pr{constructor(e){super()}},t_=class{constructor(e,t,i,s){this.core=e,this.logger=t,this.name=i}},r_=class extends pr{constructor(e,t){super(),this.relayer=e,this.logger=t}},i_=class extends pr{constructor(e,t){super(),this.core=e,this.logger=t}},s_=class{constructor(e,t,i){this.core=e,this.logger=t,this.store=i}},n_=class{constructor(e,t){this.projectId=e,this.logger=t}},o_=class{constructor(e,t,i){this.core=e,this.logger=t,this.telemetryEnabled=i}};var a_=Object.defineProperty,c_=(r,e,t)=>e in r?a_(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Wc=(r,e,t)=>c_(r,typeof e!="symbol"?e+"":e,t);let l_=class{constructor(e){this.opts=e,Wc(this,"protocol","wc"),Wc(this,"version",2)}},h_=class{constructor(e){this.client=e}};const u_="PARSE_ERROR",d_="INVALID_REQUEST",p_="METHOD_NOT_FOUND",f_="INVALID_PARAMS",Lu="INTERNAL_ERROR",ko="SERVER_ERROR",g_=[-32700,-32600,-32601,-32602,-32603],wi={[u_]:{code:-32700,message:"Parse error"},[d_]:{code:-32600,message:"Invalid Request"},[p_]:{code:-32601,message:"Method not found"},[f_]:{code:-32602,message:"Invalid params"},[Lu]:{code:-32603,message:"Internal error"},[ko]:{code:-32e3,message:"Server error"}},ku=ko;function y_(r){return g_.includes(r)}function Gc(r){return Object.keys(wi).includes(r)?wi[r]:wi[ku]}function m_(r){const e=Object.values(wi).find(t=>t.code===r);return e||wi[ku]}function Mu(r,e,t){return r.message.includes("getaddrinfo ENOTFOUND")||r.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${t} RPC url at ${e}`):r}var vn={};var to=function(r,e){return to=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s])},to(r,e)};function w_(r,e){to(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var ro=function(){return ro=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++){t=arguments[i];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},ro.apply(this,arguments)};function b_(r,e){var t={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&e.indexOf(i)<0&&(t[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(r);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(r,i[s])&&(t[i[s]]=r[i[s]]);return t}function v_(r,e,t,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(n=(s<3?o(n):s>3?o(e,t,n):o(e,t))||n);return s>3&&n&&Object.defineProperty(e,t,n),n}function E_(r,e){return function(t,i){e(t,i,r)}}function __(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)}function I_(r,e,t,i){function s(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(h){try{l(i.next(h))}catch(u){o(u)}}function c(h){try{l(i.throw(h))}catch(u){o(u)}}function l(h){h.done?n(h.value):s(h.value).then(a,c)}l((i=i.apply(r,e||[])).next())})}function S_(r,e){var t={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(h){return c([l,h])}}function c(l){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,s&&(n=l[0]&2?s.return:l[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,l[1])).done)return n;switch(s=0,n&&(l=[l[0]&2,n.value]),l[0]){case 0:case 1:n=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,s=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(n=t.trys,!(n=n.length>0&&n[n.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!n||l[1]>n[0]&&l[1]<n[3])){t.label=l[1];break}if(l[0]===6&&t.label<n[1]){t.label=n[1],n=l;break}if(n&&t.label<n[2]){t.label=n[2],t.ops.push(l);break}n[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(h){l=[6,h],s=0}finally{i=n=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function D_(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}function O_(r,e){for(var t in r)t!=="default"&&!e.hasOwnProperty(t)&&(e[t]=r[t])}function io(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],i=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function zu(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var i=t.call(r),s,n=[],o;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)n.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return n}function $_(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(zu(arguments[e]));return r}function P_(){for(var r=0,e=0,t=arguments.length;e<t;e++)r+=arguments[e].length;for(var i=Array(r),s=0,e=0;e<t;e++)for(var n=arguments[e],o=0,a=n.length;o<a;o++,s++)i[s]=n[o];return i}function Pi(r){return this instanceof Pi?(this.v=r,this):new Pi(r)}function x_(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(r,e||[]),s,n=[];return s={},o("next"),o("throw"),o("return"),s[Symbol.asyncIterator]=function(){return this},s;function o(d){i[d]&&(s[d]=function(f){return new Promise(function(p,g){n.push([d,f,p,g])>1||a(d,f)})})}function a(d,f){try{c(i[d](f))}catch(p){u(n[0][3],p)}}function c(d){d.value instanceof Pi?Promise.resolve(d.value.v).then(l,h):u(n[0][2],d)}function l(d){a("next",d)}function h(d){a("throw",d)}function u(d,f){d(f),n.shift(),n.length&&a(n[0][0],n[0][1])}}function A_(r){var e,t;return e={},i("next"),i("throw",function(s){throw s}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(s,n){e[s]=r[s]?function(o){return(t=!t)?{value:Pi(r[s](o)),done:s==="return"}:n?n(o):o}:n}}function C_(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof io=="function"?io(r):r[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=r[n]&&function(o){return new Promise(function(a,c){o=r[n](o),s(a,c,o.done,o.value)})}}function s(n,o,a,c){Promise.resolve(c).then(function(l){n({value:l,done:a})},o)}}function T_(r,e){return Object.defineProperty?Object.defineProperty(r,"raw",{value:e}):r.raw=e,r}function R_(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)Object.hasOwnProperty.call(r,t)&&(e[t]=r[t]);return e.default=r,e}function N_(r){return r&&r.__esModule?r:{default:r}}function j_(r,e){if(!e.has(r))throw new TypeError("attempted to get private field on non-instance");return e.get(r)}function B_(r,e,t){if(!e.has(r))throw new TypeError("attempted to set private field on non-instance");return e.set(r,t),t}const U_=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return ro},__asyncDelegator:A_,__asyncGenerator:x_,__asyncValues:C_,__await:Pi,__awaiter:I_,__classPrivateFieldGet:j_,__classPrivateFieldSet:B_,__createBinding:D_,__decorate:v_,__exportStar:O_,__extends:w_,__generator:S_,__importDefault:N_,__importStar:R_,__makeTemplateObject:T_,__metadata:__,__param:E_,__read:zu,__rest:b_,__spread:$_,__spreadArrays:P_,__values:io},Symbol.toStringTag,{value:"Module"})),q_=th(U_);var xt={},Yc;function L_(){if(Yc)return xt;Yc=1,Object.defineProperty(xt,"__esModule",{value:!0}),xt.isBrowserCryptoAvailable=xt.getSubtleCrypto=xt.getBrowerCrypto=void 0;function r(){return globalThis?.crypto||globalThis?.msCrypto||{}}xt.getBrowerCrypto=r;function e(){const i=r();return i.subtle||i.webkitSubtle}xt.getSubtleCrypto=e;function t(){return!!r()&&!!e()}return xt.isBrowserCryptoAvailable=t,xt}var At={},Jc;function k_(){if(Jc)return At;Jc=1,Object.defineProperty(At,"__esModule",{value:!0}),At.isBrowser=At.isNode=At.isReactNative=void 0;function r(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}At.isReactNative=r;function e(){return typeof it<"u"&&typeof it.versions<"u"&&typeof it.versions.node<"u"}At.isNode=e;function t(){return!r()&&!e()}return At.isBrowser=t,At}var Zc;function M_(){return Zc||(Zc=1,(function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=q_;e.__exportStar(L_(),r),e.__exportStar(k_(),r)})(vn)),vn}var z_=M_();bt=function(r=3){const e=Date.now()*Math.pow(10,r),t=Math.floor(Math.random()*Math.pow(10,r));return e+t};or=function(r=6){return BigInt(bt(r))};Vt=function(r,e,t){return{id:t||bt(),jsonrpc:"2.0",method:r,params:e}};js=function(r,e){return{id:r,jsonrpc:"2.0",result:e}};Bs=function(r,e,t){return{id:r,jsonrpc:"2.0",error:F_(e)}};function F_(r,e){return typeof r>"u"?Gc(Lu):(typeof r=="string"&&(r=Object.assign(Object.assign({},Gc(ko)),{message:r})),y_(r.code)&&(r=m_(r.code)),r)}class H_{}class V_ extends H_{constructor(){super()}}class K_ extends V_{constructor(e){super()}}const W_="^https?:",G_="^wss?:";function Y_(r){const e=r.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function Fu(r,e){const t=Y_(r);return typeof t>"u"?!1:new RegExp(e).test(t)}function Qc(r){return Fu(r,W_)}function Xc(r){return Fu(r,G_)}function J_(r){return new RegExp("wss?://localhost(:d{2,5})?").test(r)}function Hu(r){return typeof r=="object"&&"id"in r&&"jsonrpc"in r&&r.jsonrpc==="2.0"}Mo=function(r){return Hu(r)&&"method"in r};Us=function(r){return Hu(r)&&(vt(r)||tt(r))};vt=function(r){return"result"in r};tt=function(r){return"error"in r};st=class extends K_{constructor(e){super(e),this.events=new Je.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async request(e,t){return this.requestStrict(Vt(e.method,e.params||[],e.id||or().toString()),t)}async requestStrict(e,t){return new Promise(async(i,s)=>{if(!this.connection.connected)try{await this.open()}catch(n){s(n)}this.events.on(`${e.id}`,n=>{tt(n)?s(n.error):i(n.result)});try{await this.connection.send(e,t)}catch(n){s(n)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Us(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const Z_=()=>typeof WebSocket<"u"?WebSocket:typeof globalThis<"u"&&typeof globalThis.WebSocket<"u"?globalThis.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),Q_=()=>typeof WebSocket<"u"||typeof globalThis<"u"&&typeof globalThis.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",el=r=>r.split("?")[0],tl=10,X_=Z_();e1=class{constructor(e){if(this.url=e,this.events=new Je.EventEmitter,this.registering=!1,!Xc(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,t)=>{if(typeof this.socket>"u"){t(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Ut(e))}catch(t){this.onError(e.id,t)}}register(e=this.url){if(!Xc(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((i,s)=>{this.events.once("register_error",n=>{this.resetMaxListeners(),s(n)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((t,i)=>{const s=z_.isReactNative()?void 0:{rejectUnauthorized:!J_(e)},n=new X_(e,[],s);Q_()?n.onerror=o=>{const a=o;i(this.emitError(a.error))}:n.on("error",o=>{i(this.emitError(o))}),n.onopen=()=>{this.onOpen(n),t(n)}})}onOpen(e){e.onmessage=t=>this.onPayload(t),e.onclose=t=>this.onClose(t),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const t=typeof e.data=="string"?lr(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const i=this.parseError(t),s=i.message||i.toString(),n=Bs(e,s);this.events.emit("payload",n)}parseError(e,t=this.url){return Mu(e,el(t),"WS")}resetMaxListeners(){this.events.getMaxListeners()>tl&&this.events.setMaxListeners(tl)}emitError(e){const t=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${el(this.url)}`));return this.events.emit("register_error",t),t}};var t1={};const Vu="wc",Ku=2,so="core",It=`${Vu}@2:${so}:`,r1={logger:"error"},i1={database:":memory:"},s1="crypto",rl="client_ed25519_seed",n1=U.ONE_DAY,o1="keychain",a1="0.3",c1="messages",l1="0.3",il=U.SIX_HOURS,h1="publisher",Wu="irn",u1="error",Gu="wss://relay.walletconnect.org",d1="relayer",we={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},p1="_subscription",Qe={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},f1=.1,no="2.21.1",ae={link_mode:"link_mode",relay:"relay"},cs={inbound:"inbound",outbound:"outbound"},g1="0.3",y1="WALLETCONNECT_CLIENT_ID",sl="WALLETCONNECT_LINK_MODE_APPS",Ve={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},m1="subscription",w1="0.3",b1="pairing",v1="0.3",li={wc_pairingDelete:{req:{ttl:U.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:U.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:U.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:U.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:U.ONE_DAY,prompt:!1,tag:0},res:{ttl:U.ONE_DAY,prompt:!1,tag:0}}},ir={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},at={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},E1="history",_1="0.3",I1="expirer",et={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},S1="0.3",D1="verify-api",O1="https://verify.walletconnect.com",Yu="https://verify.walletconnect.org",bi=Yu,$1=`${bi}/v3`,P1=[O1,Yu],x1="echo",A1="https://echo.walletconnect.com",wt={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},Ct={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},ct={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},Zt={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},Qt={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},hi={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},C1=.1,T1="event-client",R1=86400,N1="https://pulse.walletconnect.org/batch";function j1(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var s=0;s<r.length;s++){var n=r.charAt(s),o=n.charCodeAt(0);if(t[o]!==255)throw new TypeError(n+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function u(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,w=0,_=0,b=p.length;_!==b&&p[_]===0;)_++,g++;for(var E=(b-_)*h+1>>>0,x=new Uint8Array(E);_!==b;){for(var T=p[_],v=0,I=E-1;(T!==0||v<w)&&I!==-1;I--,v++)T+=256*x[I]>>>0,x[I]=T%a>>>0,T=T/a>>>0;if(T!==0)throw new Error("Non-zero carry");w=v,_++}for(var $=E-w;$!==E&&x[$]===0;)$++;for(var D=c.repeat(g);$<E;++$)D+=r.charAt(x[$]);return D}function d(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var w=0,_=0;p[g]===c;)w++,g++;for(var b=(p.length-g)*l+1>>>0,E=new Uint8Array(b);p[g];){var x=t[p.charCodeAt(g)];if(x===255)return;for(var T=0,v=b-1;(x!==0||T<_)&&v!==-1;v--,T++)x+=a*E[v]>>>0,E[v]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");_=T,g++}if(p[g]!==" "){for(var I=b-_;I!==b&&E[I]===0;)I++;for(var $=new Uint8Array(w+(b-I)),D=w;I!==b;)$[D++]=E[I++];return $}}}function f(p){var g=d(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:u,decodeUnsafe:d,decode:f}}var B1=j1,U1=B1;const Ju=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},q1=r=>new TextEncoder().encode(r),L1=r=>new TextDecoder().decode(r);class k1{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class M1{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Zu(this,e)}}class z1{constructor(e){this.decoders=e}or(e){return Zu(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Zu=(r,e)=>new z1({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class F1{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new k1(e,t,i),this.decoder=new M1(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const qs=({name:r,prefix:e,encode:t,decode:i})=>new F1(r,e,t,i),Li=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:s}=U1(t,e);return qs({prefix:r,name:e,encode:i,decode:n=>Ju(s(n))})},H1=(r,e,t,i)=>{const s={};for(let h=0;h<e.length;++h)s[e[h]]=h;let n=r.length;for(;r[n-1]==="=";)--n;const o=new Uint8Array(n*t/8|0);let a=0,c=0,l=0;for(let h=0;h<n;++h){const u=s[r[h]];if(u===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<t|u,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},V1=(r,e,t)=>{const i=e[e.length-1]==="=",s=(1<<t)-1;let n="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,n+=e[s&a>>o];if(o&&(n+=e[s&a<<t-o]),i)for(;n.length*t&7;)n+="=";return n},xe=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>qs({prefix:e,name:r,encode(s){return V1(s,i,t)},decode(s){return H1(s,i,t,r)}}),K1=qs({prefix:"\0",name:"identity",encode:r=>L1(r),decode:r=>q1(r)});var W1=Object.freeze({__proto__:null,identity:K1});const G1=xe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Y1=Object.freeze({__proto__:null,base2:G1});const J1=xe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Z1=Object.freeze({__proto__:null,base8:J1});const Q1=Li({prefix:"9",name:"base10",alphabet:"0123456789"});var X1=Object.freeze({__proto__:null,base10:Q1});const eI=xe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),tI=xe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var rI=Object.freeze({__proto__:null,base16:eI,base16upper:tI});const iI=xe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),sI=xe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),nI=xe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),oI=xe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),aI=xe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),cI=xe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),lI=xe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),hI=xe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),uI=xe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var dI=Object.freeze({__proto__:null,base32:iI,base32upper:sI,base32pad:nI,base32padupper:oI,base32hex:aI,base32hexupper:cI,base32hexpad:lI,base32hexpadupper:hI,base32z:uI});const pI=Li({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),fI=Li({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var gI=Object.freeze({__proto__:null,base36:pI,base36upper:fI});const yI=Li({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),mI=Li({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var wI=Object.freeze({__proto__:null,base58btc:yI,base58flickr:mI});const bI=xe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),vI=xe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),EI=xe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),_I=xe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var II=Object.freeze({__proto__:null,base64:bI,base64pad:vI,base64url:EI,base64urlpad:_I});const Qu=Array.from("\uD83D\uDE80\uD83E\uDE90\uD83D\uDEF0\uD83C\uDF0C\uD83C\uDF11\uD83C\uDF12\uD83C\uDF13\uD83C\uDF14\uD83C\uDF15\uD83C\uDF16\uD83C\uDF17\uD83C\uDF18\uD83C\uDF0D\uD83C\uDF0F\uD83C\uDF0E\uD83D\uDC09\uD83D\uDCBB\uD83D\uDDA5\uD83D\uDCBE\uD83D\uDCBF\uD83D\uDE02\uD83D\uDE0D\uD83E\uDD23\uD83D\uDE0A\uD83D\uDE4F\uD83D\uDC95\uD83D\uDE2D\uD83D\uDE18\uD83D\uDC4D\uD83D\uDE05\uD83D\uDC4F\uD83D\uDE01\uD83D\uDD25\uD83E\uDD70\uD83D\uDC94\uD83D\uDC96\uD83D\uDC99\uD83D\uDE22\uD83E\uDD14\uD83D\uDE06\uD83D\uDE44\uD83D\uDCAA\uD83D\uDE09\uD83D\uDC4C\uD83E\uDD17\uD83D\uDC9C\uD83D\uDE14\uD83D\uDE0E\uD83D\uDE07\uD83C\uDF39\uD83E\uDD26\uD83C\uDF89\uD83D\uDC9E\uD83E\uDD37\uD83D\uDE31\uD83D\uDE0C\uD83C\uDF38\uD83D\uDE4C\uD83D\uDE0B\uD83D\uDC97\uD83D\uDC9A\uD83D\uDE0F\uD83D\uDC9B\uD83D\uDE42\uD83D\uDC93\uD83E\uDD29\uD83D\uDE04\uD83D\uDE00\uD83D\uDDA4\uD83D\uDE03\uD83D\uDCAF\uD83D\uDE48\uD83D\uDC47\uD83C\uDFB6\uD83D\uDE12\uD83E\uDD2D\uD83D\uDE1C\uD83D\uDC8B\uD83D\uDC40\uD83D\uDE2A\uD83D\uDE11\uD83D\uDCA5\uD83D\uDE4B\uD83D\uDE1E\uD83D\uDE29\uD83D\uDE21\uD83E\uDD2A\uD83D\uDC4A\uD83E\uDD73\uD83D\uDE25\uD83E\uDD24\uD83D\uDC49\uD83D\uDC83\uD83D\uDE33\uD83D\uDE1A\uD83D\uDE1D\uD83D\uDE34\uD83C\uDF1F\uD83D\uDE2C\uD83D\uDE43\uD83C\uDF40\uD83C\uDF37\uD83D\uDE3B\uD83D\uDE13\uD83E\uDD7A\uD83C\uDF08\uD83D\uDE08\uD83E\uDD18\uD83D\uDCA6\uD83D\uDE23\uD83C\uDFC3\uD83D\uDC90\uD83C\uDF8A\uD83D\uDC98\uD83D\uDE20\uD83D\uDE15\uD83C\uDF3A\uD83C\uDF82\uD83C\uDF3B\uD83D\uDE10\uD83D\uDD95\uD83D\uDC9D\uD83D\uDE4A\uD83D\uDE39\uD83D\uDDE3\uD83D\uDCAB\uD83D\uDC80\uD83D\uDC51\uD83C\uDFB5\uD83E\uDD1E\uD83D\uDE1B\uD83D\uDD34\uD83D\uDE24\uD83C\uDF3C\uD83D\uDE2B\uD83E\uDD19\uD83C\uDFC6\uD83E\uDD2B\uD83D\uDC48\uD83D\uDE2E\uD83D\uDE46\uD83C\uDF7B\uD83C\uDF43\uD83D\uDC36\uD83D\uDC81\uD83D\uDE32\uD83C\uDF3F\uD83E\uDDE1\uD83C\uDF81\uD83C\uDF1E\uD83C\uDF88\uD83D\uDC4B\uD83D\uDE30\uD83E\uDD28\uD83D\uDE36\uD83E\uDD1D\uD83D\uDEB6\uD83D\uDCB0\uD83C\uDF53\uD83D\uDCA2\uD83E\uDD1F\uD83D\uDE41\uD83D\uDEA8\uD83D\uDCA8\uD83E\uDD2C\uD83C\uDF80\uD83C\uDF7A\uD83E\uDD13\uD83D\uDE19\uD83D\uDC9F\uD83C\uDF31\uD83D\uDE16\uD83D\uDC76\uD83E\uDD74\uD83D\uDC8E\uD83D\uDCB8\uD83D\uDE28\uD83C\uDF1A\uD83E\uDD8B\uD83D\uDE37\uD83D\uDD7A\uD83D\uDE45\uD83D\uDE1F\uD83D\uDE35\uD83D\uDC4E\uD83E\uDD32\uD83E\uDD20\uD83E\uDD27\uD83D\uDCCC\uD83D\uDD35\uD83D\uDC85\uD83E\uDDD0\uD83D\uDC3E\uD83C\uDF52\uD83D\uDE17\uD83E\uDD11\uD83C\uDF0A\uD83E\uDD2F\uD83D\uDC37\uD83D\uDCA7\uD83D\uDE2F\uD83D\uDC86\uD83D\uDC46\uD83C\uDFA4\uD83D\uDE47\uD83C\uDF51\uD83C\uDF34\uD83D\uDCA3\uD83D\uDC38\uD83D\uDC8C\uD83D\uDCCD\uD83E\uDD40\uD83E\uDD22\uD83D\uDC45\uD83D\uDCA1\uD83D\uDCA9\uD83D\uDC50\uD83D\uDCF8\uD83D\uDC7B\uD83E\uDD10\uD83E\uDD2E\uD83C\uDFBC\uD83E\uDD75\uD83D\uDEA9\uD83C\uDF4E\uD83C\uDF4A\uD83D\uDC7C\uD83D\uDC8D\uD83D\uDCE3\uD83E\uDD42"),SI=Qu.reduce((r,e,t)=>(r[t]=e,r),[]),DI=Qu.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function OI(r){return r.reduce((e,t)=>(e+=SI[t],e),"")}function $I(r){const e=[];for(const t of r){const i=DI[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const PI=qs({prefix:"\uD83D\uDE80",name:"base256emoji",encode:OI,decode:$I});var xI=Object.freeze({__proto__:null,base256emoji:PI}),AI=Xu,nl=128,CI=-128,TI=Math.pow(2,31);function Xu(r,e,t){e=e||[],t=t||0;for(var i=t;r>=TI;)e[t++]=r&255|nl,r/=128;for(;r&CI;)e[t++]=r&255|nl,r>>>=7;return e[t]=r|0,Xu.bytes=t-i+1,e}var RI=oo,NI=128,ol=127;function oo(r,i){var t=0,i=i||0,s=0,n=i,o,a=r.length;do{if(n>=a)throw oo.bytes=0,new RangeError("Could not decode varint");o=r[n++],t+=s<28?(o&ol)<<s:(o&ol)*Math.pow(2,s),s+=7}while(o>=NI);return oo.bytes=n-i,t}var jI=Math.pow(2,7),BI=Math.pow(2,14),UI=Math.pow(2,21),qI=Math.pow(2,28),LI=Math.pow(2,35),kI=Math.pow(2,42),MI=Math.pow(2,49),zI=Math.pow(2,56),FI=Math.pow(2,63),HI=function(r){return r<jI?1:r<BI?2:r<UI?3:r<qI?4:r<LI?5:r<kI?6:r<MI?7:r<zI?8:r<FI?9:10},VI={encode:AI,decode:RI,encodingLength:HI},ed=VI;const al=(r,e,t=0)=>(ed.encode(r,e,t),e),cl=r=>ed.encodingLength(r),ao=(r,e)=>{const t=e.byteLength,i=cl(r),s=i+cl(t),n=new Uint8Array(s+t);return al(r,n,0),al(t,n,i),n.set(e,s),new KI(r,t,e,n)};class KI{constructor(e,t,i,s){this.code=e,this.size=t,this.digest=i,this.bytes=s}}const td=({name:r,code:e,encode:t})=>new WI(r,e,t);class WI{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?ao(this.code,t):t.then(i=>ao(this.code,i))}else throw Error("Unknown type, must be binary type")}}const rd=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),GI=td({name:"sha2-256",code:18,encode:rd("SHA-256")}),YI=td({name:"sha2-512",code:19,encode:rd("SHA-512")});var JI=Object.freeze({__proto__:null,sha256:GI,sha512:YI});const id=0,ZI="identity",sd=Ju,QI=r=>ao(id,sd(r)),XI={code:id,name:ZI,encode:sd,digest:QI};var e2=Object.freeze({__proto__:null,identity:XI});new TextEncoder,new TextDecoder;const ll={...W1,...Y1,...Z1,...X1,...rI,...dI,...gI,...wI,...II,...xI};({...JI,...e2});function t2(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}function nd(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const hl=nd("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),En=nd("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=t2(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),r2={utf8:hl,"utf-8":hl,hex:ll.base16,latin1:En,ascii:En,binary:En,...ll};function i2(r,e="utf8"){const t=r2[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r,"utf8"):t.decoder.decode(`${t.prefix}${r}`)}var s2=Object.defineProperty,n2=(r,e,t)=>e in r?s2(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,yt=(r,e,t)=>n2(r,typeof e!="symbol"?e+"":e,t);class o2{constructor(e,t){this.core=e,this.logger=t,yt(this,"keychain",new Map),yt(this,"name",o1),yt(this,"version",a1),yt(this,"initialized",!1),yt(this,"storagePrefix",It),yt(this,"init",async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}}),yt(this,"has",i=>(this.isInitialized(),this.keychain.has(i))),yt(this,"set",async(i,s)=>{this.isInitialized(),this.keychain.set(i,s),await this.persist()}),yt(this,"get",i=>{this.isInitialized();const s=this.keychain.get(i);if(typeof s>"u"){const{message:n}=q("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(n)}return s}),yt(this,"del",async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()}),this.core=e,this.logger=je(t,this.name)}get context(){return ze(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,zn(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Fn(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}}var a2=Object.defineProperty,c2=(r,e,t)=>e in r?a2(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Se=(r,e,t)=>c2(r,typeof e!="symbol"?e+"":e,t);class l2{constructor(e,t,i){this.core=e,this.logger=t,Se(this,"name",s1),Se(this,"keychain"),Se(this,"randomSessionIdentifier",Xn()),Se(this,"initialized",!1),Se(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),Se(this,"hasKeys",s=>(this.isInitialized(),this.keychain.has(s))),Se(this,"getClientId",async()=>{this.isInitialized();const s=await this.getClientSeed(),n=Ma(s);return Vh(n.publicKey)}),Se(this,"generateKeyPair",()=>{this.isInitialized();const s=Gv();return this.setPrivateKey(s.publicKey,s.privateKey)}),Se(this,"signJWT",async s=>{this.isInitialized();const n=await this.getClientSeed(),o=Ma(n),a=this.randomSessionIdentifier;return await um(a,s,n1,o)}),Se(this,"generateSharedKey",(s,n,o)=>{this.isInitialized();const a=this.getPrivateKey(s),c=Yv(a,n);return this.setSymKey(c,o)}),Se(this,"setSymKey",async(s,n)=>{this.isInitialized();const o=n||ns(s);return await this.keychain.set(o,s),o}),Se(this,"deleteKeyPair",async s=>{this.isInitialized(),await this.keychain.del(s)}),Se(this,"deleteSymKey",async s=>{this.isInitialized(),await this.keychain.del(s)}),Se(this,"encode",async(s,n,o)=>{this.isInitialized();const a=Nu(o),c=Ut(n);if(Dc(a))return Qv(c,o?.encoding);if(Sc(a)){const d=a.senderPublicKey,f=a.receiverPublicKey;s=await this.generateSharedKey(d,f)}const l=this.getSymKey(s),{type:h,senderPublicKey:u}=a;return Jv({type:h,symKey:l,message:c,senderPublicKey:u,encoding:o?.encoding})}),Se(this,"decode",async(s,n,o)=>{this.isInitialized();const a=e0(n,o);if(Dc(a)){const c=Xv(n,o?.encoding);return lr(c)}if(Sc(a)){const c=a.receiverPublicKey,l=a.senderPublicKey;s=await this.generateSharedKey(c,l)}try{const c=this.getSymKey(s),l=Zv({symKey:c,encoded:n,encoding:o?.encoding});return lr(l)}catch(c){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),Se(this,"getPayloadType",(s,n=ut)=>{const o=$i({encoded:s,encoding:n});return dr(o.type)}),Se(this,"getPayloadSenderPublicKey",(s,n=ut)=>{const o=$i({encoded:s,encoding:n});return o.senderPublicKey?Me(o.senderPublicKey,Ne):void 0}),this.core=e,this.logger=je(t,this.name),this.keychain=i||new o2(this.core,this.logger)}get context(){return ze(this.logger)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(rl)}catch{e=Xn(),await this.keychain.set(rl,e)}return i2(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}}var h2=Object.defineProperty,u2=Object.defineProperties,d2=Object.getOwnPropertyDescriptors,ul=Object.getOwnPropertySymbols,p2=Object.prototype.hasOwnProperty,f2=Object.prototype.propertyIsEnumerable,co=(r,e,t)=>e in r?h2(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,g2=(r,e)=>{for(var t in e||(e={}))p2.call(e,t)&&co(r,t,e[t]);if(ul)for(var t of ul(e))f2.call(e,t)&&co(r,t,e[t]);return r},y2=(r,e)=>u2(r,d2(e)),Fe=(r,e,t)=>co(r,typeof e!="symbol"?e+"":e,t);class m2 extends QE{constructor(e,t){super(e,t),this.logger=e,this.core=t,Fe(this,"messages",new Map),Fe(this,"messagesWithoutClientAck",new Map),Fe(this,"name",c1),Fe(this,"version",l1),Fe(this,"initialized",!1),Fe(this,"storagePrefix",It),Fe(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i);const s=await this.getRelayerMessagesWithoutClientAck();typeof s<"u"&&(this.messagesWithoutClientAck=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}}),Fe(this,"set",async(i,s,n)=>{this.isInitialized();const o=Et(s);let a=this.messages.get(i);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=s,this.messages.set(i,a),n===cs.inbound){const c=this.messagesWithoutClientAck.get(i)||{};this.messagesWithoutClientAck.set(i,y2(g2({},c),{[o]:s}))}return await this.persist(),o}),Fe(this,"get",i=>{this.isInitialized();let s=this.messages.get(i);return typeof s>"u"&&(s={}),s}),Fe(this,"getWithoutAck",i=>{this.isInitialized();const s={};for(const n of i){const o=this.messagesWithoutClientAck.get(n)||{};s[n]=Object.values(o)}return s}),Fe(this,"has",(i,s)=>{this.isInitialized();const n=this.get(i),o=Et(s);return typeof n[o]<"u"}),Fe(this,"ack",async(i,s)=>{this.isInitialized();const n=this.messagesWithoutClientAck.get(i);if(typeof n>"u")return;const o=Et(s);delete n[o],Object.keys(n).length===0?this.messagesWithoutClientAck.delete(i):this.messagesWithoutClientAck.set(i,n),await this.persist()}),Fe(this,"del",async i=>{this.isInitialized(),this.messages.delete(i),this.messagesWithoutClientAck.delete(i),await this.persist()}),this.logger=je(e,this.name),this.core=t}get context(){return ze(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,zn(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,zn(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Fn(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?Fn(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}}var w2=Object.defineProperty,b2=Object.defineProperties,v2=Object.getOwnPropertyDescriptors,dl=Object.getOwnPropertySymbols,E2=Object.prototype.hasOwnProperty,_2=Object.prototype.propertyIsEnumerable,lo=(r,e,t)=>e in r?w2(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ji=(r,e)=>{for(var t in e||(e={}))E2.call(e,t)&&lo(r,t,e[t]);if(dl)for(var t of dl(e))_2.call(e,t)&&lo(r,t,e[t]);return r},_n=(r,e)=>b2(r,v2(e)),lt=(r,e,t)=>lo(r,typeof e!="symbol"?e+"":e,t);class I2 extends XE{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,lt(this,"events",new Je.EventEmitter),lt(this,"name",h1),lt(this,"queue",new Map),lt(this,"publishTimeout",U.toMiliseconds(U.ONE_MINUTE)),lt(this,"initialPublishTimeout",U.toMiliseconds(U.ONE_SECOND*15)),lt(this,"needsTransportRestart",!1),lt(this,"publish",async(i,s,n)=>{var o;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:n}});const a=n?.ttl||il,c=gs(n),l=n?.prompt||!1,h=n?.tag||0,u=n?.id||or().toString(),d={topic:i,message:s,opts:{ttl:a,relay:c,prompt:l,tag:h,id:u,attestation:n?.attestation,tvf:n?.tvf}},f=`Failed to publish payload, please try again. id:${u} tag:${h}`;try{const p=new Promise(async g=>{const w=({id:b})=>{d.opts.id===b&&(this.removeRequestFromQueue(b),this.relayer.events.removeListener(we.publish,w),g(d))};this.relayer.events.on(we.publish,w);const _=Ht(new Promise((b,E)=>{this.rpcPublish({topic:i,message:s,ttl:a,prompt:l,tag:h,id:u,attestation:n?.attestation,tvf:n?.tvf}).then(b).catch(x=>{this.logger.warn(x,x?.message),E(x)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${u} tag:${h}`);try{await _,this.events.removeListener(we.publish,w)}catch(b){this.queue.set(u,_n(Ji({},d),{attempt:1})),this.logger.warn(b,b?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:u,topic:i,message:s,opts:n}}),await Ht(p,this.publishTimeout,f)}catch(p){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(p),(o=n?.internal)!=null&&o.throwOnFailedPublish)throw p}finally{this.queue.delete(u)}}),lt(this,"on",(i,s)=>{this.events.on(i,s)}),lt(this,"once",(i,s)=>{this.events.once(i,s)}),lt(this,"off",(i,s)=>{this.events.off(i,s)}),lt(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.relayer=e,this.logger=je(t,this.name),this.registerEventListeners()}get context(){return ze(this.logger)}async rpcPublish(e){var t,i,s,n;const{topic:o,message:a,ttl:c=il,prompt:l,tag:h,id:u,attestation:d,tvf:f}=e,p={method:fi(gs().protocol).publish,params:Ji({topic:o,message:a,ttl:c,prompt:l,tag:h,attestation:d},f),id:u};Oe((t=p.params)==null?void 0:t.prompt)&&((i=p.params)==null||delete i.prompt),Oe((s=p.params)==null?void 0:s.tag)&&((n=p.params)==null||delete n.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:p});const g=await this.relayer.request(p);return this.relayer.events.emit(we.publish,e),this.logger.debug("Successfully Published Payload"),g}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,t)=>{const i=e.attempt+1;this.queue.set(t,_n(Ji({},e),{attempt:i}));const{topic:s,message:n,opts:o,attestation:a}=e;this.logger.warn({},`Publisher: queue->publishing: ${e.opts.id}, tag: ${e.opts.tag}, attempt: ${i}`),await this.rpcPublish(_n(Ji({},e),{topic:s,message:n,ttl:o.ttl,prompt:o.prompt,tag:o.tag,id:o.id,attestation:a,tvf:o.tvf})),this.logger.warn({},`Publisher: queue->published: ${e.opts.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(fr.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(we.connection_stalled);return}this.checkQueue()}),this.relayer.on(we.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var S2=Object.defineProperty,D2=(r,e,t)=>e in r?S2(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ir=(r,e,t)=>D2(r,typeof e!="symbol"?e+"":e,t);class O2{constructor(){Ir(this,"map",new Map),Ir(this,"set",(e,t)=>{const i=this.get(e);this.exists(e,t)||this.map.set(e,[...i,t])}),Ir(this,"get",e=>this.map.get(e)||[]),Ir(this,"exists",(e,t)=>this.get(e).includes(t)),Ir(this,"delete",(e,t)=>{if(typeof t>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,t))return;const s=i.filter(n=>n!==t);if(!s.length){this.map.delete(e);return}this.map.set(e,s)}),Ir(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var $2=Object.defineProperty,P2=Object.defineProperties,x2=Object.getOwnPropertyDescriptors,pl=Object.getOwnPropertySymbols,A2=Object.prototype.hasOwnProperty,C2=Object.prototype.propertyIsEnumerable,ho=(r,e,t)=>e in r?$2(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ui=(r,e)=>{for(var t in e||(e={}))A2.call(e,t)&&ho(r,t,e[t]);if(pl)for(var t of pl(e))C2.call(e,t)&&ho(r,t,e[t]);return r},In=(r,e)=>P2(r,x2(e)),ie=(r,e,t)=>ho(r,typeof e!="symbol"?e+"":e,t);class T2 extends r_{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,ie(this,"subscriptions",new Map),ie(this,"topicMap",new O2),ie(this,"events",new Je.EventEmitter),ie(this,"name",m1),ie(this,"version",w1),ie(this,"pending",new Map),ie(this,"cached",[]),ie(this,"initialized",!1),ie(this,"storagePrefix",It),ie(this,"subscribeTimeout",U.toMiliseconds(U.ONE_MINUTE)),ie(this,"initialSubscribeTimeout",U.toMiliseconds(U.ONE_SECOND*15)),ie(this,"clientId"),ie(this,"batchSubscribeTopicsLimit",500),ie(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),ie(this,"subscribe",async(i,s)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}});try{const n=gs(s),o={topic:i,relay:n,transportType:s?.transportType};this.pending.set(i,o);const a=await this.rpcSubscribe(i,n,s);return typeof a=="string"&&(this.onSubscribe(a,o),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}})),a}catch(n){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(n),n}}),ie(this,"unsubscribe",async(i,s)=>{this.isInitialized(),typeof s?.id<"u"?await this.unsubscribeById(i,s.id,s):await this.unsubscribeByTopic(i,s)}),ie(this,"isSubscribed",i=>new Promise(s=>{s(this.topicMap.topics.includes(i))})),ie(this,"isKnownTopic",i=>new Promise(s=>{s(this.topicMap.topics.includes(i)||this.pending.has(i)||this.cached.some(n=>n.topic===i))})),ie(this,"on",(i,s)=>{this.events.on(i,s)}),ie(this,"once",(i,s)=>{this.events.once(i,s)}),ie(this,"off",(i,s)=>{this.events.off(i,s)}),ie(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),ie(this,"start",async()=>{await this.onConnect()}),ie(this,"stop",async()=>{await this.onDisconnect()}),ie(this,"restart",async()=>{await this.restore(),await this.onRestart()}),ie(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const i=[];this.pending.forEach(s=>{i.push(s)}),await this.batchSubscribe(i)}),ie(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(fr.pulse,async()=>{await this.checkPending()}),this.events.on(Ve.created,async i=>{const s=Ve.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:i}),await this.persist()}),this.events.on(Ve.deleted,async i=>{const s=Ve.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:i}),await this.persist()})}),this.relayer=e,this.logger=je(t,this.name),this.clientId=""}get context(){return ze(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,t){let i=!1;try{i=this.getSubscription(e).topic===t}catch{}return i}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){const i=this.topicMap.get(e);await Promise.all(i.map(async s=>await this.unsubscribeById(e,s,t)))}async unsubscribeById(e,t,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}});try{const s=gs(i);await this.restartToComplete({topic:e,id:t,relay:s}),await this.rpcUnsubscribe(e,t,s);const n=te("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,t,i){var s;(!i||i?.transportType===ae.relay)&&await this.restartToComplete({topic:e,id:e,relay:t});const n={method:fi(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});const o=(s=i?.internal)==null?void 0:s.throwOnFailedPublish;try{const a=await this.getSubscriptionId(e);if(i?.transportType===ae.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(n).catch(h=>this.logger.warn(h))},U.toMiliseconds(U.ONE_SECOND)),a;const c=new Promise(async h=>{const u=d=>{d.topic===e&&(this.events.removeListener(Ve.created,u),h(d.id))};this.events.on(Ve.created,u);try{const d=await Ht(new Promise((f,p)=>{this.relayer.request(n).catch(g=>{this.logger.warn(g,g?.message),p(g)}).then(f)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(Ve.created,u),h(d)}catch{}}),l=await Ht(c,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!l&&o)throw new Error(`Subscribing to ${e} failed, please try again`);return l?a:null}catch(a){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(we.connection_stalled),o)throw a}return null}async rpcBatchSubscribe(e){if(!e.length)return;const t=e[0].relay,i={method:fi(t.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await Ht(new Promise(s=>{this.relayer.request(i).catch(n=>this.logger.warn(n)).then(s)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(we.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const t=e[0].relay,i={method:fi(t.protocol).batchFetchMessages,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let s;try{s=await await Ht(new Promise((n,o)=>{this.relayer.request(i).catch(a=>{this.logger.warn(a),o(a)}).then(n)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(we.connection_stalled)}return s}rpcUnsubscribe(e,t,i){const s={method:fi(i.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,t){this.setSubscription(e,In(ui({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(t=>{this.setSubscription(t.id,ui({},t)),this.pending.delete(t.topic)})}async onUnsubscribe(e,t,i){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t)}addSubscription(e,t){this.subscriptions.set(e,ui({},t)),this.topicMap.set(t.topic,e),this.events.emit(Ve.created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:i}=q("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(Ve.deleted,In(ui({},i),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Ve.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<t;i++){const s=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(Ve.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:t}=q("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async t=>In(ui({},t),{id:await this.getSubscriptionId(t.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const t=await this.rpcBatchFetchMessages(e);t&&t.messages&&(await jw(U.toMiliseconds(U.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(t.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return Et(e+await this.getClientId())}}var R2=Object.defineProperty,fl=Object.getOwnPropertySymbols,N2=Object.prototype.hasOwnProperty,j2=Object.prototype.propertyIsEnumerable,uo=(r,e,t)=>e in r?R2(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,gl=(r,e)=>{for(var t in e||(e={}))N2.call(e,t)&&uo(r,t,e[t]);if(fl)for(var t of fl(e))j2.call(e,t)&&uo(r,t,e[t]);return r},Z=(r,e,t)=>uo(r,typeof e!="symbol"?e+"":e,t);class B2 extends e_{constructor(e){super(e),Z(this,"protocol","wc"),Z(this,"version",2),Z(this,"core"),Z(this,"logger"),Z(this,"events",new Je.EventEmitter),Z(this,"provider"),Z(this,"messages"),Z(this,"subscriber"),Z(this,"publisher"),Z(this,"name",d1),Z(this,"transportExplicitlyClosed",!1),Z(this,"initialized",!1),Z(this,"connectionAttemptInProgress",!1),Z(this,"relayUrl"),Z(this,"projectId"),Z(this,"packageName"),Z(this,"bundleId"),Z(this,"hasExperiencedNetworkDisruption",!1),Z(this,"pingTimeout"),Z(this,"heartBeatTimeout",U.toMiliseconds(U.THIRTY_SECONDS+U.FIVE_SECONDS)),Z(this,"reconnectTimeout"),Z(this,"connectPromise"),Z(this,"reconnectInProgress",!1),Z(this,"requestsInFlight",[]),Z(this,"connectTimeout",U.toMiliseconds(U.ONE_SECOND*15)),Z(this,"request",async t=>{var i,s;this.logger.debug("Publishing Request Payload");const n=t.id||or().toString();await this.toEstablishConnection();try{this.logger.trace({id:n,method:t.method,topic:(i=t.params)==null?void 0:i.topic},"relayer.request - publishing...");const o=`${n}:${((s=t.params)==null?void 0:s.tag)||""}`;this.requestsInFlight.push(o);const a=await this.provider.request(t);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${n}`),o}}),Z(this,"resetPingTimeout",()=>{ps()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var t,i,s,n;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(n=(s=(i=(t=this.provider)==null?void 0:t.connection)==null?void 0:i.socket)==null?void 0:s.terminate)==null||n.call(s)}catch(o){this.logger.warn(o,o?.message)}},this.heartBeatTimeout))}),Z(this,"onPayloadHandler",t=>{this.onProviderPayload(t),this.resetPingTimeout()}),Z(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected \uD83D\uDEDC"),this.startPingTimeout(),this.events.emit(we.connect)}),Z(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected \uD83D\uDED1"),this.requestsInFlight=[],this.onProviderDisconnect()}),Z(this,"onProviderErrorHandler",t=>{this.logger.fatal(`Fatal socket error: ${t.message}`),this.events.emit(we.error,t),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),Z(this,"registerProviderListeners",()=>{this.provider.on(Qe.payload,this.onPayloadHandler),this.provider.on(Qe.connect,this.onConnectHandler),this.provider.on(Qe.disconnect,this.onDisconnectHandler),this.provider.on(Qe.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?je(e.logger,this.name):Ui(Ns({level:e.logger||u1})),this.messages=new m2(this.logger,e.core),this.subscriber=new T2(this,this.logger),this.publisher=new I2(this,this.logger),this.relayUrl=e?.relayUrl||Gu,this.projectId=e.projectId,bw()?this.packageName=Ga():vw()&&(this.bundleId=Ga()),this.provider={}}async init(){if(this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.subscriber.hasAnyTopics)try{await this.transportOpen()}catch(e){this.logger.warn(e,e?.message)}}get context(){return ze(this.logger)}get connected(){var e,t,i;return((i=(t=(e=this.provider)==null?void 0:e.connection)==null?void 0:t.socket)==null?void 0:i.readyState)===1||!1}get connecting(){var e,t,i;return((i=(t=(e=this.provider)==null?void 0:e.connection)==null?void 0:t.socket)==null?void 0:i.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,t,i){this.isInitialized(),await this.publisher.publish(e,t,i),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now(),transportType:ae.relay},cs.outbound)}async subscribe(e,t){var i,s,n;this.isInitialized(),(!(t!=null&&t.transportType)||t?.transportType==="relay")&&await this.toEstablishConnection();const o=typeof((i=t?.internal)==null?void 0:i.throwOnFailedPublish)>"u"?!0:(s=t?.internal)==null?void 0:s.throwOnFailedPublish;let a=((n=this.subscriber.topicMap.get(e))==null?void 0:n[0])||"",c;const l=h=>{h.topic===e&&(this.subscriber.off(Ve.created,l),c())};return await Promise.all([new Promise(h=>{c=h,this.subscriber.on(Ve.created,l)}),new Promise(async(h,u)=>{a=await this.subscriber.subscribe(e,gl({internal:{throwOnFailedPublish:o}},t)).catch(d=>{o&&u(d)})||a,h()})]),a}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await Ht(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.warn("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(t,i)=>{await this.connect(e).then(t).catch(i).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Bc())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const t=e.sort((i,s)=>i.publishedAt-s.publishedAt);this.logger.debug(`Batch of ${t.length} message events sorted`);for(const i of t)try{await this.onMessageEvent(i)}catch(s){this.logger.warn(s,"Error while processing batch message event: "+s?.message)}this.logger.trace(`Batch of ${t.length} message events processed`)}async onLinkMessageEvent(e,t){const{topic:i}=e;if(!t.sessionExists){const s=de(U.FIVE_MINUTES),n={topic:i,expiry:s,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(i,n)}this.events.emit(we.message,e),await this.recordMessageEvent(e,cs.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let t=1;for(;t<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${t}...`),await this.createProvider(),await new Promise(async(i,s)=>{const n=()=>{s(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Qe.disconnect,n),await Ht(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{s(o)}).finally(()=>{this.provider.off(Qe.disconnect,n),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{a(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Qe.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(Qe.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,i()})}catch(i){await this.subscriber.stop();const s=i;this.logger.warn({},s.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${t}`);break}await new Promise(i=>setTimeout(i,U.toMiliseconds(t*1))),t++}}startPingTimeout(){var e,t,i,s,n;if(ps())try{(t=(e=this.provider)==null?void 0:e.connection)!=null&&t.socket&&((n=(s=(i=this.provider)==null?void 0:i.connection)==null?void 0:s.socket)==null||n.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new st(new e1(Dw({sdkVersion:no,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,t){const{topic:i,message:s}=e;await this.messages.set(i,s,t)}async shouldIgnoreMessageEvent(e){const{topic:t,message:i}=e;if(!i||i.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isKnownTopic(t))return this.logger.warn(`Ignoring message for unknown topic ${t}`),!0;const s=this.messages.has(t,i);return s&&this.logger.warn(`Ignoring duplicate message: ${i}`),s}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Mo(e)){if(!e.method.endsWith(p1))return;const t=e.params,{topic:i,message:s,publishedAt:n,attestation:o}=t.data,a={topic:i,message:s,publishedAt:n,transportType:ae.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(gl({type:"event",event:t.id},a)),this.events.emit(t.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else Us(e)&&this.events.emit(we.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,cs.inbound),this.events.emit(we.message,e))}async acknowledgePayload(e){const t=js(e.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(Qe.payload,this.onPayloadHandler),this.provider.off(Qe.connect,this.onConnectHandler),this.provider.off(Qe.disconnect,this.onDisconnectHandler),this.provider.off(Qe.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await Bc();W0(async t=>{e!==t&&(e=t,t?await this.transportOpen().catch(i=>this.logger.error(i,i?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(fr.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&J0())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(t){this.logger.warn(t,t?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(we.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},U.toMiliseconds(f1)))))}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function U2(){}function yl(r){if(!r||typeof r!="object")return!1;const e=Object.getPrototypeOf(r);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(r)==="[object Object]":!1}function ml(r){return Object.getOwnPropertySymbols(r).filter(e=>Object.prototype.propertyIsEnumerable.call(r,e))}function wl(r){return r==null?r===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(r)}const q2="[object RegExp]",L2="[object String]",k2="[object Number]",M2="[object Boolean]",bl="[object Arguments]",z2="[object Symbol]",F2="[object Date]",H2="[object Map]",V2="[object Set]",K2="[object Array]",W2="[object Function]",G2="[object ArrayBuffer]",Sn="[object Object]",Y2="[object Error]",J2="[object DataView]",Z2="[object Uint8Array]",Q2="[object Uint8ClampedArray]",X2="[object Uint16Array]",eS="[object Uint32Array]",tS="[object BigUint64Array]",rS="[object Int8Array]",iS="[object Int16Array]",sS="[object Int32Array]",nS="[object BigInt64Array]",oS="[object Float32Array]",aS="[object Float64Array]";function cS(r,e){return r===e||Number.isNaN(r)&&Number.isNaN(e)}function lS(r,e,t){return gi(r,e,void 0,void 0,void 0,void 0,t)}function gi(r,e,t,i,s,n,o){const a=o(r,e,t,i,s,n);if(a!==void 0)return a;if(typeof r==typeof e)switch(typeof r){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return r===e;case"number":return r===e||Object.is(r,e);case"function":return r===e;case"object":return vi(r,e,n,o)}return vi(r,e,n,o)}function vi(r,e,t,i){if(Object.is(r,e))return!0;let s=wl(r),n=wl(e);if(s===bl&&(s=Sn),n===bl&&(n=Sn),s!==n)return!1;switch(s){case L2:return r.toString()===e.toString();case k2:{const c=r.valueOf(),l=e.valueOf();return cS(c,l)}case M2:case F2:case z2:return Object.is(r.valueOf(),e.valueOf());case q2:return r.source===e.source&&r.flags===e.flags;case W2:return r===e}t=t??new Map;const o=t.get(r),a=t.get(e);if(o!=null&&a!=null)return o===e;t.set(r,e),t.set(e,r);try{switch(s){case H2:{if(r.size!==e.size)return!1;for(const[c,l]of r.entries())if(!e.has(c)||!gi(l,e.get(c),c,r,e,t,i))return!1;return!0}case V2:{if(r.size!==e.size)return!1;const c=Array.from(r.values()),l=Array.from(e.values());for(let h=0;h<c.length;h++){const u=c[h],d=l.findIndex(f=>gi(u,f,void 0,r,e,t,i));if(d===-1)return!1;l.splice(d,1)}return!0}case K2:case Z2:case Q2:case X2:case eS:case tS:case rS:case iS:case sS:case nS:case oS:case aS:{if(typeof Ee<"u"&&Ee.isBuffer(r)!==Ee.isBuffer(e)||r.length!==e.length)return!1;for(let c=0;c<r.length;c++)if(!gi(r[c],e[c],c,r,e,t,i))return!1;return!0}case G2:return r.byteLength!==e.byteLength?!1:vi(new Uint8Array(r),new Uint8Array(e),t,i);case J2:return r.byteLength!==e.byteLength||r.byteOffset!==e.byteOffset?!1:vi(new Uint8Array(r),new Uint8Array(e),t,i);case Y2:return r.name===e.name&&r.message===e.message;case Sn:{if(!(vi(r.constructor,e.constructor,t,i)||yl(r)&&yl(e)))return!1;const c=[...Object.keys(r),...ml(r)],l=[...Object.keys(e),...ml(e)];if(c.length!==l.length)return!1;for(let h=0;h<c.length;h++){const u=c[h],d=r[u];if(!Object.hasOwn(e,u))return!1;const f=e[u];if(!gi(d,f,u,r,e,t,i))return!1}return!0}default:return!1}}finally{t.delete(r),t.delete(e)}}function hS(r,e){return lS(r,e,U2)}var uS=Object.defineProperty,vl=Object.getOwnPropertySymbols,dS=Object.prototype.hasOwnProperty,pS=Object.prototype.propertyIsEnumerable,po=(r,e,t)=>e in r?uS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,El=(r,e)=>{for(var t in e||(e={}))dS.call(e,t)&&po(r,t,e[t]);if(vl)for(var t of vl(e))pS.call(e,t)&&po(r,t,e[t]);return r},Ue=(r,e,t)=>po(r,typeof e!="symbol"?e+"":e,t);class gr extends t_{constructor(e,t,i,s=It,n=void 0){super(e,t,i,s),this.core=e,this.logger=t,this.name=i,Ue(this,"map",new Map),Ue(this,"version",g1),Ue(this,"cached",[]),Ue(this,"initialized",!1),Ue(this,"getKey"),Ue(this,"storagePrefix",It),Ue(this,"recentlyDeleted",[]),Ue(this,"recentlyDeletedLimit",200),Ue(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!Oe(o)?this.map.set(this.getKey(o),o):S0(o)?this.map.set(o.id,o):D0(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),Ue(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),Ue(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),Ue(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>hS(a[c],o[c]))):this.values)),Ue(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=El(El({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),Ue(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=je(t,this.name),this.storagePrefix=s,this.getKey=n}get context(){return ze(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){if(this.recentlyDeleted.includes(e)){const{message:s}=q("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}const{message:i}=q("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:t}=q("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}}var fS=Object.defineProperty,gS=(r,e,t)=>e in r?fS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,W=(r,e,t)=>gS(r,typeof e!="symbol"?e+"":e,t);class yS{constructor(e,t){this.core=e,this.logger=t,W(this,"name",b1),W(this,"version",v1),W(this,"events",new _o),W(this,"pairings"),W(this,"initialized",!1),W(this,"storagePrefix",It),W(this,"ignoredPayloadTypes",[jt]),W(this,"registeredMethods",[]),W(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),W(this,"register",({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]}),W(this,"create",async i=>{this.isInitialized();const s=Xn(),n=await this.core.crypto.setSymKey(s),o=de(U.FIVE_MINUTES),a={protocol:Wu},c={topic:n,expiry:o,relay:a,active:!1,methods:i?.methods},l=$c({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:s,relay:a,expiryTimestamp:o,methods:i?.methods});return this.events.emit(ir.create,c),this.core.expirer.set(n,o),await this.pairings.set(n,c),await this.core.relayer.subscribe(n,{transportType:i?.transportType}),{topic:n,uri:l}}),W(this,"pair",async i=>{this.isInitialized();const s=this.core.eventClient.createEvent({properties:{topic:i?.uri,trace:[wt.pairing_started]}});this.isValidPair(i,s);const{topic:n,symKey:o,relay:a,expiryTimestamp:c,methods:l}=Oc(i.uri);s.props.properties.topic=n,s.addTrace(wt.pairing_uri_validation_success),s.addTrace(wt.pairing_uri_not_expired);let h;if(this.pairings.keys.includes(n)){if(h=this.pairings.get(n),s.addTrace(wt.existing_pairing),h.active)throw s.setError(Ct.active_pairing_already_exists),new Error(`Pairing already exists: ${n}. Please try again with a new connection URI.`);s.addTrace(wt.pairing_not_expired)}const u=c||de(U.FIVE_MINUTES),d={topic:n,relay:a,expiry:u,active:!1,methods:l};this.core.expirer.set(n,u),await this.pairings.set(n,d),s.addTrace(wt.store_new_pairing),i.activatePairing&&await this.activate({topic:n}),this.events.emit(ir.create,d),s.addTrace(wt.emit_inactive_pairing),this.core.crypto.keychain.has(n)||await this.core.crypto.setSymKey(o,n),s.addTrace(wt.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{s.setError(Ct.no_internet_connection)}try{await this.core.relayer.subscribe(n,{relay:a})}catch(f){throw s.setError(Ct.subscribe_pairing_topic_failure),f}return s.addTrace(wt.subscribe_pairing_topic_success),d}),W(this,"activate",async({topic:i})=>{this.isInitialized();const s=de(U.FIVE_MINUTES);this.core.expirer.set(i,s),await this.pairings.update(i,{active:!0,expiry:s})}),W(this,"ping",async i=>{this.isInitialized(),await this.isValidPing(i),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:s}=i;if(this.pairings.keys.includes(s)){const n=await this.sendRequest(s,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=Xt();this.events.once(X("pairing_ping",n),({error:l})=>{l?c(l):a()}),await o()}}),W(this,"updateExpiry",async({topic:i,expiry:s})=>{this.isInitialized(),await this.pairings.update(i,{expiry:s})}),W(this,"updateMetadata",async({topic:i,metadata:s})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:s})}),W(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),W(this,"disconnect",async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:s}=i;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",te("USER_DISCONNECTED")),await this.deletePairing(s))}),W(this,"formatUriFromPairing",i=>{this.isInitialized();const{topic:s,relay:n,expiry:o,methods:a}=i,c=this.core.crypto.keychain.get(s);return $c({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:c,relay:n,expiryTimestamp:o,methods:a})}),W(this,"sendRequest",async(i,s,n)=>{const o=Vt(s,n),a=await this.core.crypto.encode(i,o),c=li[s].req;return this.core.history.set(i,o),this.core.relayer.publish(i,a,c),o.id}),W(this,"sendResult",async(i,s,n)=>{const o=js(i,n),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,i)).request.method,l=li[c].res;await this.core.relayer.publish(s,a,l),await this.core.history.resolve(o)}),W(this,"sendError",async(i,s,n)=>{const o=Bs(i,n),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,i)).request.method,l=li[c]?li[c].res:li.unregistered_method.res;await this.core.relayer.publish(s,a,l),await this.core.history.resolve(o)}),W(this,"deletePairing",async(i,s)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,te("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),s?Promise.resolve():this.core.expirer.del(i)])}),W(this,"cleanup",async()=>{const i=this.pairings.getAll().filter(s=>zt(s.expiry));await Promise.all(i.map(s=>this.deletePairing(s.topic)))}),W(this,"onRelayEventRequest",async i=>{const{topic:s,payload:n}=i;switch(n.method){case"wc_pairingPing":return await this.onPairingPingRequest(s,n);case"wc_pairingDelete":return await this.onPairingDeleteRequest(s,n);default:return await this.onUnknownRpcMethodRequest(s,n)}}),W(this,"onRelayEventResponse",async i=>{const{topic:s,payload:n}=i,o=(await this.core.history.get(s,n.id)).request.method;return o==="wc_pairingPing"?this.onPairingPingResponse(s,n):this.onUnknownRpcMethodResponse(o)}),W(this,"onPairingPingRequest",async(i,s)=>{const{id:n}=s;try{this.isValidPing({topic:i}),await this.sendResult(n,i,!0),this.events.emit(ir.ping,{id:n,topic:i})}catch(o){await this.sendError(n,i,o),this.logger.error(o)}}),W(this,"onPairingPingResponse",(i,s)=>{const{id:n}=s;setTimeout(()=>{vt(s)?this.events.emit(X("pairing_ping",n),{}):tt(s)&&this.events.emit(X("pairing_ping",n),{error:s.error})},500)}),W(this,"onPairingDeleteRequest",async(i,s)=>{const{id:n}=s;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit(ir.delete,{id:n,topic:i})}catch(o){await this.sendError(n,i,o),this.logger.error(o)}}),W(this,"onUnknownRpcMethodRequest",async(i,s)=>{const{id:n,method:o}=s;try{if(this.registeredMethods.includes(o))return;const a=te("WC_METHOD_UNSUPPORTED",o);await this.sendError(n,i,a),this.logger.error(a)}catch(a){await this.sendError(n,i,a),this.logger.error(a)}}),W(this,"onUnknownRpcMethodResponse",i=>{this.registeredMethods.includes(i)||this.logger.error(te("WC_METHOD_UNSUPPORTED",i))}),W(this,"isValidPair",(i,s)=>{var n;if(!Le(i)){const{message:a}=q("MISSING_OR_INVALID",`pair() params: ${i}`);throw s.setError(Ct.malformed_pairing_uri),new Error(a)}if(!I0(i.uri)){const{message:a}=q("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw s.setError(Ct.malformed_pairing_uri),new Error(a)}const o=Oc(i?.uri);if(!((n=o?.relay)!=null&&n.protocol)){const{message:a}=q("MISSING_OR_INVALID","pair() uri#relay-protocol");throw s.setError(Ct.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=q("MISSING_OR_INVALID","pair() uri#symKey");throw s.setError(Ct.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&U.toMiliseconds(o?.expiryTimestamp)<Date.now()){s.setError(Ct.pairing_expired);const{message:a}=q("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),W(this,"isValidPing",async i=>{if(!Le(i)){const{message:n}=q("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)}),W(this,"isValidDisconnect",async i=>{if(!Le(i)){const{message:n}=q("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)}),W(this,"isValidPairingTopic",async i=>{if(!ue(i,!1)){const{message:s}=q("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(s)}if(!this.pairings.keys.includes(i)){const{message:s}=q("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(s)}if(zt(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:s}=q("EXPIRED",`pairing topic: ${i}`);throw new Error(s)}}),this.core=e,this.logger=je(t,this.name),this.pairings=new gr(this.core,this.logger,this.name,this.storagePrefix)}get context(){return ze(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(we.message,async e=>{const{topic:t,message:i,transportType:s}=e;if(this.pairings.keys.includes(t)&&s!==ae.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))try{const n=await this.core.crypto.decode(t,i);Mo(n)?(this.core.history.set(t,n),await this.onRelayEventRequest({topic:t,payload:n})):Us(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:t,payload:n}),this.core.history.delete(t,n.id)),await this.core.relayer.messages.ack(t,i)}catch(n){this.logger.error(n)}})}registerExpirerEvents(){this.core.expirer.on(et.expired,async e=>{const{topic:t}=tu(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(ir.expire,{topic:t}))})}}var mS=Object.defineProperty,wS=(r,e,t)=>e in r?mS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,De=(r,e,t)=>wS(r,typeof e!="symbol"?e+"":e,t);class bS extends ZE{constructor(e,t){super(e,t),this.core=e,this.logger=t,De(this,"records",new Map),De(this,"events",new Je.EventEmitter),De(this,"name",E1),De(this,"version",_1),De(this,"cached",[]),De(this,"initialized",!1),De(this,"storagePrefix",It),De(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),De(this,"set",(i,s,n)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:s,chainId:n}),this.records.has(s.id))return;const o={id:s.id,topic:i,request:{method:s.method,params:s.params||null},chainId:n,expiry:de(U.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(at.created,o)}),De(this,"resolve",async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const s=await this.getRecord(i.id);typeof s.response>"u"&&(s.response=tt(i)?{error:i.error}:{result:i.result},this.records.set(s.id,s),this.persist(),this.events.emit(at.updated,s))}),De(this,"get",async(i,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:s}),await this.getRecord(s))),De(this,"delete",(i,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(n=>{if(n.topic===i){if(typeof s<"u"&&n.id!==s)return;this.records.delete(n.id),this.events.emit(at.deleted,n)}}),this.persist()}),De(this,"exists",async(i,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===i:!1)),De(this,"on",(i,s)=>{this.events.on(i,s)}),De(this,"once",(i,s)=>{this.events.once(i,s)}),De(this,"off",(i,s)=>{this.events.off(i,s)}),De(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.logger=je(t,this.name)}get context(){return ze(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const i={topic:t.topic,request:Vt(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:i}=q("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(at.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:t}=q("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(at.created,e=>{const t=at.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(at.updated,e=>{const t=at.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(at.deleted,e=>{const t=at.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.core.heartbeat.on(fr.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(t=>{U.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.records.delete(t.id),this.events.emit(at.deleted,t,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}}var vS=Object.defineProperty,ES=(r,e,t)=>e in r?vS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ce=(r,e,t)=>ES(r,typeof e!="symbol"?e+"":e,t);class _S extends i_{constructor(e,t){super(e,t),this.core=e,this.logger=t,Ce(this,"expirations",new Map),Ce(this,"events",new Je.EventEmitter),Ce(this,"name",I1),Ce(this,"version",S1),Ce(this,"cached",[]),Ce(this,"initialized",!1),Ce(this,"storagePrefix",It),Ce(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Ce(this,"has",i=>{try{const s=this.formatTarget(i);return typeof this.getExpiration(s)<"u"}catch{return!1}}),Ce(this,"set",(i,s)=>{this.isInitialized();const n=this.formatTarget(i),o={target:n,expiry:s};this.expirations.set(n,o),this.checkExpiry(n,o),this.events.emit(et.created,{target:n,expiration:o})}),Ce(this,"get",i=>{this.isInitialized();const s=this.formatTarget(i);return this.getExpiration(s)}),Ce(this,"del",i=>{if(this.isInitialized(),this.has(i)){const s=this.formatTarget(i),n=this.getExpiration(s);this.expirations.delete(s),this.events.emit(et.deleted,{target:s,expiration:n})}}),Ce(this,"on",(i,s)=>{this.events.on(i,s)}),Ce(this,"once",(i,s)=>{this.events.once(i,s)}),Ce(this,"off",(i,s)=>{this.events.off(i,s)}),Ce(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.logger=je(t,this.name)}get context(){return ze(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return Ow(e);if(typeof e=="number")return $w(e);const{message:t}=q("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(et.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:t}=q("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:i}=q("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(i),new Error(i)}return t}checkExpiry(e,t){const{expiry:i}=t;U.toMiliseconds(i)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(et.expired,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(fr.pulse,()=>this.checkExpirations()),this.events.on(et.created,e=>{const t=et.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(et.expired,e=>{const t=et.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(et.deleted,e=>{const t=et.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}}var IS=Object.defineProperty,SS=(r,e,t)=>e in r?IS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,he=(r,e,t)=>SS(r,typeof e!="symbol"?e+"":e,t);class DS extends s_{constructor(e,t,i){super(e,t,i),this.core=e,this.logger=t,this.store=i,he(this,"name",D1),he(this,"abortController"),he(this,"isDevEnv"),he(this,"verifyUrlV3",$1),he(this,"storagePrefix",It),he(this,"version",Ku),he(this,"publicKey"),he(this,"fetchPromise"),he(this,"init",async()=>{var s;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&U.toMiliseconds((s=this.publicKey)==null?void 0:s.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),he(this,"register",async s=>{if(!Qr()||this.isDevEnv)return;const n=window.location.origin,{id:o,decryptedId:a}=s,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${n}&id=${o}&decryptedId=${a}`;try{const l=Bt.getDocument(),h=this.startAbortTimer(U.ONE_SECOND*5),u=await new Promise((d,f)=>{const p=()=>{window.removeEventListener("message",w),l.body.removeChild(g),f("attestation aborted")};this.abortController.signal.addEventListener("abort",p);const g=l.createElement("iframe");g.src=c,g.style.display="none",g.addEventListener("error",p,{signal:this.abortController.signal});const w=_=>{if(_.data&&typeof _.data=="string")try{const b=JSON.parse(_.data);if(b.type==="verify_attestation"){if(Mn(b.attestation).payload.id!==o)return;clearInterval(h),l.body.removeChild(g),this.abortController.signal.removeEventListener("abort",p),window.removeEventListener("message",w),d(b.attestation===null?"":b.attestation)}}catch(b){this.logger.warn(b)}};l.body.appendChild(g),window.addEventListener("message",w,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",u),u}catch(l){this.logger.warn(l)}return""}),he(this,"resolve",async s=>{if(this.isDevEnv)return"";const{attestationId:n,hash:o,encryptedId:a}=s;if(n===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(n){if(Mn(n).payload.id!==a)return;const l=await this.isValidJwtAttestation(n);if(l){if(!l.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return l}}if(!o)return;const c=this.getVerifyUrl(s?.verifyUrl);return this.fetchAttestation(o,c)}),he(this,"fetchAttestation",async(s,n)=>{this.logger.debug(`resolving attestation: ${s} from url: ${n}`);const o=this.startAbortTimer(U.ONE_SECOND*5),a=await fetch(`${n}/attestation/${s}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),he(this,"getVerifyUrl",s=>{let n=s||bi;return P1.includes(n)||(this.logger.info(`verify url: ${n}, not included in trusted list, assigning default: ${bi}`),n=bi),n}),he(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const s=this.startAbortTimer(U.FIVE_SECONDS),n=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(s),await n.json()}catch(s){this.logger.warn(s)}}),he(this,"persistPublicKey",async s=>{this.logger.debug("persisting public key to local storage",s),await this.store.setItem(this.storeKey,s),this.publicKey=s}),he(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),he(this,"isValidJwtAttestation",async s=>{const n=await this.getPublicKey();try{if(n)return this.validateAttestation(s,n)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(s,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),he(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),he(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async n=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),n(o))});const s=await this.fetchPromise;return this.fetchPromise=void 0,s}),he(this,"validateAttestation",(s,n)=>{const o=r0(s,n.publicKey),a={hasExpired:U.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=je(t,this.name),this.abortController=new AbortController,this.isDevEnv=Co(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return ze(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),U.toMiliseconds(e))}}var OS=Object.defineProperty,$S=(r,e,t)=>e in r?OS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,_l=(r,e,t)=>$S(r,typeof e!="symbol"?e+"":e,t);class PS extends n_{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,_l(this,"context",x1),_l(this,"registerDeviceToken",async i=>{const{clientId:s,token:n,notificationType:o,enableEncrypted:a=!1}=i,c=`${A1}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:s,type:o,token:n,always_raw:a})})}),this.logger=je(t,this.context)}}var xS=Object.defineProperty,Il=Object.getOwnPropertySymbols,AS=Object.prototype.hasOwnProperty,CS=Object.prototype.propertyIsEnumerable,fo=(r,e,t)=>e in r?xS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,di=(r,e)=>{for(var t in e||(e={}))AS.call(e,t)&&fo(r,t,e[t]);if(Il)for(var t of Il(e))CS.call(e,t)&&fo(r,t,e[t]);return r},fe=(r,e,t)=>fo(r,typeof e!="symbol"?e+"":e,t);class TS extends o_{constructor(e,t,i=!0){super(e,t,i),this.core=e,this.logger=t,fe(this,"context",T1),fe(this,"storagePrefix",It),fe(this,"storageVersion",C1),fe(this,"events",new Map),fe(this,"shouldPersist",!1),fe(this,"init",async()=>{if(!Co())try{const s={eventId:Ja(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:Xh(this.core.relayer.protocol,this.core.relayer.version,no)}}};await this.sendEvent([s])}catch(s){this.logger.warn(s)}}),fe(this,"createEvent",s=>{const{event:n="ERROR",type:o="",properties:{topic:a,trace:c}}=s,l=Ja(),h=this.core.projectId||"",u=Date.now(),d=di({eventId:l,timestamp:u,props:{event:n,type:o,properties:{topic:a,trace:c}},bundleId:h,domain:this.getAppDomain()},this.setMethods(l));return this.telemetryEnabled&&(this.events.set(l,d),this.shouldPersist=!0),d}),fe(this,"getEvent",s=>{const{eventId:n,topic:o}=s;if(n)return this.events.get(n);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return di(di({},a),this.setMethods(a.eventId))}),fe(this,"deleteEvent",s=>{const{eventId:n}=s;this.events.delete(n),this.shouldPersist=!0}),fe(this,"setEventListeners",()=>{this.core.heartbeat.on(fr.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(s=>{U.fromMiliseconds(Date.now())-U.fromMiliseconds(s.timestamp)>R1&&(this.events.delete(s.eventId),this.shouldPersist=!0)})})}),fe(this,"setMethods",s=>({addTrace:n=>this.addTrace(s,n),setError:n=>this.setError(s,n)})),fe(this,"addTrace",(s,n)=>{const o=this.events.get(s);o&&(o.props.properties.trace.push(n),this.events.set(s,o),this.shouldPersist=!0)}),fe(this,"setError",(s,n)=>{const o=this.events.get(s);o&&(o.props.type=n,o.timestamp=Date.now(),this.events.set(s,o),this.shouldPersist=!0)}),fe(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),fe(this,"restore",async()=>{try{const s=await this.core.storage.getItem(this.storageKey)||[];if(!s.length)return;s.forEach(n=>{this.events.set(n.eventId,di(di({},n),this.setMethods(n.eventId)))})}catch(s){this.logger.warn(s)}}),fe(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const s=[];for(const[n,o]of this.events)o.props.type&&s.push(o);if(s.length!==0)try{if((await this.sendEvent(s)).ok)for(const n of s)this.events.delete(n.eventId),this.shouldPersist=!0}catch(n){this.logger.warn(n)}}),fe(this,"sendEvent",async s=>{const n=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${N1}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${no}${n}`,{method:"POST",body:JSON.stringify(s)})}),fe(this,"getAppDomain",()=>Qh().url),this.logger=je(t,this.context),this.telemetryEnabled=i,i?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var RS=Object.defineProperty,Sl=Object.getOwnPropertySymbols,NS=Object.prototype.hasOwnProperty,jS=Object.prototype.propertyIsEnumerable,go=(r,e,t)=>e in r?RS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Dl=(r,e)=>{for(var t in e||(e={}))NS.call(e,t)&&go(r,t,e[t]);if(Sl)for(var t of Sl(e))jS.call(e,t)&&go(r,t,e[t]);return r},oe=(r,e,t)=>go(r,typeof e!="symbol"?e+"":e,t);let BS=class od extends WE{constructor(e){var t;super(e),oe(this,"protocol",Vu),oe(this,"version",Ku),oe(this,"name",so),oe(this,"relayUrl"),oe(this,"projectId"),oe(this,"customStoragePrefix"),oe(this,"events",new Je.EventEmitter),oe(this,"logger"),oe(this,"heartbeat"),oe(this,"relayer"),oe(this,"crypto"),oe(this,"storage"),oe(this,"history"),oe(this,"expirer"),oe(this,"pairing"),oe(this,"verify"),oe(this,"echoClient"),oe(this,"linkModeSupportedApps"),oe(this,"eventClient"),oe(this,"initialized",!1),oe(this,"logChunkController"),oe(this,"on",(a,c)=>this.events.on(a,c)),oe(this,"once",(a,c)=>this.events.once(a,c)),oe(this,"off",(a,c)=>this.events.off(a,c)),oe(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),oe(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:l})=>{if(!a||!c)return;const h={topic:a,message:c,publishedAt:Date.now(),transportType:ae.link_mode};this.relayer.onLinkMessageEvent(h,{sessionExists:l})});const i=this.getGlobalCore(e?.customStoragePrefix);if(i)try{return this.customStoragePrefix=i.customStoragePrefix,this.logger=i.logger,this.heartbeat=i.heartbeat,this.crypto=i.crypto,this.history=i.history,this.expirer=i.expirer,this.storage=i.storage,this.relayer=i.relayer,this.pairing=i.pairing,this.verify=i.verify,this.echoClient=i.echoClient,this.linkModeSupportedApps=i.linkModeSupportedApps,this.eventClient=i.eventClient,this.initialized=i.initialized,this.logChunkController=i.logChunkController,i}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||Gu,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const s=Ns({level:typeof e?.logger=="string"&&e.logger?e.logger:r1.logger,name:so}),{logger:n,chunkLoggerController:o}=HE({opts:s,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=o,(t=this.logChunkController)!=null&&t.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=je(n,this.name),this.heartbeat=new Q0,this.crypto=new l2(this,this.logger,e?.keychain),this.history=new bS(this,this.logger),this.expirer=new _S(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new $E(Dl(Dl({},i1),e?.storageOptions)),this.relayer=new B2({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new yS(this,this.logger),this.verify=new DS(this,this.logger,this.storage),this.echoClient=new PS(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new TS(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const t=new od(e);await t.initialize();const i=await t.crypto.getClientId();return await t.storage.setItem(y1,i),t}get context(){return ze(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(sl,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(sl)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const t=`_walletConnectCore_${e}`,i=`${t}_count`;return globalThis[i]=(globalThis[i]||0)+1,globalThis[i]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[i]} times.`),globalThis[t]}catch(t){console.warn("Failed to get global WalletConnect core",t);return}}setGlobalCore(e){var t;try{if(this.isGlobalCoreDisabled())return;const i=`_walletConnectCore_${((t=e.opts)==null?void 0:t.customStoragePrefix)||""}`;globalThis[i]=e}catch(i){console.warn("Failed to set global WalletConnect core",i)}}isGlobalCoreDisabled(){try{return typeof it<"u"&&t1.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}};const US=BS,ad="wc",cd=2,ld="client",zo=`${ad}@${cd}:${ld}:`,Dn={name:ld,logger:"error"},Ol="WALLETCONNECT_DEEPLINK_CHOICE",qS="proposal",$l="Proposal expired",LS="session",Sr=U.SEVEN_DAYS,kS="engine",ge={wc_sessionPropose:{req:{ttl:U.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:U.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:U.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:U.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:U.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:U.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:U.ONE_DAY,prompt:!1,tag:1104},res:{ttl:U.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:U.ONE_DAY,prompt:!1,tag:1106},res:{ttl:U.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:U.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:U.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:U.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:U.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:U.ONE_DAY,prompt:!1,tag:1112},res:{ttl:U.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:U.ONE_DAY,prompt:!1,tag:1114},res:{ttl:U.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:U.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:U.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:U.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:U.FIVE_MINUTES,prompt:!1,tag:1119}}},On={min:U.FIVE_MINUTES,max:U.SEVEN_DAYS},mt={idle:"IDLE",active:"ACTIVE"},Pl={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"}},MS="request",zS=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],FS="wc",HS="auth",VS="authKeys",KS="pairingTopics",WS="requests",Ls=`${FS}@${1.5}:${HS}:`,ls=`${Ls}:PUB_KEY`;var GS=Object.defineProperty,YS=Object.defineProperties,JS=Object.getOwnPropertyDescriptors,xl=Object.getOwnPropertySymbols,ZS=Object.prototype.hasOwnProperty,QS=Object.prototype.propertyIsEnumerable,yo=(r,e,t)=>e in r?GS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,se=(r,e)=>{for(var t in e||(e={}))ZS.call(e,t)&&yo(r,t,e[t]);if(xl)for(var t of xl(e))QS.call(e,t)&&yo(r,t,e[t]);return r},Re=(r,e)=>YS(r,JS(e)),R=(r,e,t)=>yo(r,typeof e!="symbol"?e+"":e,t);class XS extends h_{constructor(e){super(e),R(this,"name",kS),R(this,"events",new _o),R(this,"initialized",!1),R(this,"requestQueue",{state:mt.idle,queue:[]}),R(this,"sessionRequestQueue",{state:mt.idle,queue:[]}),R(this,"requestQueueDelay",U.ONE_SECOND),R(this,"expectedPairingMethodMap",new Map),R(this,"recentlyDeletedMap",new Map),R(this,"recentlyDeletedLimit",200),R(this,"relayMessageCache",[]),R(this,"pendingSessions",new Map),R(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(ge)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},U.toMiliseconds(this.requestQueueDelay)))}),R(this,"connect",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const i=Re(se({},t),{requiredNamespaces:t.requiredNamespaces||{},optionalNamespaces:t.optionalNamespaces||{}});await this.isValidConnect(i),i.optionalNamespaces=w0(i.requiredNamespaces,i.optionalNamespaces),i.requiredNamespaces={};const{pairingTopic:s,requiredNamespaces:n,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:l}=i;let h=s,u,d=!1;try{if(h){const v=this.client.core.pairing.pairings.get(h);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),d=v.active}}catch(v){throw this.client.logger.error(`connect() -> pairing.get(${h}) failed`),v}if(!h||!d){const{topic:v,uri:I}=await this.client.core.pairing.create();h=v,u=I}if(!h){const{message:v}=q("NO_MATCHING_KEY",`connect() pairing topic: ${h}`);throw new Error(v)}const f=await this.client.core.crypto.generateKeyPair(),p=ge.wc_sessionPropose.req.ttl||U.FIVE_MINUTES,g=de(p),w=Re(se(se({requiredNamespaces:n,optionalNamespaces:o,relays:l??[{protocol:Wu}],proposer:{publicKey:f,metadata:this.client.metadata},expiryTimestamp:g,pairingTopic:h},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:bt()}),_=X("session_connect",w.id),{reject:b,resolve:E,done:x}=Xt(p,$l),T=({id:v})=>{v===w.id&&(this.client.events.off("proposal_expire",T),this.pendingSessions.delete(w.id),this.events.emit(_,{error:{message:$l,code:0}}))};return this.client.events.on("proposal_expire",T),this.events.once(_,({error:v,session:I})=>{this.client.events.off("proposal_expire",T),v?b(v):I&&E(I)}),await this.sendRequest({topic:h,method:"wc_sessionPropose",params:w,throwOnFailedPublish:!0,clientRpcId:w.id}),await this.setProposal(w.id,w),{uri:u,approval:x}}),R(this,"pair",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(t)}catch(i){throw this.client.logger.error("pair() failed"),i}}),R(this,"approve",async t=>{var i,s,n;const o=this.client.core.eventClient.createEvent({properties:{topic:(i=t?.id)==null?void 0:i.toString(),trace:[ct.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(D){throw o.setError(Zt.no_internet_connection),D}try{await this.isValidProposalId(t?.id)}catch(D){throw this.client.logger.error(`approve() -> proposal.get(${t?.id}) failed`),o.setError(Zt.proposal_not_found),D}try{await this.isValidApprove(t)}catch(D){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(Zt.session_approve_namespace_validation_failure),D}const{id:a,relayProtocol:c,namespaces:l,sessionProperties:h,scopedProperties:u,sessionConfig:d}=t,f=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:p,proposer:g,requiredNamespaces:w,optionalNamespaces:_}=f;let b=(s=this.client.core.eventClient)==null?void 0:s.getEvent({topic:p});b||(b=(n=this.client.core.eventClient)==null?void 0:n.createEvent({type:ct.session_approve_started,properties:{topic:p,trace:[ct.session_approve_started,ct.session_namespaces_validation_success]}}));const E=await this.client.core.crypto.generateKeyPair(),x=g.publicKey,T=await this.client.core.crypto.generateSharedKey(E,x),v=se(se(se({relay:{protocol:c??"irn"},namespaces:l,controller:{publicKey:E,metadata:this.client.metadata},expiry:de(Sr)},h&&{sessionProperties:h}),u&&{scopedProperties:u}),d&&{sessionConfig:d}),I=ae.relay;b.addTrace(ct.subscribing_session_topic);try{await this.client.core.relayer.subscribe(T,{transportType:I})}catch(D){throw b.setError(Zt.subscribe_session_topic_failure),D}b.addTrace(ct.subscribe_session_topic_success);const $=Re(se({},v),{topic:T,requiredNamespaces:w,optionalNamespaces:_,pairingTopic:p,acknowledged:!1,self:v.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:E,transportType:ae.relay});await this.client.session.set(T,$),b.addTrace(ct.store_session);try{b.addTrace(ct.publishing_session_settle),await this.sendRequest({topic:T,method:"wc_sessionSettle",params:v,throwOnFailedPublish:!0}).catch(D=>{throw b?.setError(Zt.session_settle_publish_failure),D}),b.addTrace(ct.session_settle_publish_success),b.addTrace(ct.publishing_session_approve),await this.sendResult({id:a,topic:p,result:{relay:{protocol:c??"irn"},responderPublicKey:E},throwOnFailedPublish:!0}).catch(D=>{throw b?.setError(Zt.session_approve_publish_failure),D}),b.addTrace(ct.session_approve_publish_success)}catch(D){throw this.client.logger.error(D),this.client.session.delete(T,te("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(T),D}return this.client.core.eventClient.deleteEvent({eventId:b.eventId}),await this.client.core.pairing.updateMetadata({topic:p,metadata:g.metadata}),await this.client.proposal.delete(a,te("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:p}),await this.setExpiry(T,de(Sr)),{topic:T,acknowledged:()=>Promise.resolve(this.client.session.get(T))}}),R(this,"reject",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(t)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:i,reason:s}=t;let n;try{n=this.client.proposal.get(i).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${i}) failed`),o}n&&(await this.sendError({id:i,topic:n,error:s,rpcOpts:ge.wc_sessionPropose.reject}),await this.client.proposal.delete(i,te("USER_DISCONNECTED")))}),R(this,"update",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(t)}catch(u){throw this.client.logger.error("update() -> isValidUpdate() failed"),u}const{topic:i,namespaces:s}=t,{done:n,resolve:o,reject:a}=Xt(),c=bt(),l=or().toString(),h=this.client.session.get(i).namespaces;return this.events.once(X("session_update",c),({error:u})=>{u?a(u):o()}),await this.client.session.update(i,{namespaces:s}),await this.sendRequest({topic:i,method:"wc_sessionUpdate",params:{namespaces:s},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:l}).catch(u=>{this.client.logger.error(u),this.client.session.update(i,{namespaces:h}),a(u)}),{acknowledged:n}}),R(this,"extend",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(t)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:i}=t,s=bt(),{done:n,resolve:o,reject:a}=Xt();return this.events.once(X("session_extend",s),({error:c})=>{c?a(c):o()}),await this.setExpiry(i,de(Sr)),this.sendRequest({topic:i,method:"wc_sessionExtend",params:{},clientRpcId:s,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:n}}),R(this,"request",async t=>{this.isInitialized();try{await this.isValidRequest(t)}catch(_){throw this.client.logger.error("request() -> isValidRequest() failed"),_}const{chainId:i,request:s,topic:n,expiry:o=ge.wc_sessionRequest.req.ttl}=t,a=this.client.session.get(n);a?.transportType===ae.relay&&await this.confirmOnlineStateOrThrow();const c=bt(),l=or().toString(),{done:h,resolve:u,reject:d}=Xt(o,"Request expired. Please try again.");this.events.once(X("session_request",c),({error:_,result:b})=>{_?d(_):u(b)});const f="wc_sessionRequest",p=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(p)return await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:n,method:f,params:{request:Re(se({},s),{expiryTimestamp:de(o)}),chainId:i},expiry:o,throwOnFailedPublish:!0,appLink:p}).catch(_=>d(_)),this.client.events.emit("session_request_sent",{topic:n,request:s,chainId:i,id:c}),await h();const g={request:Re(se({},s),{expiryTimestamp:de(o)}),chainId:i},w=this.shouldSetTVF(f,g);return await Promise.all([new Promise(async _=>{await this.sendRequest(se({clientRpcId:c,relayRpcId:l,topic:n,method:f,params:g,expiry:o,throwOnFailedPublish:!0},w&&{tvf:this.getTVFParams(c,g)})).catch(b=>d(b)),this.client.events.emit("session_request_sent",{topic:n,request:s,chainId:i,id:c}),_()}),new Promise(async _=>{var b;if(!((b=a.sessionConfig)!=null&&b.disableDeepLink)){const E=await Cw(this.client.core.storage,Ol);await Pw({id:c,topic:n,wcDeepLink:E})}_()}),h()]).then(_=>_[2])}),R(this,"respond",async t=>{this.isInitialized(),await this.isValidRespond(t);const{topic:i,response:s}=t,{id:n}=s,o=this.client.session.get(i);o.transportType===ae.relay&&await this.confirmOnlineStateOrThrow();const a=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);vt(s)?await this.sendResult({id:n,topic:i,result:s.result,throwOnFailedPublish:!0,appLink:a}):tt(s)&&await this.sendError({id:n,topic:i,error:s.error,appLink:a}),this.cleanupAfterResponse(t)}),R(this,"ping",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(t)}catch(s){throw this.client.logger.error("ping() -> isValidPing() failed"),s}const{topic:i}=t;if(this.client.session.keys.includes(i)){const s=bt(),n=or().toString(),{done:o,resolve:a,reject:c}=Xt();this.events.once(X("session_ping",s),({error:l})=>{l?c(l):a()}),await Promise.all([this.sendRequest({topic:i,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:s,relayRpcId:n}),o()])}else this.client.core.pairing.pairings.keys.includes(i)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:i}))}),R(this,"emit",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(t);const{topic:i,event:s,chainId:n}=t,o=or().toString(),a=bt();await this.sendRequest({topic:i,method:"wc_sessionEvent",params:{event:s,chainId:n},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),R(this,"disconnect",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(t);const{topic:i}=t;if(this.client.session.keys.includes(i))await this.sendRequest({topic:i,method:"wc_sessionDelete",params:te("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:i,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(i))await this.client.core.pairing.disconnect({topic:i});else{const{message:s}=q("MISMATCHED_TOPIC",`Session or pairing topic not found: ${i}`);throw new Error(s)}}),R(this,"find",t=>(this.isInitialized(),this.client.session.getAll().filter(i=>E0(i,t)))),R(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),R(this,"authenticate",async(t,i)=>{var s;this.isInitialized(),this.isValidAuthenticate(t);const n=i&&this.client.core.linkModeSupportedApps.includes(i)&&((s=this.client.metadata.redirect)==null?void 0:s.linkMode),o=n?ae.link_mode:ae.relay;o===ae.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:l,domain:h,nonce:u,type:d,exp:f,nbf:p,methods:g=[],expiry:w}=t,_=[...t.resources||[]],{topic:b,uri:E}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:b,uri:E}});const x=await this.client.core.crypto.generateKeyPair(),T=ns(x);if(await Promise.all([this.client.auth.authKeys.set(ls,{responseTopic:T,publicKey:x}),this.client.auth.pairingTopics.set(T,{topic:T,pairingTopic:b})]),await this.client.core.relayer.subscribe(T,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${b}`),g.length>0){const{namespace:O}=Mr(a[0]);let C=Ib(O,"request",g);ss(_)&&(C=Db(C,_.pop())),_.push(C)}const v=w&&w>ge.wc_sessionAuthenticate.req.ttl?w:ge.wc_sessionAuthenticate.req.ttl,I={authPayload:{type:d??"caip122",chains:a,statement:c,aud:l,domain:h,version:"1",nonce:u,iat:new Date().toISOString(),exp:f,nbf:p,resources:_},requester:{publicKey:x,metadata:this.client.metadata},expiryTimestamp:de(v)},$={eip155:{chains:a,methods:[...new Set(["personal_sign",...g])],events:["chainChanged","accountsChanged"]}},D={requiredNamespaces:{},optionalNamespaces:$,relays:[{protocol:"irn"}],pairingTopic:b,proposer:{publicKey:x,metadata:this.client.metadata},expiryTimestamp:de(ge.wc_sessionPropose.req.ttl),id:bt()},{done:j,resolve:N,reject:B}=Xt(v,"Request expired"),z=bt(),P=X("session_connect",D.id),y=X("session_request",z),m=async({error:O,session:C})=>{this.events.off(y,S),O?B(O):C&&N({session:C})},S=async O=>{var C,L,M;if(await this.deletePendingAuthRequest(z,{message:"fulfilled",code:0}),O.error){const Y=te("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return O.error.code===Y.code?void 0:(this.events.off(P,m),B(O.error.message))}await this.deleteProposal(D.id),this.events.off(P,m);const{cacaos:F,responder:k}=O.result,H=[],V=[];for(const Y of F){await sc({cacao:Y,projectId:this.client.core.projectId})||(this.client.logger.error(Y,"Signature verification failed"),B(te("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:Ae}=Y,_e=ss(Ae.resources),Te=[Hn(Ae.iss)],Ze=fs(Ae.iss);if(_e){const St=nc(_e),mr=oc(_e);H.push(...St),Te.push(...mr)}for(const St of Te)V.push(`${St}:${Ze}`)}const ne=await this.client.core.crypto.generateSharedKey(x,k.publicKey);let ee;H.length>0&&(ee={topic:ne,acknowledged:!0,self:{publicKey:x,metadata:this.client.metadata},peer:k,controller:k.publicKey,expiry:de(Sr),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:b,namespaces:Cc([...new Set(H)],[...new Set(V)]),transportType:o},await this.client.core.relayer.subscribe(ne,{transportType:o}),await this.client.session.set(ne,ee),b&&await this.client.core.pairing.updateMetadata({topic:b,metadata:k.metadata}),ee=this.client.session.get(ne)),(C=this.client.metadata.redirect)!=null&&C.linkMode&&(L=k.metadata.redirect)!=null&&L.linkMode&&(M=k.metadata.redirect)!=null&&M.universal&&i&&(this.client.core.addLinkModeSupportedApp(k.metadata.redirect.universal),this.client.session.update(ne,{transportType:ae.link_mode})),N({auths:F,session:ee})};this.events.once(P,m),this.events.once(y,S);let A;try{if(n){const O=Vt("wc_sessionAuthenticate",I,z);this.client.core.history.set(b,O);const C=await this.client.core.crypto.encode("",O,{type:Bi,encoding:Ft});A=Wi(i,b,C)}else await Promise.all([this.sendRequest({topic:b,method:"wc_sessionAuthenticate",params:I,expiry:t.expiry,throwOnFailedPublish:!0,clientRpcId:z}),this.sendRequest({topic:b,method:"wc_sessionPropose",params:D,expiry:ge.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:D.id})])}catch(O){throw this.events.off(P,m),this.events.off(y,S),O}return await this.setProposal(D.id,D),await this.setAuthRequest(z,{request:Re(se({},I),{verifyContext:{}}),pairingTopic:b,transportType:o}),{uri:A??E,response:j}}),R(this,"approveSessionAuthenticate",async t=>{const{id:i,auths:s}=t,n=this.client.core.eventClient.createEvent({properties:{topic:i.toString(),trace:[Qt.authenticated_session_approve_started]}});try{this.isInitialized()}catch(w){throw n.setError(hi.no_internet_connection),w}const o=this.getPendingAuthRequest(i);if(!o)throw n.setError(hi.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${i}`);const a=o.transportType||ae.relay;a===ae.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),h=ns(c),u={type:jt,receiverPublicKey:c,senderPublicKey:l},d=[],f=[];for(const w of s){if(!await sc({cacao:w,projectId:this.client.core.projectId})){n.setError(hi.invalid_cacao);const T=te("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:i,topic:h,error:T,encodeOpts:u}),new Error(T.message)}n.addTrace(Qt.cacaos_verified);const{p:_}=w,b=ss(_.resources),E=[Hn(_.iss)],x=fs(_.iss);if(b){const T=nc(b),v=oc(b);d.push(...T),E.push(...v)}for(const T of E)f.push(`${T}:${x}`)}const p=await this.client.core.crypto.generateSharedKey(l,c);n.addTrace(Qt.create_authenticated_session_topic);let g;if(d?.length>0){g={topic:p,acknowledged:!0,self:{publicKey:l,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:de(Sr),authentication:s,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:Cc([...new Set(d)],[...new Set(f)]),transportType:a},n.addTrace(Qt.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(p,{transportType:a})}catch(w){throw n.setError(hi.subscribe_authenticated_session_topic_failure),w}n.addTrace(Qt.subscribe_authenticated_session_topic_success),await this.client.session.set(p,g),n.addTrace(Qt.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}n.addTrace(Qt.publishing_authenticated_session_approve);try{await this.sendResult({topic:h,id:i,result:{cacaos:s,responder:{publicKey:l,metadata:this.client.metadata}},encodeOpts:u,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(w){throw n.setError(hi.authenticated_session_approve_publish_failure),w}return await this.client.auth.requests.delete(i,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:n.eventId}),{session:g}}),R(this,"rejectSessionAuthenticate",async t=>{this.isInitialized();const{id:i,reason:s}=t,n=this.getPendingAuthRequest(i);if(!n)throw new Error(`Could not find pending auth request with id ${i}`);n.transportType===ae.relay&&await this.confirmOnlineStateOrThrow();const o=n.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=ns(o),l={type:jt,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:i,topic:c,error:s,encodeOpts:l,rpcOpts:ge.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(n.requester.metadata,n.transportType)}),await this.client.auth.requests.delete(i,{message:"rejected",code:0}),await this.client.proposal.delete(i,te("USER_DISCONNECTED"))}),R(this,"formatAuthMessage",t=>{this.isInitialized();const{request:i,iss:s}=t;return hu(i,s)}),R(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const t=this.relayMessageCache.shift();t&&await this.onRelayMessage(t)}catch(t){this.client.logger.error(t)}},50)}),R(this,"cleanupDuplicatePairings",async t=>{if(t.pairingTopic)try{const i=this.client.core.pairing.pairings.get(t.pairingTopic),s=this.client.core.pairing.pairings.getAll().filter(n=>{var o,a;return((o=n.peerMetadata)==null?void 0:o.url)&&((a=n.peerMetadata)==null?void 0:a.url)===t.peer.metadata.url&&n.topic&&n.topic!==i.topic});if(s.length===0)return;this.client.logger.info(`Cleaning up ${s.length} duplicate pairing(s)`),await Promise.all(s.map(n=>this.client.core.pairing.disconnect({topic:n.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}}),R(this,"deleteSession",async t=>{var i;const{topic:s,expirerHasDeleted:n=!1,emitEvent:o=!0,id:a=0}=t,{self:c}=this.client.session.get(s);await this.client.core.relayer.unsubscribe(s),await this.client.session.delete(s,te("USER_DISCONNECTED")),this.addToRecentlyDeleted(s,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(s)&&await this.client.core.crypto.deleteSymKey(s),n||this.client.core.expirer.del(s),this.client.core.storage.removeItem(Ol).catch(l=>this.client.logger.warn(l)),this.getPendingSessionRequests().forEach(l=>{l.topic===s&&this.deletePendingSessionRequest(l.id,te("USER_DISCONNECTED"))}),s===((i=this.sessionRequestQueue.queue[0])==null?void 0:i.topic)&&(this.sessionRequestQueue.state=mt.idle),o&&this.client.events.emit("session_delete",{id:a,topic:s})}),R(this,"deleteProposal",async(t,i)=>{if(i)try{const s=this.client.proposal.get(t);this.client.core.eventClient.getEvent({topic:s.pairingTopic})?.setError(Zt.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(t,te("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(t)]),this.addToRecentlyDeleted(t,"proposal")}),R(this,"deletePendingSessionRequest",async(t,i,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,i),s?Promise.resolve():this.client.core.expirer.del(t)]),this.addToRecentlyDeleted(t,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(n=>n.id!==t),s&&(this.sessionRequestQueue.state=mt.idle,this.client.events.emit("session_request_expire",{id:t}))}),R(this,"deletePendingAuthRequest",async(t,i,s=!1)=>{await Promise.all([this.client.auth.requests.delete(t,i),s?Promise.resolve():this.client.core.expirer.del(t)])}),R(this,"setExpiry",async(t,i)=>{this.client.session.keys.includes(t)&&(this.client.core.expirer.set(t,i),await this.client.session.update(t,{expiry:i}))}),R(this,"setProposal",async(t,i)=>{this.client.core.expirer.set(t,de(ge.wc_sessionPropose.req.ttl)),await this.client.proposal.set(t,i)}),R(this,"setAuthRequest",async(t,i)=>{const{request:s,pairingTopic:n,transportType:o=ae.relay}=i;this.client.core.expirer.set(t,s.expiryTimestamp),await this.client.auth.requests.set(t,{authPayload:s.authPayload,requester:s.requester,expiryTimestamp:s.expiryTimestamp,id:t,pairingTopic:n,verifyContext:s.verifyContext,transportType:o})}),R(this,"setPendingSessionRequest",async t=>{const{id:i,topic:s,params:n,verifyContext:o}=t,a=n.request.expiryTimestamp||de(ge.wc_sessionRequest.req.ttl);this.client.core.expirer.set(i,a),await this.client.pendingRequest.set(i,{id:i,topic:s,params:n,verifyContext:o})}),R(this,"sendRequest",async t=>{const{topic:i,method:s,params:n,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:l,appLink:h,tvf:u}=t,d=Vt(s,n,c);let f;const p=!!h;try{const _=p?Ft:ut;f=await this.client.core.crypto.encode(i,d,{encoding:_})}catch(_){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${i} failed`),_}let g;if(zS.includes(s)){const _=Et(JSON.stringify(d)),b=Et(f);g=await this.client.core.verify.register({id:b,decryptedId:_})}const w=ge[s].req;if(w.attestation=g,o&&(w.ttl=o),a&&(w.id=a),this.client.core.history.set(i,d),p){const _=Wi(h,i,f);await globalThis.Linking.openURL(_,this.client.name)}else{const _=ge[s].req;o&&(_.ttl=o),a&&(_.id=a),_.tvf=Re(se({},u),{correlationId:d.id}),l?(_.internal=Re(se({},_.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,f,_)):this.client.core.relayer.publish(i,f,_).catch(b=>this.client.logger.error(b))}return d.id}),R(this,"sendResult",async t=>{const{id:i,topic:s,result:n,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=t,l=js(i,n);let h;const u=c&&typeof globalThis?.Linking<"u";try{const p=u?Ft:ut;h=await this.client.core.crypto.encode(s,l,Re(se({},a||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${s} failed`),p}let d,f;try{d=await this.client.core.history.get(s,i);const p=d.request;try{this.shouldSetTVF(p.method,p.params)&&(f=this.getTVFParams(i,p.params,n))}catch(g){this.client.logger.warn("sendResult() -> getTVFParams() failed",g)}}catch(p){throw this.client.logger.error(`sendResult() -> history.get(${s}, ${i}) failed`),p}if(u){const p=Wi(c,s,h);await globalThis.Linking.openURL(p,this.client.name)}else{const p=d.request.method,g=ge[p].res;g.tvf=Re(se({},f),{correlationId:i}),o?(g.internal=Re(se({},g.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,h,g)):this.client.core.relayer.publish(s,h,g).catch(w=>this.client.logger.error(w))}await this.client.core.history.resolve(l)}),R(this,"sendError",async t=>{const{id:i,topic:s,error:n,encodeOpts:o,rpcOpts:a,appLink:c}=t,l=Bs(i,n);let h;const u=c&&typeof globalThis?.Linking<"u";try{const f=u?Ft:ut;h=await this.client.core.crypto.encode(s,l,Re(se({},o||{}),{encoding:f}))}catch(f){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${s} failed`),f}let d;try{d=await this.client.core.history.get(s,i)}catch(f){throw this.client.logger.error(`sendError() -> history.get(${s}, ${i}) failed`),f}if(u){const f=Wi(c,s,h);await globalThis.Linking.openURL(f,this.client.name)}else{const f=d.request.method,p=a||ge[f].res;this.client.core.relayer.publish(s,h,p)}await this.client.core.history.resolve(l)}),R(this,"cleanup",async()=>{const t=[],i=[];this.client.session.getAll().forEach(s=>{let n=!1;zt(s.expiry)&&(n=!0),this.client.core.crypto.keychain.has(s.topic)||(n=!0),n&&t.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{zt(s.expiryTimestamp)&&i.push(s.id)}),await Promise.all([...t.map(s=>this.deleteSession({topic:s})),...i.map(s=>this.deleteProposal(s))])}),R(this,"onProviderMessageEvent",async t=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(t):await this.onRelayMessage(t)}),R(this,"onRelayEventRequest",async t=>{this.requestQueue.queue.push(t),await this.processRequestsQueue()}),R(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===mt.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=mt.active;const t=this.requestQueue.queue.shift();if(t)try{await this.processRequest(t)}catch(i){this.client.logger.warn(i)}}this.requestQueue.state=mt.idle}),R(this,"processRequest",async t=>{const{topic:i,payload:s,attestation:n,transportType:o,encryptedId:a}=t,c=s.method;if(!this.shouldIgnorePairingRequest({topic:i,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:i,payload:s,attestation:n,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(i,s);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(i,s);case"wc_sessionExtend":return await this.onSessionExtendRequest(i,s);case"wc_sessionPing":return await this.onSessionPingRequest(i,s);case"wc_sessionDelete":return await this.onSessionDeleteRequest(i,s);case"wc_sessionRequest":return await this.onSessionRequest({topic:i,payload:s,attestation:n,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(i,s);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:i,payload:s,attestation:n,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),R(this,"onRelayEventResponse",async t=>{const{topic:i,payload:s,transportType:n}=t,o=(await this.client.core.history.get(i,s.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(i,s,n);case"wc_sessionSettle":return this.onSessionSettleResponse(i,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,s);case"wc_sessionExtend":return this.onSessionExtendResponse(i,s);case"wc_sessionPing":return this.onSessionPingResponse(i,s);case"wc_sessionRequest":return this.onSessionRequestResponse(i,s);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(i,s);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),R(this,"onRelayEventUnknownPayload",t=>{const{topic:i}=t,{message:s}=q("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(s)}),R(this,"shouldIgnorePairingRequest",t=>{const{topic:i,requestMethod:s}=t,n=this.expectedPairingMethodMap.get(i);return!n||n.includes(s)?!1:!!(n.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),R(this,"onSessionProposeRequest",async t=>{const{topic:i,payload:s,attestation:n,encryptedId:o}=t,{params:a,id:c}=s;try{const l=this.client.core.eventClient.getEvent({topic:i});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),l?.setError(Ct.proposal_listener_not_found)),this.isValidConnect(se({},s.params));const h=a.expiryTimestamp||de(ge.wc_sessionPropose.req.ttl),u=se({id:c,pairingTopic:i,expiryTimestamp:h},a);await this.setProposal(c,u);const d=await this.getVerifyContext({attestationId:n,hash:Et(JSON.stringify(s)),encryptedId:o,metadata:u.proposer.metadata});l?.addTrace(wt.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:u,verifyContext:d})}catch(l){await this.sendError({id:c,topic:i,error:l,rpcOpts:ge.wc_sessionPropose.autoReject}),this.client.logger.error(l)}}),R(this,"onSessionProposeResponse",async(t,i,s)=>{const{id:n}=i;if(vt(i)){const{result:o}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const l=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});const h=await this.client.core.crypto.generateSharedKey(c,l);this.pendingSessions.set(n,{sessionTopic:h,pairingTopic:t,proposalId:n,publicKey:c});const u=await this.client.core.relayer.subscribe(h,{transportType:s});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:u}),await this.client.core.pairing.activate({topic:t})}else if(tt(i)){await this.client.proposal.delete(n,te("USER_DISCONNECTED"));const o=X("session_connect",n);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:i.error})}}),R(this,"onSessionSettleRequest",async(t,i)=>{const{id:s,params:n}=i;try{this.isValidSessionSettleRequest(n);const{relay:o,controller:a,expiry:c,namespaces:l,sessionProperties:h,scopedProperties:u,sessionConfig:d}=i.params,f=[...this.pendingSessions.values()].find(w=>w.sessionTopic===t);if(!f)return this.client.logger.error(`Pending session not found for topic ${t}`);const p=this.client.proposal.get(f.proposalId),g=Re(se(se(se({topic:t,relay:o,expiry:c,namespaces:l,acknowledged:!0,pairingTopic:f.pairingTopic,requiredNamespaces:p.requiredNamespaces,optionalNamespaces:p.optionalNamespaces,controller:a.publicKey,self:{publicKey:f.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},h&&{sessionProperties:h}),u&&{scopedProperties:u}),d&&{sessionConfig:d}),{transportType:ae.relay});await this.client.session.set(g.topic,g),await this.setExpiry(g.topic,g.expiry),await this.client.core.pairing.updateMetadata({topic:f.pairingTopic,metadata:g.peer.metadata}),this.client.events.emit("session_connect",{session:g}),this.events.emit(X("session_connect",f.proposalId),{session:g}),this.pendingSessions.delete(f.proposalId),this.deleteProposal(f.proposalId,!1),this.cleanupDuplicatePairings(g),await this.sendResult({id:i.id,topic:t,result:!0,throwOnFailedPublish:!0})}catch(o){await this.sendError({id:s,topic:t,error:o}),this.client.logger.error(o)}}),R(this,"onSessionSettleResponse",async(t,i)=>{const{id:s}=i;vt(i)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit(X("session_approve",s),{})):tt(i)&&(await this.client.session.delete(t,te("USER_DISCONNECTED")),this.events.emit(X("session_approve",s),{error:i.error}))}),R(this,"onSessionUpdateRequest",async(t,i)=>{const{params:s,id:n}=i;try{const o=`${t}_session_update`,a=ci.get(o);if(a&&this.isRequestOutOfSync(a,n)){this.client.logger.warn(`Discarding out of sync request - ${n}`),this.sendError({id:n,topic:t,error:te("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(se({topic:t},s));try{ci.set(o,n),await this.client.session.update(t,{namespaces:s.namespaces}),await this.sendResult({id:n,topic:t,result:!0,throwOnFailedPublish:!0})}catch(c){throw ci.delete(o),c}this.client.events.emit("session_update",{id:n,topic:t,params:s})}catch(o){await this.sendError({id:n,topic:t,error:o}),this.client.logger.error(o)}}),R(this,"isRequestOutOfSync",(t,i)=>i.toString().slice(0,-3)<t.toString().slice(0,-3)),R(this,"onSessionUpdateResponse",(t,i)=>{const{id:s}=i,n=X("session_update",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);vt(i)?this.events.emit(X("session_update",s),{}):tt(i)&&this.events.emit(X("session_update",s),{error:i.error})}),R(this,"onSessionExtendRequest",async(t,i)=>{const{id:s}=i;try{this.isValidExtend({topic:t}),await this.setExpiry(t,de(Sr)),await this.sendResult({id:s,topic:t,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:s,topic:t})}catch(n){await this.sendError({id:s,topic:t,error:n}),this.client.logger.error(n)}}),R(this,"onSessionExtendResponse",(t,i)=>{const{id:s}=i,n=X("session_extend",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);vt(i)?this.events.emit(X("session_extend",s),{}):tt(i)&&this.events.emit(X("session_extend",s),{error:i.error})}),R(this,"onSessionPingRequest",async(t,i)=>{const{id:s}=i;try{this.isValidPing({topic:t}),await this.sendResult({id:s,topic:t,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:s,topic:t})}catch(n){await this.sendError({id:s,topic:t,error:n}),this.client.logger.error(n)}}),R(this,"onSessionPingResponse",(t,i)=>{const{id:s}=i,n=X("session_ping",s);setTimeout(()=>{if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners 2176`);vt(i)?this.events.emit(X("session_ping",s),{}):tt(i)&&this.events.emit(X("session_ping",s),{error:i.error})},500)}),R(this,"onSessionDeleteRequest",async(t,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:t,reason:i.params}),Promise.all([new Promise(n=>{this.client.core.relayer.once(we.publish,async()=>{n(await this.deleteSession({topic:t,id:s}))})}),this.sendResult({id:s,topic:t,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:t,error:te("USER_DISCONNECTED")})]).catch(n=>this.client.logger.error(n))}catch(n){this.client.logger.error(n)}}),R(this,"onSessionRequest",async t=>{var i,s,n;const{topic:o,payload:a,attestation:c,encryptedId:l,transportType:h}=t,{id:u,params:d}=a;try{await this.isValidRequest(se({topic:o},d));const f=this.client.session.get(o),p=await this.getVerifyContext({attestationId:c,hash:Et(JSON.stringify(Vt("wc_sessionRequest",d,u))),encryptedId:l,metadata:f.peer.metadata,transportType:h}),g={id:u,topic:o,params:d,verifyContext:p};await this.setPendingSessionRequest(g),h===ae.link_mode&&(i=f.peer.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp((s=f.peer.metadata.redirect)==null?void 0:s.universal),(n=this.client.signConfig)!=null&&n.disableRequestQueue?this.emitSessionRequest(g):(this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue())}catch(f){await this.sendError({id:u,topic:o,error:f}),this.client.logger.error(f)}}),R(this,"onSessionRequestResponse",(t,i)=>{const{id:s}=i,n=X("session_request",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);vt(i)?this.events.emit(X("session_request",s),{result:i.result}):tt(i)&&this.events.emit(X("session_request",s),{error:i.error})}),R(this,"onSessionEventRequest",async(t,i)=>{const{id:s,params:n}=i;try{const o=`${t}_session_event_${n.event.name}`,a=ci.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.info(`Discarding out of sync request - ${s}`);return}this.isValidEmit(se({topic:t},n)),this.client.events.emit("session_event",{id:s,topic:t,params:n}),ci.set(o,s)}catch(o){await this.sendError({id:s,topic:t,error:o}),this.client.logger.error(o)}}),R(this,"onSessionAuthenticateResponse",(t,i)=>{const{id:s}=i;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:t,payload:i}),vt(i)?this.events.emit(X("session_request",s),{result:i.result}):tt(i)&&this.events.emit(X("session_request",s),{error:i.error})}),R(this,"onSessionAuthenticateRequest",async t=>{var i;const{topic:s,payload:n,attestation:o,encryptedId:a,transportType:c}=t;try{const{requester:l,authPayload:h,expiryTimestamp:u}=n.params,d=await this.getVerifyContext({attestationId:o,hash:Et(JSON.stringify(n)),encryptedId:a,metadata:l.metadata,transportType:c}),f={requester:l,pairingTopic:s,id:n.id,authPayload:h,verifyContext:d,expiryTimestamp:u};await this.setAuthRequest(n.id,{request:f,pairingTopic:s,transportType:c}),c===ae.link_mode&&(i=l.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp(l.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:s,params:n.params,id:n.id,verifyContext:d})}catch(l){this.client.logger.error(l);const h=n.params.requester.publicKey,u=await this.client.core.crypto.generateKeyPair(),d=this.getAppLinkIfEnabled(n.params.requester.metadata,c),f={type:jt,receiverPublicKey:h,senderPublicKey:u};await this.sendError({id:n.id,topic:s,error:l,encodeOpts:f,rpcOpts:ge.wc_sessionAuthenticate.autoReject,appLink:d})}}),R(this,"addSessionRequestToSessionRequestQueue",t=>{this.sessionRequestQueue.queue.push(t)}),R(this,"cleanupAfterResponse",t=>{this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=mt.idle,this.processSessionRequestQueue()},U.toMiliseconds(this.requestQueueDelay))}),R(this,"cleanupPendingSentRequestsForTopic",({topic:t,error:i})=>{const s=this.client.core.history.pending;s.length>0&&s.filter(n=>n.topic===t&&n.request.method==="wc_sessionRequest").forEach(n=>{const o=n.request.id,a=X("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(X("session_request",n.request.id),{error:i})})}),R(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===mt.active){this.client.logger.info("session request queue is already active.");return}const t=this.sessionRequestQueue.queue[0];if(!t){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=mt.active,this.emitSessionRequest(t)}catch(i){this.client.logger.error(i)}}),R(this,"emitSessionRequest",t=>{this.client.events.emit("session_request",t)}),R(this,"onPairingCreated",t=>{if(t.methods&&this.expectedPairingMethodMap.set(t.topic,t.methods),t.active)return;const i=this.client.proposal.getAll().find(s=>s.pairingTopic===t.topic);i&&this.onSessionProposeRequest({topic:t.topic,payload:Vt("wc_sessionPropose",Re(se({},i),{requiredNamespaces:i.requiredNamespaces,optionalNamespaces:i.optionalNamespaces,relays:i.relays,proposer:i.proposer,sessionProperties:i.sessionProperties,scopedProperties:i.scopedProperties}),i.id)})}),R(this,"isValidConnect",async t=>{if(!Le(t)){const{message:l}=q("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(l)}const{pairingTopic:i,requiredNamespaces:s,optionalNamespaces:n,sessionProperties:o,scopedProperties:a,relays:c}=t;if(Oe(i)||await this.isValidPairingTopic(i),!R0(c)){const{message:l}=q("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(l)}if(!Oe(s)&&Wt(s)!==0){const l="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(l):this.client.logger.warn(l),this.validateNamespaces(s,"requiredNamespaces")}if(!Oe(n)&&Wt(n)!==0&&this.validateNamespaces(n,"optionalNamespaces"),Oe(o)||this.validateSessionProps(o,"sessionProperties"),!Oe(a)){this.validateSessionProps(a,"scopedProperties");const l=Object.keys(s||{}).concat(Object.keys(n||{}));if(!Object.keys(a).every(h=>l.includes(h)))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(l)}`)}}),R(this,"validateNamespaces",(t,i)=>{const s=T0(t,"connect()",i);if(s)throw new Error(s.message)}),R(this,"isValidApprove",async t=>{if(!Le(t))throw new Error(q("MISSING_OR_INVALID",`approve() params: ${t}`).message);const{id:i,namespaces:s,relayProtocol:n,sessionProperties:o,scopedProperties:a}=t;this.checkRecentlyDeleted(i),await this.isValidProposalId(i);const c=this.client.proposal.get(i),l=gn(s,"approve()");if(l)throw new Error(l.message);const h=Nc(c.requiredNamespaces,s,"approve()");if(h)throw new Error(h.message);if(!ue(n,!0)){const{message:u}=q("MISSING_OR_INVALID",`approve() relayProtocol: ${n}`);throw new Error(u)}if(Oe(o)||this.validateSessionProps(o,"sessionProperties"),!Oe(a)){this.validateSessionProps(a,"scopedProperties");const u=new Set(Object.keys(s));if(!Object.keys(a).every(d=>u.has(d)))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(u).join(", ")}`)}}),R(this,"isValidReject",async t=>{if(!Le(t)){const{message:n}=q("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(n)}const{id:i,reason:s}=t;if(this.checkRecentlyDeleted(i),await this.isValidProposalId(i),!j0(s)){const{message:n}=q("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(n)}}),R(this,"isValidSessionSettleRequest",t=>{if(!Le(t)){const{message:l}=q("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(l)}const{relay:i,controller:s,namespaces:n,expiry:o}=t;if(!Bu(i)){const{message:l}=q("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const a=O0(s,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=gn(n,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(zt(o)){const{message:l}=q("EXPIRED","onSessionSettleRequest()");throw new Error(l)}}),R(this,"isValidUpdate",async t=>{if(!Le(t)){const{message:c}=q("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(c)}const{topic:i,namespaces:s}=t;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const n=this.client.session.get(i),o=gn(s,"update()");if(o)throw new Error(o.message);const a=Nc(n.requiredNamespaces,s,"update()");if(a)throw new Error(a.message)}),R(this,"isValidExtend",async t=>{if(!Le(t)){const{message:s}=q("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(s)}const{topic:i}=t;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i)}),R(this,"isValidRequest",async t=>{if(!Le(t)){const{message:c}=q("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(c)}const{topic:i,request:s,chainId:n,expiry:o}=t;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const{namespaces:a}=this.client.session.get(i);if(!Rc(a,n)){const{message:c}=q("MISSING_OR_INVALID",`request() chainId: ${n}`);throw new Error(c)}if(!B0(s)){const{message:c}=q("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(c)}if(!L0(a,n,s.method)){const{message:c}=q("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(c)}if(o&&!F0(o,On)){const{message:c}=q("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${On.min} and ${On.max}`);throw new Error(c)}}),R(this,"isValidRespond",async t=>{var i;if(!Le(t)){const{message:o}=q("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(o)}const{topic:s,response:n}=t;try{await this.isValidSessionTopic(s)}catch(o){throw(i=t?.response)!=null&&i.id&&this.cleanupAfterResponse(t),o}if(!U0(n)){const{message:o}=q("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(o)}}),R(this,"isValidPing",async t=>{if(!Le(t)){const{message:s}=q("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(s)}const{topic:i}=t;await this.isValidSessionOrPairingTopic(i)}),R(this,"isValidEmit",async t=>{if(!Le(t)){const{message:a}=q("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(a)}const{topic:i,event:s,chainId:n}=t;await this.isValidSessionTopic(i);const{namespaces:o}=this.client.session.get(i);if(!Rc(o,n)){const{message:a}=q("MISSING_OR_INVALID",`emit() chainId: ${n}`);throw new Error(a)}if(!q0(s)){const{message:a}=q("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}if(!k0(o,n,s.name)){const{message:a}=q("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}}),R(this,"isValidDisconnect",async t=>{if(!Le(t)){const{message:s}=q("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(s)}const{topic:i}=t;await this.isValidSessionOrPairingTopic(i)}),R(this,"isValidAuthenticate",t=>{const{chains:i,uri:s,domain:n,nonce:o}=t;if(!Array.isArray(i)||i.length===0)throw new Error("chains is required and must be a non-empty array");if(!ue(s,!1))throw new Error("uri is required parameter");if(!ue(n,!1))throw new Error("domain is required parameter");if(!ue(o,!1))throw new Error("nonce is required parameter");if([...new Set(i.map(c=>Mr(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=Mr(i[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),R(this,"getVerifyContext",async t=>{const{attestationId:i,hash:s,encryptedId:n,metadata:o,transportType:a}=t,c={verified:{verifyUrl:o.verifyUrl||bi,validation:"UNKNOWN",origin:o.url||""}};try{if(a===ae.link_mode){const h=this.getAppLinkIfEnabled(o,a);return c.verified.validation=h&&new URL(h).origin===new URL(o.url).origin?"VALID":"INVALID",c}const l=await this.client.core.verify.resolve({attestationId:i,hash:s,encryptedId:n,verifyUrl:o.verifyUrl});l&&(c.verified.origin=l.origin,c.verified.isScam=l.isScam,c.verified.validation=l.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.warn(l)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),R(this,"validateSessionProps",(t,i)=>{Object.values(t).forEach((s,n)=>{if(s==null){const{message:o}=q("MISSING_OR_INVALID",`${i} must contain an existing value for each key. Received: ${s} for key ${Object.keys(t)[n]}`);throw new Error(o)}})}),R(this,"getPendingAuthRequest",t=>{const i=this.client.auth.requests.get(t);return typeof i=="object"?i:void 0}),R(this,"addToRecentlyDeleted",(t,i)=>{if(this.recentlyDeletedMap.set(t,i),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let s=0;const n=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(s++>=n)break;this.recentlyDeletedMap.delete(o)}}}),R(this,"checkRecentlyDeleted",t=>{const i=this.recentlyDeletedMap.get(t);if(i){const{message:s}=q("MISSING_OR_INVALID",`Record was recently deleted - ${i}: ${t}`);throw new Error(s)}}),R(this,"isLinkModeEnabled",(t,i)=>{var s,n,o,a,c,l,h,u,d;return!t||i!==ae.link_mode?!1:((n=(s=this.client.metadata)==null?void 0:s.redirect)==null?void 0:n.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((l=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:l.universal)!==""&&((h=t?.redirect)==null?void 0:h.universal)!==void 0&&((u=t?.redirect)==null?void 0:u.universal)!==""&&((d=t?.redirect)==null?void 0:d.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(t.redirect.universal)&&typeof globalThis?.Linking<"u"}),R(this,"getAppLinkIfEnabled",(t,i)=>{var s;return this.isLinkModeEnabled(t,i)?(s=t?.redirect)==null?void 0:s.universal:void 0}),R(this,"handleLinkModeMessage",({url:t})=>{if(!t||!t.includes("wc_ev")||!t.includes("topic"))return;const i=Ya(t,"topic")||"",s=decodeURIComponent(Ya(t,"wc_ev")||""),n=this.client.session.keys.includes(i);n&&this.client.session.update(i,{transportType:ae.link_mode}),this.client.core.dispatchEnvelope({topic:i,message:s,sessionExists:n})}),R(this,"registerLinkModeListeners",async()=>{var t;if(Co()||Gt()&&(t=this.client.metadata.redirect)!=null&&t.linkMode){const i=globalThis?.Linking;if(typeof i<"u"){i.addEventListener("url",this.handleLinkModeMessage,this.client.name);const s=await i.getInitialURL();s&&setTimeout(()=>{this.handleLinkModeMessage({url:s})},50)}}}),R(this,"shouldSetTVF",(t,i)=>{if(!i||t!=="wc_sessionRequest")return!1;const{request:s}=i;return Object.keys(Pl).includes(s.method)}),R(this,"getTVFParams",(t,i,s)=>{var n,o;try{const a=i.request.method,c=this.extractTxHashesFromResult(a,s);return Re(se({correlationId:t,rpcMethods:[a],chainId:i.chainId},this.isValidContractData(i.request.params)&&{contractAddresses:[(o=(n=i.request.params)==null?void 0:n[0])==null?void 0:o.to]}),{txHashes:c})}catch(a){this.client.logger.warn("Error getting TVF params",a)}return{}}),R(this,"isValidContractData",t=>{var i;if(!t)return!1;try{const s=t?.data||((i=t?.[0])==null?void 0:i.data);if(!s.startsWith("0x"))return!1;const n=s.slice(2);return/^[0-9a-fA-F]*$/.test(n)?n.length%2===0:!1}catch{}return!1}),R(this,"extractTxHashesFromResult",(t,i)=>{try{const s=Pl[t];if(typeof i=="string")return[i];const n=i[s.key];if(dt(n))return t==="solana_signAllTransactions"?n.map(o=>lb(o)):n;if(typeof n=="string")return[n]}catch(s){this.client.logger.warn("Error extracting tx hashes from result",s)}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,t=this.client.core.relayer.messages.getWithoutAck(e);for(const[i,s]of Object.entries(t))for(const n of s)try{await this.onProviderMessageEvent({topic:i,message:n,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${i}, message: ${n}`)}}catch(e){this.client.logger.warn("processPendingMessageEvents failed",e)}}isInitialized(){if(!this.initialized){const{message:e}=q("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(we.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:t,message:i,attestation:s,transportType:n}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(ls)?this.client.auth.authKeys.get(ls):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(t,i,{receiverPublicKey:o,encoding:n===ae.link_mode?Ft:ut});Mo(a)?(this.client.core.history.set(t,a),await this.onRelayEventRequest({topic:t,payload:a,attestation:s,transportType:n,encryptedId:Et(i)})):Us(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:t,payload:a,transportType:n}),this.client.core.history.delete(t,a.id)):await this.onRelayEventUnknownPayload({topic:t,payload:a,transportType:n}),await this.client.core.relayer.messages.ack(t,i)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(et.expired,async e=>{const{topic:t,id:i}=tu(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,q("EXPIRED"),!0);if(i&&this.client.auth.requests.keys.includes(i))return await this.deletePendingAuthRequest(i,q("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession({topic:t,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:t})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}registerPairingEvents(){this.client.core.pairing.events.on(ir.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(ir.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!ue(e,!1)){const{message:t}=q("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:t}=q("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(zt(this.client.core.pairing.pairings.get(e).expiry)){const{message:t}=q("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}async isValidSessionTopic(e){if(!ue(e,!1)){const{message:t}=q("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(t)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:t}=q("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(t)}if(zt(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:t}=q("EXPIRED",`session topic: ${e}`);throw new Error(t)}if(!this.client.core.crypto.keychain.has(e)){const{message:t}=q("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(t)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(ue(e,!1)){const{message:t}=q("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(t)}else{const{message:t}=q("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(t)}}async isValidProposalId(e){if(!N0(e)){const{message:t}=q("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(t)}if(!this.client.proposal.keys.includes(e)){const{message:t}=q("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(t)}if(zt(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:t}=q("EXPIRED",`proposal id: ${e}`);throw new Error(t)}}}class eD extends gr{constructor(e,t){super(e,t,qS,zo),this.core=e,this.logger=t}}let tD=class extends gr{constructor(e,t){super(e,t,LS,zo),this.core=e,this.logger=t}};class rD extends gr{constructor(e,t){super(e,t,MS,zo,i=>i.id),this.core=e,this.logger=t}}class iD extends gr{constructor(e,t){super(e,t,VS,Ls,()=>ls),this.core=e,this.logger=t}}class sD extends gr{constructor(e,t){super(e,t,KS,Ls),this.core=e,this.logger=t}}class nD extends gr{constructor(e,t){super(e,t,WS,Ls,i=>i.id),this.core=e,this.logger=t}}var oD=Object.defineProperty,aD=(r,e,t)=>e in r?oD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,$n=(r,e,t)=>aD(r,typeof e!="symbol"?e+"":e,t);class cD{constructor(e,t){this.core=e,this.logger=t,$n(this,"authKeys"),$n(this,"pairingTopics"),$n(this,"requests"),this.authKeys=new iD(this.core,this.logger),this.pairingTopics=new sD(this.core,this.logger),this.requests=new nD(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var lD=Object.defineProperty,hD=(r,e,t)=>e in r?lD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,G=(r,e,t)=>hD(r,typeof e!="symbol"?e+"":e,t);let uD=class hd extends l_{constructor(e){super(e),G(this,"protocol",ad),G(this,"version",cd),G(this,"name",Dn.name),G(this,"metadata"),G(this,"core"),G(this,"logger"),G(this,"events",new Je.EventEmitter),G(this,"engine"),G(this,"session"),G(this,"proposal"),G(this,"pendingRequest"),G(this,"auth"),G(this,"signConfig"),G(this,"on",(i,s)=>this.events.on(i,s)),G(this,"once",(i,s)=>this.events.once(i,s)),G(this,"off",(i,s)=>this.events.off(i,s)),G(this,"removeListener",(i,s)=>this.events.removeListener(i,s)),G(this,"removeAllListeners",i=>this.events.removeAllListeners(i)),G(this,"connect",async i=>{try{return await this.engine.connect(i)}catch(s){throw this.logger.error(s.message),s}}),G(this,"pair",async i=>{try{return await this.engine.pair(i)}catch(s){throw this.logger.error(s.message),s}}),G(this,"approve",async i=>{try{return await this.engine.approve(i)}catch(s){throw this.logger.error(s.message),s}}),G(this,"reject",async i=>{try{return await this.engine.reject(i)}catch(s){throw this.logger.error(s.message),s}}),G(this,"update",async i=>{try{return await this.engine.update(i)}catch(s){throw this.logger.error(s.message),s}}),G(this,"extend",async i=>{try{return await this.engine.extend(i)}catch(s){throw this.logger.error(s.message),s}}),G(this,"request",async i=>{try{return await this.engine.request(i)}catch(s){throw this.logger.error(s.message),s}}),G(this,"respond",async i=>{try{return await this.engine.respond(i)}catch(s){throw this.logger.error(s.message),s}}),G(this,"ping",async i=>{try{return await this.engine.ping(i)}catch(s){throw this.logger.error(s.message),s}}),G(this,"emit",async i=>{try{return await this.engine.emit(i)}catch(s){throw this.logger.error(s.message),s}}),G(this,"disconnect",async i=>{try{return await this.engine.disconnect(i)}catch(s){throw this.logger.error(s.message),s}}),G(this,"find",i=>{try{return this.engine.find(i)}catch(s){throw this.logger.error(s.message),s}}),G(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}}),G(this,"authenticate",async(i,s)=>{try{return await this.engine.authenticate(i,s)}catch(n){throw this.logger.error(n.message),n}}),G(this,"formatAuthMessage",i=>{try{return this.engine.formatAuthMessage(i)}catch(s){throw this.logger.error(s.message),s}}),G(this,"approveSessionAuthenticate",async i=>{try{return await this.engine.approveSessionAuthenticate(i)}catch(s){throw this.logger.error(s.message),s}}),G(this,"rejectSessionAuthenticate",async i=>{try{return await this.engine.rejectSessionAuthenticate(i)}catch(s){throw this.logger.error(s.message),s}}),this.name=e?.name||Dn.name,this.metadata=_w(e?.metadata),this.signConfig=e?.signConfig;const t=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:Ui(Ns({level:e?.logger||Dn.logger}));this.core=e?.core||new US(e),this.logger=je(t,this.name),this.session=new tD(this.core,this.logger),this.proposal=new eD(this.core,this.logger),this.pendingRequest=new rD(this.core,this.logger),this.engine=new XS(this),this.auth=new cD(this.core,this.logger)}static async init(e){const t=new hd(e);return await t.initialize(),t}get context(){return ze(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success"),setTimeout(()=>{this.engine.processRelayMessageCache()},U.toMiliseconds(U.ONE_SECOND))}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};var Zi={exports:{}},Al;function dD(){return Al||(Al=1,(function(r,e){var t=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof globalThis<"u"&&globalThis,i=(function(){function n(){this.fetch=!1,this.DOMException=t.DOMException}return n.prototype=t,new n})();(function(n){(function(o){var a=typeof n<"u"&&n||typeof self<"u"&&self||typeof n<"u"&&n||{},c={searchParams:"URLSearchParams"in a,iterable:"Symbol"in a&&"iterator"in Symbol,blob:"FileReader"in a&&"Blob"in a&&(function(){try{return new Blob,!0}catch{return!1}})(),formData:"FormData"in a,arrayBuffer:"ArrayBuffer"in a};function l(y){return y&&DataView.prototype.isPrototypeOf(y)}if(c.arrayBuffer)var h=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],u=ArrayBuffer.isView||function(y){return y&&h.indexOf(Object.prototype.toString.call(y))>-1};function d(y){if(typeof y!="string"&&(y=String(y)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(y)||y==="")throw new TypeError('Invalid character in header field name: "'+y+'"');return y.toLowerCase()}function f(y){return typeof y!="string"&&(y=String(y)),y}function p(y){var m={next:function(){var S=y.shift();return{done:S===void 0,value:S}}};return c.iterable&&(m[Symbol.iterator]=function(){return m}),m}function g(y){this.map={},y instanceof g?y.forEach(function(m,S){this.append(S,m)},this):Array.isArray(y)?y.forEach(function(m){if(m.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+m.length);this.append(m[0],m[1])},this):y&&Object.getOwnPropertyNames(y).forEach(function(m){this.append(m,y[m])},this)}g.prototype.append=function(y,m){y=d(y),m=f(m);var S=this.map[y];this.map[y]=S?S+", "+m:m},g.prototype.delete=function(y){delete this.map[d(y)]},g.prototype.get=function(y){return y=d(y),this.has(y)?this.map[y]:null},g.prototype.has=function(y){return this.map.hasOwnProperty(d(y))},g.prototype.set=function(y,m){this.map[d(y)]=f(m)},g.prototype.forEach=function(y,m){for(var S in this.map)this.map.hasOwnProperty(S)&&y.call(m,this.map[S],S,this)},g.prototype.keys=function(){var y=[];return this.forEach(function(m,S){y.push(S)}),p(y)},g.prototype.values=function(){var y=[];return this.forEach(function(m){y.push(m)}),p(y)},g.prototype.entries=function(){var y=[];return this.forEach(function(m,S){y.push([S,m])}),p(y)},c.iterable&&(g.prototype[Symbol.iterator]=g.prototype.entries);function w(y){if(!y._noBody){if(y.bodyUsed)return Promise.reject(new TypeError("Already read"));y.bodyUsed=!0}}function _(y){return new Promise(function(m,S){y.onload=function(){m(y.result)},y.onerror=function(){S(y.error)}})}function b(y){var m=new FileReader,S=_(m);return m.readAsArrayBuffer(y),S}function E(y){var m=new FileReader,S=_(m),A=/charset=([A-Za-z0-9_-]+)/.exec(y.type),O=A?A[1]:"utf-8";return m.readAsText(y,O),S}function x(y){for(var m=new Uint8Array(y),S=new Array(m.length),A=0;A<m.length;A++)S[A]=String.fromCharCode(m[A]);return S.join("")}function T(y){if(y.slice)return y.slice(0);var m=new Uint8Array(y.byteLength);return m.set(new Uint8Array(y)),m.buffer}function v(){return this.bodyUsed=!1,this._initBody=function(y){this.bodyUsed=this.bodyUsed,this._bodyInit=y,y?typeof y=="string"?this._bodyText=y:c.blob&&Blob.prototype.isPrototypeOf(y)?this._bodyBlob=y:c.formData&&FormData.prototype.isPrototypeOf(y)?this._bodyFormData=y:c.searchParams&&URLSearchParams.prototype.isPrototypeOf(y)?this._bodyText=y.toString():c.arrayBuffer&&c.blob&&l(y)?(this._bodyArrayBuffer=T(y.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):c.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(y)||u(y))?this._bodyArrayBuffer=T(y):this._bodyText=y=Object.prototype.toString.call(y):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof y=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):c.searchParams&&URLSearchParams.prototype.isPrototypeOf(y)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},c.blob&&(this.blob=function(){var y=w(this);if(y)return y;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var y=w(this);return y||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(c.blob)return this.blob().then(b);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var y=w(this);if(y)return y;if(this._bodyBlob)return E(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(x(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},c.formData&&(this.formData=function(){return this.text().then(j)}),this.json=function(){return this.text().then(JSON.parse)},this}var I=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function $(y){var m=y.toUpperCase();return I.indexOf(m)>-1?m:y}function D(y,m){if(!(this instanceof D))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');m=m||{};var S=m.body;if(y instanceof D){if(y.bodyUsed)throw new TypeError("Already read");this.url=y.url,this.credentials=y.credentials,m.headers||(this.headers=new g(y.headers)),this.method=y.method,this.mode=y.mode,this.signal=y.signal,!S&&y._bodyInit!=null&&(S=y._bodyInit,y.bodyUsed=!0)}else this.url=String(y);if(this.credentials=m.credentials||this.credentials||"same-origin",(m.headers||!this.headers)&&(this.headers=new g(m.headers)),this.method=$(m.method||this.method||"GET"),this.mode=m.mode||this.mode||null,this.signal=m.signal||this.signal||(function(){if("AbortController"in a){var C=new AbortController;return C.signal}})(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&S)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(S),(this.method==="GET"||this.method==="HEAD")&&(m.cache==="no-store"||m.cache==="no-cache")){var A=/([?&])_=[^&]*/;if(A.test(this.url))this.url=this.url.replace(A,"$1_="+new Date().getTime());else{var O=/\?/;this.url+=(O.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}D.prototype.clone=function(){return new D(this,{body:this._bodyInit})};function j(y){var m=new FormData;return y.trim().split("&").forEach(function(S){if(S){var A=S.split("="),O=A.shift().replace(/\+/g," "),C=A.join("=").replace(/\+/g," ");m.append(decodeURIComponent(O),decodeURIComponent(C))}}),m}function N(y){var m=new g,S=y.replace(/\r?\n[\t ]+/g," ");return S.split("\r").map(function(A){return A.indexOf(`
`)===0?A.substr(1,A.length):A}).forEach(function(A){var O=A.split(":"),C=O.shift().trim();if(C){var L=O.join(":").trim();try{m.append(C,L)}catch(M){console.warn("Response "+M.message)}}}),m}v.call(D.prototype);function B(y,m){if(!(this instanceof B))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(m||(m={}),this.type="default",this.status=m.status===void 0?200:m.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=m.statusText===void 0?"":""+m.statusText,this.headers=new g(m.headers),this.url=m.url||"",this._initBody(y)}v.call(B.prototype),B.prototype.clone=function(){return new B(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new g(this.headers),url:this.url})},B.error=function(){var y=new B(null,{status:200,statusText:""});return y.ok=!1,y.status=0,y.type="error",y};var z=[301,302,303,307,308];B.redirect=function(y,m){if(z.indexOf(m)===-1)throw new RangeError("Invalid status code");return new B(null,{status:m,headers:{location:y}})},o.DOMException=a.DOMException;try{new o.DOMException}catch{o.DOMException=function(m,S){this.message=m,this.name=S;var A=Error(m);this.stack=A.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function P(y,m){return new Promise(function(S,A){var O=new D(y,m);if(O.signal&&O.signal.aborted)return A(new o.DOMException("Aborted","AbortError"));var C=new XMLHttpRequest;function L(){C.abort()}C.onload=function(){var k={statusText:C.statusText,headers:N(C.getAllResponseHeaders()||"")};O.url.indexOf("file://")===0&&(C.status<200||C.status>599)?k.status=200:k.status=C.status,k.url="responseURL"in C?C.responseURL:k.headers.get("X-Request-URL");var H="response"in C?C.response:C.responseText;setTimeout(function(){S(new B(H,k))},0)},C.onerror=function(){setTimeout(function(){A(new TypeError("Network request failed"))},0)},C.ontimeout=function(){setTimeout(function(){A(new TypeError("Network request timed out"))},0)},C.onabort=function(){setTimeout(function(){A(new o.DOMException("Aborted","AbortError"))},0)};function M(k){try{return k===""&&a.location.href?a.location.href:k}catch{return k}}if(C.open(O.method,M(O.url),!0),O.credentials==="include"?C.withCredentials=!0:O.credentials==="omit"&&(C.withCredentials=!1),"responseType"in C&&(c.blob?C.responseType="blob":c.arrayBuffer&&(C.responseType="arraybuffer")),m&&typeof m.headers=="object"&&!(m.headers instanceof g||a.Headers&&m.headers instanceof a.Headers)){var F=[];Object.getOwnPropertyNames(m.headers).forEach(function(k){F.push(d(k)),C.setRequestHeader(k,f(m.headers[k]))}),O.headers.forEach(function(k,H){F.indexOf(H)===-1&&C.setRequestHeader(H,k)})}else O.headers.forEach(function(k,H){C.setRequestHeader(H,k)});O.signal&&(O.signal.addEventListener("abort",L),C.onreadystatechange=function(){C.readyState===4&&O.signal.removeEventListener("abort",L)}),C.send(typeof O._bodyInit>"u"?null:O._bodyInit)})}return P.polyfill=!0,a.fetch||(a.fetch=P,a.Headers=g,a.Request=D,a.Response=B),o.Headers=g,o.Request=D,o.Response=B,o.fetch=P,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(i),i.fetch.ponyfill=!0,delete i.fetch.polyfill;var s=t.fetch?t:i;e=s.fetch,e.default=s.fetch,e.fetch=s.fetch,e.Headers=s.Headers,e.Request=s.Request,e.Response=s.Response,r.exports=e})(Zi,Zi.exports)),Zi.exports}var pD=dD();const Cl=Eo(pD);var fD=Object.defineProperty,gD=Object.defineProperties,yD=Object.getOwnPropertyDescriptors,Tl=Object.getOwnPropertySymbols,mD=Object.prototype.hasOwnProperty,wD=Object.prototype.propertyIsEnumerable,Rl=(r,e,t)=>e in r?fD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Nl=(r,e)=>{for(var t in e||(e={}))mD.call(e,t)&&Rl(r,t,e[t]);if(Tl)for(var t of Tl(e))wD.call(e,t)&&Rl(r,t,e[t]);return r},jl=(r,e)=>gD(r,yD(e));const bD={Accept:"application/json","Content-Type":"application/json"},vD="POST",Bl={headers:bD,method:vD},Ul=10;pt=class{constructor(e,t=!1){if(this.url=e,this.disableProviderPing=t,this.events=new Je.EventEmitter,this.isAvailable=!1,this.registering=!1,!Qc(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=t}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e){this.isAvailable||await this.register();try{const t=Ut(e),i=await (await Cl(this.url,jl(Nl({},Bl),{body:t}))).json();this.onPayload({data:i})}catch(t){this.onError(e.id,t)}}async register(e=this.url){if(!Qc(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((i,s)=>{this.events.once("register_error",n=>{this.resetMaxListeners(),s(n)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return s(new Error("HTTP connection is missing or invalid"));i()})})}this.url=e,this.registering=!0;try{if(!this.disableProviderPing){const t=Ut({id:1,jsonrpc:"2.0",method:"test",params:[]});await Cl(e,jl(Nl({},Bl),{body:t}))}this.onOpen()}catch(t){const i=this.parseError(t);throw this.events.emit("register_error",i),this.onClose(),i}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const t=typeof e.data=="string"?lr(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const i=this.parseError(t),s=i.message||i.toString(),n=Bs(e,s);this.events.emit("payload",n)}parseError(e,t=this.url){return Mu(e,t,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>Ul&&this.events.setMaxListeners(Ul)}};const ql="error",ED="wss://relay.walletconnect.org",_D="wc",ID="universal_provider",Qi=`${_D}@2:${ID}:`,ud="https://rpc.walletconnect.org/v1/",Ur="generic",SD=`${ud}bundler`,nt={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};function DD(){}function Fo(r){return r==null||typeof r!="object"&&typeof r!="function"}function Ho(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function OD(r){if(Fo(r))return r;if(Array.isArray(r)||Ho(r)||r instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer)return r.slice(0);const e=Object.getPrototypeOf(r),t=e.constructor;if(r instanceof Date||r instanceof Map||r instanceof Set)return new t(r);if(r instanceof RegExp){const i=new t(r);return i.lastIndex=r.lastIndex,i}if(r instanceof DataView)return new t(r.buffer.slice(0));if(r instanceof Error){const i=new t(r.message);return i.stack=r.stack,i.name=r.name,i.cause=r.cause,i}if(typeof File<"u"&&r instanceof File)return new t([r],r.name,{type:r.type,lastModified:r.lastModified});if(typeof r=="object"){const i=Object.create(e);return Object.assign(i,r)}return r}function Ll(r){return typeof r=="object"&&r!==null}function dd(r){return Object.getOwnPropertySymbols(r).filter(e=>Object.prototype.propertyIsEnumerable.call(r,e))}function pd(r){return r==null?r===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(r)}const $D="[object RegExp]",fd="[object String]",gd="[object Number]",yd="[object Boolean]",md="[object Arguments]",PD="[object Symbol]",xD="[object Date]",AD="[object Map]",CD="[object Set]",TD="[object Array]",RD="[object ArrayBuffer]",ND="[object Object]",jD="[object DataView]",BD="[object Uint8Array]",UD="[object Uint8ClampedArray]",qD="[object Uint16Array]",LD="[object Uint32Array]",kD="[object Int8Array]",MD="[object Int16Array]",zD="[object Int32Array]",FD="[object Float32Array]",HD="[object Float64Array]";function VD(r,e){return kr(r,void 0,r,new Map,e)}function kr(r,e,t,i=new Map,s=void 0){const n=s?.(r,e,t,i);if(n!=null)return n;if(Fo(r))return r;if(i.has(r))return i.get(r);if(Array.isArray(r)){const o=new Array(r.length);i.set(r,o);for(let a=0;a<r.length;a++)o[a]=kr(r[a],a,t,i,s);return Object.hasOwn(r,"index")&&(o.index=r.index),Object.hasOwn(r,"input")&&(o.input=r.input),o}if(r instanceof Date)return new Date(r.getTime());if(r instanceof RegExp){const o=new RegExp(r.source,r.flags);return o.lastIndex=r.lastIndex,o}if(r instanceof Map){const o=new Map;i.set(r,o);for(const[a,c]of r)o.set(a,kr(c,a,t,i,s));return o}if(r instanceof Set){const o=new Set;i.set(r,o);for(const a of r)o.add(kr(a,void 0,t,i,s));return o}if(typeof Ee<"u"&&Ee.isBuffer(r))return r.subarray();if(Ho(r)){const o=new(Object.getPrototypeOf(r)).constructor(r.length);i.set(r,o);for(let a=0;a<r.length;a++)o[a]=kr(r[a],a,t,i,s);return o}if(r instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer)return r.slice(0);if(r instanceof DataView){const o=new DataView(r.buffer.slice(0),r.byteOffset,r.byteLength);return i.set(r,o),sr(o,r,t,i,s),o}if(typeof File<"u"&&r instanceof File){const o=new File([r],r.name,{type:r.type});return i.set(r,o),sr(o,r,t,i,s),o}if(r instanceof Blob){const o=new Blob([r],{type:r.type});return i.set(r,o),sr(o,r,t,i,s),o}if(r instanceof Error){const o=new r.constructor;return i.set(r,o),o.message=r.message,o.name=r.name,o.stack=r.stack,o.cause=r.cause,sr(o,r,t,i,s),o}if(typeof r=="object"&&KD(r)){const o=Object.create(Object.getPrototypeOf(r));return i.set(r,o),sr(o,r,t,i,s),o}return r}function sr(r,e,t=r,i,s){const n=[...Object.keys(e),...dd(e)];for(let o=0;o<n.length;o++){const a=n[o],c=Object.getOwnPropertyDescriptor(r,a);(c==null||c.writable)&&(r[a]=kr(e[a],a,t,i,s))}}function KD(r){switch(pd(r)){case md:case TD:case RD:case jD:case yd:case xD:case FD:case HD:case kD:case MD:case zD:case AD:case gd:case ND:case $D:case CD:case fd:case PD:case BD:case UD:case qD:case LD:return!0;default:return!1}}function WD(r,e){return VD(r,(t,i,s,n)=>{if(typeof r=="object")switch(Object.prototype.toString.call(r)){case gd:case fd:case yd:{const o=new r.constructor(r?.valueOf());return sr(o,r),o}case md:{const o={};return sr(o,r),o.length=r.length,o[Symbol.iterator]=r[Symbol.iterator],o}default:return}})}function kl(r){return WD(r)}function Ml(r){return r!==null&&typeof r=="object"&&pd(r)==="[object Arguments]"}function GD(r){return Ho(r)}function YD(r){if(typeof r!="object"||r==null)return!1;if(Object.getPrototypeOf(r)===null)return!0;if(Object.prototype.toString.call(r)!=="[object Object]"){const t=r[Symbol.toStringTag];return t==null||!Object.getOwnPropertyDescriptor(r,Symbol.toStringTag)?.writable?!1:r.toString()===`[object ${t}]`}let e=r;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(r)===e}function JD(r,...e){const t=e.slice(0,-1),i=e[e.length-1];let s=r;for(let n=0;n<t.length;n++){const o=t[n];s=mo(s,o,i,new Map)}return s}function mo(r,e,t,i){if(Fo(r)&&(r=Object(r)),e==null||typeof e!="object")return r;if(i.has(e))return OD(i.get(e));if(i.set(e,r),Array.isArray(e)){e=e.slice();for(let n=0;n<e.length;n++)e[n]=e[n]??void 0}const s=[...Object.keys(e),...dd(e)];for(let n=0;n<s.length;n++){const o=s[n];let a=e[o],c=r[o];if(Ml(a)&&(a={...a}),Ml(c)&&(c={...c}),typeof Ee<"u"&&Ee.isBuffer(a)&&(a=kl(a)),Array.isArray(a))if(typeof c=="object"&&c!=null){const h=[],u=Reflect.ownKeys(c);for(let d=0;d<u.length;d++){const f=u[d];h[f]=c[f]}c=h}else c=[];const l=t(c,a,o,r,e,i);l!=null?r[o]=l:Array.isArray(a)||Ll(c)&&Ll(a)?r[o]=mo(c,a,t,i):c==null&&YD(a)?r[o]=mo({},a,t,i):c==null&&GD(a)?r[o]=kl(a):(c===void 0||a!==void 0)&&(r[o]=a)}return r}function ZD(r,...e){return JD(r,...e,DD)}var QD=Object.defineProperty,XD=Object.defineProperties,eO=Object.getOwnPropertyDescriptors,zl=Object.getOwnPropertySymbols,tO=Object.prototype.hasOwnProperty,rO=Object.prototype.propertyIsEnumerable,Fl=(r,e,t)=>e in r?QD(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Xi=(r,e)=>{for(var t in e||(e={}))tO.call(e,t)&&Fl(r,t,e[t]);if(zl)for(var t of zl(e))rO.call(e,t)&&Fl(r,t,e[t]);return r},iO=(r,e)=>XD(r,eO(e));function Ye(r,e,t){var i;const s=Mr(r);return((i=e.rpcMap)==null?void 0:i[s.reference])||`${ud}?chainId=${s.namespace}:${s.reference}&projectId=${t}`}function yr(r){return r.includes(":")?r.split(":")[1]:r}function wd(r){return r.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function sO(r,e){const t=Object.keys(e.namespaces).filter(s=>s.includes(r));if(!t.length)return[];const i=[];return t.forEach(s=>{const n=e.namespaces[s].accounts;i.push(...n)}),i}function es(r={},e={}){const t=Hl(r),i=Hl(e);return ZD(t,i)}function Hl(r){var e,t,i,s,n;const o={};if(!Wt(r))return o;for(const[a,c]of Object.entries(r)){const l=Rs(a)?[a]:c.chains,h=c.methods||[],u=c.events||[],d=c.rpcMap||{},f=Lr(a);o[f]=iO(Xi(Xi({},o[f]),c),{chains:_t(l,(e=o[f])==null?void 0:e.chains),methods:_t(h,(t=o[f])==null?void 0:t.methods),events:_t(u,(i=o[f])==null?void 0:i.events)}),(Wt(d)||Wt(((s=o[f])==null?void 0:s.rpcMap)||{}))&&(o[f].rpcMap=Xi(Xi({},d),(n=o[f])==null?void 0:n.rpcMap))}return o}function Vl(r){return r.includes(":")?r.split(":")[2]:r}function Kl(r){const e={};for(const[t,i]of Object.entries(r)){const s=i.methods||[],n=i.events||[],o=i.accounts||[],a=Rs(t)?[t]:i.chains?i.chains:wd(i.accounts);e[t]={chains:a,methods:s,events:n,accounts:o}}return e}function Pn(r){return typeof r=="number"?r:r.includes("0x")?parseInt(r,16):(r=r.includes(":")?r.split(":")[1]:r,isNaN(Number(r))?r:Number(r))}const bd={},Q=r=>bd[r],xn=(r,e)=>{bd[r]=e};var nO=Object.defineProperty,oO=(r,e,t)=>e in r?nO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Dr=(r,e,t)=>oO(r,typeof e!="symbol"?e+"":e,t);class aO{constructor(e){Dr(this,"name","polkadot"),Dr(this,"client"),Dr(this,"httpProviders"),Dr(this,"events"),Dr(this,"namespace"),Dr(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(nt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=yr(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ye(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new st(new pt(i,Q("disableProviderPing")))}}var cO=Object.defineProperty,lO=Object.defineProperties,hO=Object.getOwnPropertyDescriptors,Wl=Object.getOwnPropertySymbols,uO=Object.prototype.hasOwnProperty,dO=Object.prototype.propertyIsEnumerable,wo=(r,e,t)=>e in r?cO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Gl=(r,e)=>{for(var t in e||(e={}))uO.call(e,t)&&wo(r,t,e[t]);if(Wl)for(var t of Wl(e))dO.call(e,t)&&wo(r,t,e[t]);return r},Yl=(r,e)=>lO(r,hO(e)),Or=(r,e,t)=>wo(r,typeof e!="symbol"?e+"":e,t);class pO{constructor(e){Or(this,"name","eip155"),Or(this,"client"),Or(this,"chainId"),Or(this,"namespace"),Or(this,"httpProviders"),Or(this,"events"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(parseInt(e),t),this.chainId=parseInt(e),this.events.emit(nt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){const i=t||Ye(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new st(new pt(i,Q("disableProviderPing")))}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=parseInt(yr(t));e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}getHttpProvider(){const e=this.chainId,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}async handleSwitchChain(e){var t,i;let s=e.request.params?(t=e.request.params[0])==null?void 0:t.chainId:"0x0";s=s.startsWith("0x")?s:`0x${s}`;const n=parseInt(s,16);if(this.isChainApproved(n))this.setDefaultChain(`${n}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:s}]},chainId:(i=this.namespace.chains)==null?void 0:i[0]}),this.setDefaultChain(`${n}`);else throw new Error(`Failed to switch to chain 'eip155:${n}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var t,i,s,n,o;const a=(i=(t=e.request)==null?void 0:t.params)==null?void 0:i[0],c=((n=(s=e.request)==null?void 0:s.params)==null?void 0:n[1])||[],l=`${a}${c.join(",")}`;if(!a)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const h=this.client.session.get(e.topic),u=((o=h?.sessionProperties)==null?void 0:o.capabilities)||{};if(u!=null&&u[l])return u?.[l];const d=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:Yl(Gl({},h.sessionProperties||{}),{capabilities:Yl(Gl({},u||{}),{[l]:d})})})}catch(f){console.warn("Failed to update session with capabilities",f)}return d}async getCallStatus(e){var t,i;const s=this.client.session.get(e.topic),n=(t=s.sessionProperties)==null?void 0:t.bundler_name;if(n){const a=this.getBundlerUrl(e.chainId,n);try{return await this.getUserOperationReceipt(a,e)}catch(c){console.warn("Failed to fetch call status from bundler",c,a)}}const o=(i=s.sessionProperties)==null?void 0:i.bundler_url;if(o)try{return await this.getUserOperationReceipt(o,e)}catch(a){console.warn("Failed to fetch call status from custom bundler",a,o)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,t){var i;const s=new URL(e),n=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Vt("eth_getUserOperationReceipt",[(i=t.request.params)==null?void 0:i[0]]))});if(!n.ok)throw new Error(`Failed to fetch user operation receipt - ${n.status}`);return await n.json()}getBundlerUrl(e,t){return`${SD}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${t}`}}var fO=Object.defineProperty,gO=(r,e,t)=>e in r?fO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,$r=(r,e,t)=>gO(r,typeof e!="symbol"?e+"":e,t);class yO{constructor(e){$r(this,"name","solana"),$r(this,"client"),$r(this,"httpProviders"),$r(this,"events"),$r(this,"namespace"),$r(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(nt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=yr(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ye(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new st(new pt(i,Q("disableProviderPing")))}}var mO=Object.defineProperty,wO=(r,e,t)=>e in r?mO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Pr=(r,e,t)=>wO(r,typeof e!="symbol"?e+"":e,t);class bO{constructor(e){Pr(this,"name","cosmos"),Pr(this,"client"),Pr(this,"httpProviders"),Pr(this,"events"),Pr(this,"namespace"),Pr(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(nt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=yr(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ye(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new st(new pt(i,Q("disableProviderPing")))}}var vO=Object.defineProperty,EO=(r,e,t)=>e in r?vO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,xr=(r,e,t)=>EO(r,typeof e!="symbol"?e+"":e,t);class _O{constructor(e){xr(this,"name","algorand"),xr(this,"client"),xr(this,"httpProviders"),xr(this,"events"),xr(this,"namespace"),xr(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(!this.httpProviders[e]){const i=t||Ye(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.chainId=e,this.events.emit(nt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;e[t]=this.createHttpProvider(t,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ye(e,this.namespace,this.client.core.projectId);return typeof i>"u"?void 0:new st(new pt(i,Q("disableProviderPing")))}}var IO=Object.defineProperty,SO=(r,e,t)=>e in r?IO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ar=(r,e,t)=>SO(r,typeof e!="symbol"?e+"":e,t);class DO{constructor(e){Ar(this,"name","cip34"),Ar(this,"client"),Ar(this,"httpProviders"),Ar(this,"events"),Ar(this,"namespace"),Ar(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(nt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{const i=this.getCardanoRPCUrl(t),s=yr(t);e[s]=this.createHttpProvider(s,i)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}getCardanoRPCUrl(e){const t=this.namespace.rpcMap;if(t)return t[e]}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||this.getCardanoRPCUrl(e);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new st(new pt(i,Q("disableProviderPing")))}}var OO=Object.defineProperty,$O=(r,e,t)=>e in r?OO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Cr=(r,e,t)=>$O(r,typeof e!="symbol"?e+"":e,t);class PO{constructor(e){Cr(this,"name","elrond"),Cr(this,"client"),Cr(this,"httpProviders"),Cr(this,"events"),Cr(this,"namespace"),Cr(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(nt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=yr(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ye(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new st(new pt(i,Q("disableProviderPing")))}}var xO=Object.defineProperty,AO=(r,e,t)=>e in r?xO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Tr=(r,e,t)=>AO(r,typeof e!="symbol"?e+"":e,t);class CO{constructor(e){Tr(this,"name","multiversx"),Tr(this,"client"),Tr(this,"httpProviders"),Tr(this,"events"),Tr(this,"namespace"),Tr(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(nt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=yr(t);e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ye(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new st(new pt(i,Q("disableProviderPing")))}}var TO=Object.defineProperty,RO=(r,e,t)=>e in r?TO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Rr=(r,e,t)=>RO(r,typeof e!="symbol"?e+"":e,t);class NO{constructor(e){Rr(this,"name","near"),Rr(this,"client"),Rr(this,"httpProviders"),Rr(this,"events"),Rr(this,"namespace"),Rr(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||Ye(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(nt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;e[t]=this.createHttpProvider(t,(i=this.namespace.rpcMap)==null?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ye(e,this.namespace);return typeof i>"u"?void 0:new st(new pt(i,Q("disableProviderPing")))}}var jO=Object.defineProperty,BO=(r,e,t)=>e in r?jO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Nr=(r,e,t)=>BO(r,typeof e!="symbol"?e+"":e,t);class UO{constructor(e){Nr(this,"name","tezos"),Nr(this,"client"),Nr(this,"httpProviders"),Nr(this,"events"),Nr(this,"namespace"),Nr(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||Ye(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(nt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ye(e,this.namespace);return typeof i>"u"?void 0:new st(new pt(i))}}var qO=Object.defineProperty,LO=(r,e,t)=>e in r?qO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,jr=(r,e,t)=>LO(r,typeof e!="symbol"?e+"":e,t);class kO{constructor(e){jr(this,"name",Ur),jr(this,"client"),jr(this,"httpProviders"),jr(this,"events"),jr(this,"namespace"),jr(this,"chainId"),this.namespace=e.namespace,this.events=Q("events"),this.client=Q("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(nt.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){var e,t;const i={};return(t=(e=this.namespace)==null?void 0:e.accounts)==null||t.forEach(s=>{const n=Mr(s);i[`${n.namespace}:${n.reference}`]=this.createHttpProvider(s)}),i}getHttpProvider(e){const t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Ye(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new st(new pt(i,Q("disableProviderPing")))}}var MO=Object.defineProperty,zO=Object.defineProperties,FO=Object.getOwnPropertyDescriptors,Jl=Object.getOwnPropertySymbols,HO=Object.prototype.hasOwnProperty,VO=Object.prototype.propertyIsEnumerable,bo=(r,e,t)=>e in r?MO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ts=(r,e)=>{for(var t in e||(e={}))HO.call(e,t)&&bo(r,t,e[t]);if(Jl)for(var t of Jl(e))VO.call(e,t)&&bo(r,t,e[t]);return r},An=(r,e)=>zO(r,FO(e)),Xe=(r,e,t)=>bo(r,typeof e!="symbol"?e+"":e,t);let KO=class vd{constructor(e){Xe(this,"client"),Xe(this,"namespaces"),Xe(this,"optionalNamespaces"),Xe(this,"sessionProperties"),Xe(this,"scopedProperties"),Xe(this,"events",new _o),Xe(this,"rpcProviders",{}),Xe(this,"session"),Xe(this,"providerOpts"),Xe(this,"logger"),Xe(this,"uri"),Xe(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:Ui(Ns({level:e?.logger||ql})),this.disableProviderPing=e?.disableProviderPing||!1}static async init(e){const t=new vd(e);return await t.initialize(),t}async request(e,t,i){const[s,n]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:ts({},e),chainId:`${s}:${n}`,topic:this.session.topic,expiry:i})}sendAsync(e,t,i,s){const n=new Date().getTime();this.request(e,i,s).then(o=>t(null,js(n,o))).catch(o=>t(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:te("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,t){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:i,response:s}=await this.client.authenticate(e,t);i&&(this.uri=i,this.events.emit("display_uri",i));const n=await s();if(this.session=n.session,this.session){const o=Kl(this.session.namespaces);this.namespaces=es(this.namespaces,o),await this.persist("namespaces",this.namespaces),this.onConnect()}return n}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){const{uri:t,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});t&&(this.uri=t,this.events.emit("display_uri",t));const s=await i();this.session=s;const n=Kl(s.namespaces);return this.namespaces=es(this.namespaces,n),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,t){try{if(!this.session)return;const[i,s]=this.validateChain(e),n=this.getProvider(i);n.name===Ur?n.setDefaultChain(`${i}:${s}`,t):n.setDefaultChain(s,t)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(dt(t)){for(const i of t)e.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,t;if(this.client=this.providerOpts.client||await uD.init({core:this.providerOpts.core,logger:this.providerOpts.logger||ql,relayUrl:this.providerOpts.relayUrl||ED,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(i){throw this.logger.error("Failed to get session",i),new Error(`The provided session: ${(t=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:t.topic} doesn't exist in the Sign client`)}else{const i=this.client.session.getAll();this.session=i[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(t=>Lr(t)))];xn("client",this.client),xn("events",this.events),xn("disableProviderPing",this.disableProviderPing),e.forEach(t=>{if(!this.session)return;const i=sO(t,this.session),s=wd(i),n=es(this.namespaces,this.optionalNamespaces),o=An(ts({},n[t]),{accounts:i,chains:s});switch(t){case"eip155":this.rpcProviders[t]=new pO({namespace:o});break;case"algorand":this.rpcProviders[t]=new _O({namespace:o});break;case"solana":this.rpcProviders[t]=new yO({namespace:o});break;case"cosmos":this.rpcProviders[t]=new bO({namespace:o});break;case"polkadot":this.rpcProviders[t]=new aO({namespace:o});break;case"cip34":this.rpcProviders[t]=new DO({namespace:o});break;case"elrond":this.rpcProviders[t]=new PO({namespace:o});break;case"multiversx":this.rpcProviders[t]=new CO({namespace:o});break;case"near":this.rpcProviders[t]=new NO({namespace:o});break;case"tezos":this.rpcProviders[t]=new UO({namespace:o});break;default:this.rpcProviders[Ur]?this.rpcProviders[Ur].updateNamespace(o):this.rpcProviders[Ur]=new kO({namespace:o})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var t;const{topic:i}=e;i===((t=this.session)==null?void 0:t.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var t;const{params:i,topic:s}=e;if(s!==((t=this.session)==null?void 0:t.topic))return;const{event:n}=i;if(n.name==="accountsChanged"){const o=n.data;o&&dt(o)&&this.events.emit("accountsChanged",o.map(Vl))}else if(n.name==="chainChanged"){const o=i.chainId,a=i.event.data,c=Lr(o),l=Pn(o)!==Pn(a)?`${c}:${Pn(a)}`:o;this.onChainChanged(l)}else this.events.emit(n.name,n.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var i,s;if(e!==((i=this.session)==null?void 0:i.topic))return;const{namespaces:n}=t,o=(s=this.client)==null?void 0:s.session.get(e);this.session=An(ts({},o),{namespaces:n}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",async e=>{var t;e.topic===((t=this.session)==null?void 0:t.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",An(ts({},te("USER_DISCONNECTED")),{data:e.topic})))}),this.on(nt.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[Ur]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace((t=this.session)==null?void 0:t.namespaces[e])})}setNamespaces(e){const{namespaces:t={},optionalNamespaces:i={},sessionProperties:s,scopedProperties:n}=e;this.optionalNamespaces=es(t,i),this.sessionProperties=s,this.scopedProperties=n}validateChain(e){const[t,i]=e?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,i];if(t&&!Object.keys(this.namespaces||{}).map(o=>Lr(o)).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&i)return[t,i];const s=Lr(Object.keys(this.namespaces)[0]),n=this.rpcProviders[s].getDefaultChain();return[s,n]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged(e,t=!1){if(!this.namespaces)return;const[i,s]=this.validateChain(e);if(!s)return;this.updateNamespaceChain(i,s),this.events.emit("chainChanged",s);const n=this.getProvider(i).getDefaultChain();t||this.getProvider(i).setDefaultChain(s),this.emitAccountsChangedOnChainChange({namespace:i,previousChainId:n,newChainId:e}),await this.persist("namespaces",this.namespaces)}emitAccountsChangedOnChainChange({namespace:e,previousChainId:t,newChainId:i}){var s,n;try{if(t===i)return;const o=(n=(s=this.session)==null?void 0:s.namespaces[e])==null?void 0:n.accounts;if(!o)return;const a=o.filter(c=>c.includes(`${i}:`)).map(Vl);if(!dt(a))return;this.events.emit("accountsChanged",a)}catch(o){this.logger.warn("Failed to emit accountsChanged on chain change",o)}}updateNamespaceChain(e,t){if(!this.namespaces)return;const i=this.namespaces[e]?e:`${e}:${t}`,s={chains:[],methods:[],events:[],defaultChain:t};this.namespaces[i]?this.namespaces[i]&&(this.namespaces[i].defaultChain=t):this.namespaces[i]=s}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,t){var i;const s=((i=this.session)==null?void 0:i.topic)||"";await this.client.core.storage.setItem(`${Qi}/${e}${s}`,t)}async getFromStore(e){var t;const i=((t=this.session)==null?void 0:t.topic)||"";return await this.client.core.storage.getItem(`${Qi}/${e}${i}`)}async deleteFromStore(e){var t;const i=((t=this.session)==null?void 0:t.topic)||"";await this.client.core.storage.removeItem(`${Qi}/${e}${i}`)}async cleanupStorage(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;const t=await this.client.core.storage.getKeys();for(const i of t)i.startsWith(Qi)&&await this.client.core.storage.removeItem(i)}catch(t){this.logger.warn("Failed to cleanup storage",t)}}};const WO=KO,GO="wc",YO="ethereum_provider",JO=`${GO}@2:${YO}:`,ZO="https://rpc.walletconnect.org/v1/",bs=["eth_sendTransaction","personal_sign"],Ed=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],vs=["chainChanged","accountsChanged"],_d=["chainChanged","accountsChanged","message","disconnect","connect"],QO=async()=>{const{createAppKit:r}=await eh(()=>import("./core-Bfgv4nD3.js").then(async m=>{await m.__tla;return m}).then(e=>e.X),__vite__mapDeps([5,1,2,3]));return r};var XO=Object.defineProperty,e$=Object.defineProperties,t$=Object.getOwnPropertyDescriptors,Zl=Object.getOwnPropertySymbols,r$=Object.prototype.hasOwnProperty,i$=Object.prototype.propertyIsEnumerable,vo=(r,e,t)=>e in r?XO(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,er=(r,e)=>{for(var t in e||(e={}))r$.call(e,t)&&vo(r,t,e[t]);if(Zl)for(var t of Zl(e))i$.call(e,t)&&vo(r,t,e[t]);return r},pi=(r,e)=>e$(r,t$(e)),He=(r,e,t)=>vo(r,typeof e!="symbol"?e+"":e,t);function Es(r){return Number(r[0].split(":")[1])}function rs(r){return`0x${r.toString(16)}`}function s$(r){const{chains:e,optionalChains:t,methods:i,optionalMethods:s,events:n,optionalEvents:o,rpcMap:a}=r;if(!dt(e))throw new Error("Invalid chains");const c={chains:e,methods:i||bs,events:n||vs,rpcMap:er({},e.length?{[Es(e)]:a[Es(e)]}:{})},l=n?.filter(f=>!vs.includes(f)),h=i?.filter(f=>!bs.includes(f));if(!t&&!o&&!s&&!(l!=null&&l.length)&&!(h!=null&&h.length))return{required:e.length?c:void 0};const u=l?.length&&h?.length||!t,d={chains:[...new Set(u?c.chains.concat(t||[]):t)],methods:[...new Set(c.methods.concat(s!=null&&s.length?s:Ed))],events:[...new Set(c.events.concat(o!=null&&o.length?o:_d))],rpcMap:a};return{required:e.length?c:void 0,optional:t.length?d:void 0}}class ks{constructor(){He(this,"events",new Je.EventEmitter),He(this,"namespace","eip155"),He(this,"accounts",[]),He(this,"signer"),He(this,"chainId",1),He(this,"modal"),He(this,"rpc"),He(this,"STORAGE_KEY",JO),He(this,"on",(e,t)=>(this.events.on(e,t),this)),He(this,"once",(e,t)=>(this.events.once(e,t),this)),He(this,"removeListener",(e,t)=>(this.events.removeListener(e,t),this)),He(this,"off",(e,t)=>(this.events.off(e,t),this)),He(this,"parseAccount",e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e),this.signer={},this.rpc={}}static async init(e){const t=new ks;return await t.initialize(e),t}async request(e,t){return await this.signer.request(e,this.formatChainId(this.chainId),t)}sendAsync(e,t,i){this.signer.sendAsync(e,t,this.formatChainId(this.chainId),i)}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){var t;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);const{required:i,optional:s}=s$(this.rpc);try{const n=await new Promise(async(a,c)=>{var l,h;this.rpc.showQrModal&&((l=this.modal)==null||l.open(),(h=this.modal)==null||h.subscribeState(d=>{!d.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),c(new Error("Connection request reset. Please try again.")))}));const u=e!=null&&e.scopedProperties?{[this.namespace]:e.scopedProperties}:void 0;await this.signer.connect(pi(er({namespaces:er({},i&&{[this.namespace]:i})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:e?.pairingTopic,scopedProperties:u})).then(d=>{a(d)}).catch(d=>{var f;(f=this.modal)==null||f.showErrorMessage("Unable to connect"),c(new Error(d.message))})});if(!n)return;const o=Ha(n.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:rs(this.chainId)})}catch(n){throw this.signer.logger.error(n),n}finally{(t=this.modal)==null||t.close()}}async authenticate(e,t){var i;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts({chains:e?.chains});try{const s=await new Promise(async(o,a)=>{var c,l;this.rpc.showQrModal&&((c=this.modal)==null||c.open(),(l=this.modal)==null||l.subscribeState(h=>{!h.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),a(new Error("Connection request reset. Please try again.")))})),await this.signer.authenticate(pi(er({},e),{chains:this.rpc.chains}),t).then(h=>{o(h)}).catch(h=>{var u;(u=this.modal)==null||u.showErrorMessage("Unable to connect"),a(new Error(h.message))})}),n=s.session;if(n){const o=Ha(n.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:rs(this.chainId)})}return s}catch(s){throw this.signer.logger.error(s),s}finally{(i=this.modal)==null||i.close()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{const{params:t}=e,{event:i}=t;i.name==="accountsChanged"?(this.accounts=this.parseAccounts(i.data),this.events.emit("accountsChanged",this.accounts)):i.name==="chainChanged"?this.setChainId(this.formatChainId(i.data)):this.events.emit(i.name,i.data),this.events.emit("session_event",e)}),this.signer.on("accountsChanged",e=>{this.accounts=this.parseAccounts(e),this.events.emit("accountsChanged",this.accounts)}),this.signer.on("chainChanged",e=>{const t=parseInt(e);this.chainId=t,this.events.emit("chainChanged",rs(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",pi(er({},te("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",e=>{this.events.emit("display_uri",e)})}switchEthereumChain(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return typeof e=="string"?e.startsWith(`${this.namespace}:`):!1}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){const t=e.filter(i=>this.isCompatibleChainId(i)).map(i=>this.parseChainId(i));t.length&&(this.chainId=t[0],this.events.emit("chainChanged",rs(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){const t=this.parseChainId(e);this.chainId=t,this.switchEthereumChain(t)}}parseAccountId(e){const[t,i,s]=e.split(":");return{chainId:`${t}:${i}`,address:s}}setAccounts(e){this.accounts=e.filter(t=>this.parseChainId(this.parseAccountId(t).chainId)===this.chainId).map(t=>this.parseAccountId(t).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var t,i;const s=(t=e?.chains)!=null?t:[],n=(i=e?.optionalChains)!=null?i:[],o=s.concat(n);if(!o.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const a=s.length?e?.methods||bs:[],c=s.length?e?.events||vs:[],l=e?.optionalMethods||[],h=e?.optionalEvents||[],u=e?.rpcMap||this.buildRpcMap(o,e.projectId),d=e?.qrModalOptions||void 0;return{chains:s?.map(f=>this.formatChainId(f)),optionalChains:n.map(f=>this.formatChainId(f)),methods:a,events:c,optionalMethods:l,optionalEvents:h,rpcMap:u,showQrModal:!!(e!=null&&e.showQrModal),qrModalOptions:d,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,t){const i={};return e.forEach(s=>{i[s]=this.getRpcUrl(s,t)}),i}async initialize(e){if(this.rpc=this.getRpcConfig(e),this.chainId=this.rpc.chains.length?Es(this.rpc.chains):Es(this.rpc.optionalChains),this.signer=await WO.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storage:e.storage,storageOptions:e.storageOptions,customStoragePrefix:e.customStoragePrefix,telemetryEnabled:e.telemetryEnabled,logger:e.logger}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let t;try{const i=await QO(),{convertWCMToAppKitOptions:s}=await Promise.resolve().then(function(){return g$}),n=s(pi(er({},this.rpc.qrModalOptions),{chains:[...new Set([...this.rpc.chains,...this.rpc.optionalChains])],metadata:this.rpc.metadata,projectId:this.rpc.projectId}));if(!n.networks.length)throw new Error("No networks found for WalletConnect\xb7");t=i(pi(er({},n),{universalProvider:this.signer,manualWCControl:!0}))}catch(i){throw console.warn(i),new Error("To use QR modal, please install @reown/appkit package")}if(t)try{this.modal=t}catch(i){throw this.signer.logger.error(i),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(e){if(!e)return;const{chains:t,optionalChains:i,rpcMap:s}=e;t&&dt(t)&&(this.rpc.chains=t.map(n=>this.formatChainId(n)),t.forEach(n=>{this.rpc.rpcMap[n]=s?.[n]||this.getRpcUrl(n)})),i&&dt(i)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=i?.map(n=>this.formatChainId(n)),i.forEach(n=>{this.rpc.rpcMap[n]=s?.[n]||this.getRpcUrl(n)}))}getRpcUrl(e,t){var i;return((i=this.rpc.rpcMap)==null?void 0:i[e])||`${ZO}?chainId=eip155:${e}&projectId=${t||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{const e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),t=this.session.namespaces[`${this.namespace}:${e}`]?this.session.namespaces[`${this.namespace}:${e}`]:this.session.namespaces[this.namespace];this.setChainIds(e?[this.formatChainId(e)]:t?.accounts),this.setAccounts(t?.accounts)}catch(e){this.signer.logger.error("Failed to load persisted session, clearing state..."),this.signer.logger.error(e),await this.disconnect().catch(t=>this.signer.logger.warn(t))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return typeof e=="string"||e instanceof String?[this.parseAccount(e)]:e.map(t=>this.parseAccount(t))}}const n$=ks;var o$=Object.defineProperty,a$=Object.defineProperties,c$=Object.getOwnPropertyDescriptors,Ql=Object.getOwnPropertySymbols,l$=Object.prototype.hasOwnProperty,h$=Object.prototype.propertyIsEnumerable,Xl=(r,e,t)=>e in r?o$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Id=(r,e)=>{for(var t in e||(e={}))l$.call(e,t)&&Xl(r,t,e[t]);if(Ql)for(var t of Ql(e))h$.call(e,t)&&Xl(r,t,e[t]);return r},u$=(r,e)=>a$(r,c$(e));function d$(r){if(r)return{"--w3m-font-family":r["--wcm-font-family"],"--w3m-accent":r["--wcm-accent-color"],"--w3m-color-mix":r["--wcm-background-color"],"--w3m-z-index":r["--wcm-z-index"]?Number(r["--wcm-z-index"]):void 0,"--w3m-qr-color":r["--wcm-accent-color"],"--w3m-font-size-master":r["--wcm-text-medium-regular-size"],"--w3m-border-radius-master":r["--wcm-container-border-radius"],"--w3m-color-mix-strength":0}}const p$=r=>{const[e,t]=r.split(":");return Sd({id:t,caipNetworkId:r,chainNamespace:e,name:"",nativeCurrency:{name:"",symbol:"",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}})};function f$(r){var e,t,i,s,n,o,a;const c=(e=r.chains)==null?void 0:e.map(p$).filter(Boolean);if(c.length===0)throw new Error("At least one chain must be specified");const l=c.find(u=>{var d;return u.id===((d=r.defaultChain)==null?void 0:d.id)}),h={projectId:r.projectId,networks:c,themeMode:r.themeMode,themeVariables:d$(r.themeVariables),chainImages:r.chainImages,connectorImages:r.walletImages,defaultNetwork:l,metadata:u$(Id({},r.metadata),{name:((t=r.metadata)==null?void 0:t.name)||"WalletConnect",description:((i=r.metadata)==null?void 0:i.description)||"Connect to WalletConnect-compatible wallets",url:((s=r.metadata)==null?void 0:s.url)||"https://walletconnect.org",icons:((n=r.metadata)==null?void 0:n.icons)||["https://walletconnect.org/walletconnect-logo.png"]}),showWallets:!0,featuredWalletIds:r.explorerRecommendedWalletIds==="NONE"?[]:Array.isArray(r.explorerRecommendedWalletIds)?r.explorerRecommendedWalletIds:[],excludeWalletIds:r.explorerExcludedWalletIds==="ALL"?[]:Array.isArray(r.explorerExcludedWalletIds)?r.explorerExcludedWalletIds:[],enableEIP6963:!1,enableInjected:!1,enableCoinbase:!0,enableWalletConnect:!0,features:{email:!1,socials:!1}};if((o=r.mobileWallets)!=null&&o.length||(a=r.desktopWallets)!=null&&a.length){const u=[...(r.mobileWallets||[]).map(p=>({id:p.id,name:p.name,links:p.links})),...(r.desktopWallets||[]).map(p=>({id:p.id,name:p.name,links:{native:p.links.native,universal:p.links.universal}}))],d=[...h.featuredWalletIds||[],...h.excludeWalletIds||[]],f=u.filter(p=>!d.includes(p.id));f.length&&(h.customWallets=f)}return h}function Sd(r){return Id({formatters:void 0,fees:void 0,serializers:void 0},r)}var g$=Object.freeze({__proto__:null,convertWCMToAppKitOptions:f$,defineChain:Sd});aP=Object.freeze(Object.defineProperty({__proto__:null,EthereumProvider:n$,OPTIONAL_EVENTS:_d,OPTIONAL_METHODS:Ed,REQUIRED_EVENTS:vs,REQUIRED_METHODS:bs,default:ks},Symbol.toStringTag,{value:"Module"}))});export{HE as A,st as B,cw as C,e1 as D,je as E,Mo as F,Us as G,rf as H,pr as I,js as J,um as K,Ut as L,lr as M,_o as N,Ui as O,Ma as P,Vh as Q,or as R,Bs as S,vt as T,tt as U,bt as V,pt as W,aP as X,ya as a,Kp as b,v$ as c,b$ as d,Is as e,I$ as f,_$ as g,Cp as h,rt as i,Me as j,U as k,Bt as l,Yd as m,yi as n,kd as o,Je as p,Ns as q,E$ as r,Mn as s,dh as t,Q0 as u,$E as v,sf as w,Vt as x,ze as y,fr as z,__tla};